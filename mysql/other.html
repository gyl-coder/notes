


<!DOCTYPE html>
<html lang="en" class="with-v3-banner">
  <head>
    <title>Mysql 常见问题 — Notes</title>
    <meta charset="utf-8">
    <meta name="description" content="Notes - Personal review warehouse">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="alternate" hreflang="x-default" href="https://vuejs.org/mysql/other.html">
    <link rel="alternate" hreflang="zh" href="https://cn.vuejs.org/mysql/other.html">
    <link rel="alternate" hreflang="ja" href="https://jp.vuejs.org/mysql/other.html">
    <link rel="alternate" hreflang="ru" href="https://ru.vuejs.org/mysql/other.html">
    <link rel="alternate" hreflang="ko" href="https://kr.vuejs.org/mysql/other.html">
    <link rel="alternate" hreflang="pt-BR" href="https://br.vuejs.org/mysql/other.html">
    <link rel="alternate" hreflang="fr" href="https://fr.vuejs.org/mysql/other.html">
    <link rel="alternate" hreflang="es" href="https://es.vuejs.org/mysql/other.html">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Mysql 常见问题 — Notes">
    <meta property="og:description" content="Notes - Personal review warehouse">
    <meta property="og:image" content="https://vuejs.org//images/logo.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Mysql 常见问题 — Notes">
    <meta name="twitter:description" content="Notes - Personal review warehouse">
    <meta name="twitter:image" content="https://vuejs.org/images/logo.png">

    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png">
    <meta name="msapplication-TileImage" content="/images/icons/ms-icon-144x144.png">
    <link rel="icon" href="/images/logo.png" type="image/png">

    <meta name="msapplication-TileColor" content="#4fc08d">
    <meta name="theme-color" content="#4fc08d">

    <meta name="msapplication-config" content="browserconfig.xml">
    <link rel="manifest" href="/manifest.json">

    <link href="https://fonts.googleapis.com" rel="preconnect" crossorigin>
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    <link href="https://maxcdn.bootstrapcdn.com" rel="preconnect" crossorigin>

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Dosis:500&text=Vue.js&display=swap" rel="stylesheet">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- main page styles -->
    
<link rel="stylesheet" href="/css/page.css">


    <!-- this needs to be loaded before guide's inline scripts -->
    <script src="/js/vue.js"></script>

    

    <script>
      Vue.config.productionTip = false
      window.PAGE_TYPE = "api"
    </script>

    <!-- ga -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46852172-1', 'vuejs.org');
      ga('send', 'pageview');
    </script>

    <!-- vimeo analytics -->
    <script type="text/javascript" defer="defer" src="https://extend.vimeocdn.com/ga/72160148.js"></script>
  <meta name="generator" content="Hexo 5.4.0"></head>
  <body class="docs">
    <div id="mobile-bar" >
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>
    <div>
  <div id="v3-banner">
    <span class="hidden-sm">Welcome to yanliang's notes</span>
  </div>

  <header id="header">
    <a id="logo" href="/">
      <img src="/images/logo.png" alt="vue logo">
      <span>Notes - personal review warehouse</span>
    </a>
    <ul id="nav">
      <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input" aria-label="Search">
  </form>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">⭐️Java</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Documentation</h4></li>
    <li>
      <ul>
        <li><a href="/java/oop/" class="nav-link">OOP</a></li>
        <li><a href="/v2/api" class="nav-link">API</a></li>
        <li><a href="/v2/style-guide" class="nav-link">Style Guide</a></li>
        <li><a href="/v2/examples" class="nav-link">Examples</a></li>
        <li><a href="/v2/cookbook" class="nav-link">Cookbook</a></li>
      </ul>
    </li>
    <li><h4>Video Courses</h4></li>
    <li>
      <ul>
        <li>
          <a href="https://www.vuemastery.com/courses/" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue Mastery
          </a>
        </li>
        <li>
          <a
            href="https://vueschool.io/?friend=vuejs&utm_source=Vuejs.org&utm_medium=Link&utm_content=Navbar%20Dropdown"
            class="nav-link"
            target="_blank" rel="sponsored noopener"
          >
            Vue School
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container learn">
  <a class="nav-link">网络</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <!-- <li><h4>Documentation</h4></li> -->
    <li>
      <ul>
        <li><a href="/network">Review List</a></li>
        <li><a href="/network/tcp/">🔥TCP</a></li>
        <li><a href="/network/http/">HTTP</a></li>
        <li><a href="/network/ip/">IP</a></li>
      </ul>
    </li>
    <li><h4>Video Courses</h4></li>
    <li>
      <ul>
        <li>
          <a href="https://www.vuemastery.com/courses/" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue Mastery
          </a>
        </li>
        <li>
          <a
            href="https://vueschool.io/?friend=vuejs&utm_source=Vuejs.org&utm_medium=Link&utm_content=Navbar%20Dropdown"
            class="nav-link"
            target="_blank" rel="sponsored noopener"
          >
            Vue School
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/os/">操作系统</a>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">数据库</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <!-- <li><h4>Documentation</h4></li> -->
    <li>
      <ul>
        <li><a href="/mysql">Review List</a></li>
        <li><a href="/mysql/mysql-index">索引相关</a></li>
        <li><a href="/mysql/mysql-index-operation">索引操作相关</a></li>
        <li><a href="/mysql/mysql-lock">锁相关</a></li>
        <li><a href="/mysql/mysql-logs">日志相关</a></li>
        <li><a href="/mysql/mysql-mvcc">MVCC</a></li>
        <li><a href="/mysql/mysql-trans">事务相关</a></li>
        <li><a href="/mysql/other">其他</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/algo/">算法</a>
</li>
<li class="nav-dropdown-container resources">
  <a href="#" class="nav-link">Resources</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/resources/partners.html" class="nav-link">Partners</a></li>
    <li><a href="/resources/themes.html" class="nav-link">Themes</a></li>
    <li><a href="https://github.com/vuejs/awesome-vue" class="nav-link" target="_blank" rel="noopener">Awesome Vue</a></li>
    <li><a href="https://awesomejs.dev/for/vue/" class="nav-link" target="_blank" rel="noopener">Browse packages for Vue</a></li>
  </ul>
</li>

<!-- <li>
  <a href="/partners" class="nav-link ">Partners</a>
</li> -->
<li class="nav-dropdown-container support-vue">
  <a href="/support-vuejs/" class="nav-link">Support Vue</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/support-vuejs/#One-time-Donations" class="nav-link">One-time Donations</a></li>
    <li><a href="/support-vuejs/#Recurring-Pledges" class="nav-link">Recurring Pledges</a></li>
    <li><a href="https://vue.threadless.com" target="_blank" rel="noopener" class="nav-link">T-Shirt Shop</a></li>
  </ul>
</li>

<li class="nav-dropdown-container language">
  <a class="nav-link">Translations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a target="_blank" rel="noopener" href="https://cn.vuejs.org/mysql/other.html" class="nav-link">中文</a></li>
    <li><a target="_blank" rel="noopener" href="https://jp.vuejs.org/mysql/other.html" class="nav-link">日本語</a></li>
    <li><a target="_blank" rel="noopener" href="https://ru.vuejs.org/mysql/other.html" class="nav-link">Русский</a></li>
    <li><a target="_blank" rel="noopener" href="https://kr.vuejs.org/mysql/other.html" class="nav-link">한국어</a></li>
    <li><a target="_blank" rel="noopener" href="https://br.vuejs.org/mysql/other.html" class="nav-link">Português</a></li>
    <li><a target="_blank" rel="noopener" href="https://fr.vuejs.org/mysql/other.html" class="nav-link">Français</a></li>
    <li><a target="_blank" rel="noopener" href="https://vi.vuejs.org/mysql/other.html" class="nav-link">Tiếng Việt</a></li>
    <li><a target="_blank" rel="noopener" href="https://es.vuejs.org/mysql/other.html" class="nav-link">Español</a></li>
    <li><a target="_blank" rel="noopener" href="https://docs.vuejs.id/mysql/other.html" class="nav-link">Bahasa Indonesia</a></li>
  </ul>
</li>


    </ul>
  </header>
</div>

    
      <div id="main" class="fix-sidebar">
        
  

<div class="sidebar">
  <div class="sidebar-inner">
    
    <div class="list">
      <!-- <div id="sidebar-sponsors-special">
  <div class="main-sponsor">
    <span>Special Sponsor</span>
    <div>
    <a href="https://autocode.com/" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/autocode.svg" alt="Autocode">
    </a>
    </div>
  </div>
</div>

 -->
      
        <!-- <h2>
          
          API
          
            <select class="version-select">
              <option value="v3">3.x</option>
              <option value="SELF" selected>2.x</option>
              <option value="v1">1.0</option>
              <option value="012">0.12</option>
              <option value="011">0.11</option>
            </select>
          
        </h2> -->
        <ul class="menu-root">
  
</ul>

      
    </div>
  </div>
</div>
<!-- 
<div id="sidebar-sponsors-platinum-right">
  <div class="main-sponsor">
    <span>Platinum Sponsors</span>
    <div>
    <a href="https://vueschool.io/?utm_source=Vuejs.org&utm_medium=Banner&utm_campaign=Sponsored%20Banner&utm_content=V1" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/vueschool.png" alt="VueSchool">
    </a>
    <a href="https://vehikl.com/" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/vehikl.png" alt="Vehikl">
    </a>
    <a href="https://retool.com/?utm_source=sponsor&utm_campaign=vue" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/retool.png" alt="Retool">
    </a>
    <a href="https://passionatepeople.io/" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/passionate_people.png" alt="Passionate People">
    </a>
    <a href="https://www.storyblok.com" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/storyblok.png" alt="Storyblok">
    </a>
    <a href="https://ionicframework.com/vue?utm_source=partner&utm_medium=referral&utm_campaign=vuesponsorship&utm_content=vuedocs" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/ionic.png" alt="Ionic">
    </a>
    <a href="https://nuxtjs.org/" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/nuxt.png" alt="Nuxt">
    </a>
    </div>
  </div>
  <a class="become-backer" href="/support-vuejs">
    Become a Sponsor
  </a>
</div>

 -->


<div class="content api with-sidebar ">
  <p class="tip warning v3-warning">
    Welcome to yanliang's notes.
  </p>

  
    
      
<div id="ad">
  <script
    async
    type="text/javascript"
    src="//cdn.carbonads.com/carbon.js?serve=CEBDT27Y&placement=vuejsorg"
    id="_carbonads_js">
  </script>
</div>


    
  
  
    <h1>Mysql 常见问题</h1>
  
  
    <h2 id="数据库三范式是什么"><a href="#数据库三范式是什么" class="headerlink" title="数据库三范式是什么?"></a>数据库三范式是什么?</h2><p>设计关系型数据库时，需要遵从不同的规范，设计合理的关系型数据库，不同的规范被称为不同的范式，各种范式呈递次规范，越高的范式数据库冗余约小。在关系型数据库中有六中范式：第一范式（1NF），第二范式（2NF），第三范式（3NF），BCNF，第四范式（4NF），第五范式(5NF)。一般数据库设计到第三范式就行了。</p>
<p><strong>第一范式</strong></p>
<p>确保数据表中每列（字段）的原子性。如果数据表中每个字段都是不可再分的最小数据单元，则满足第一范式。</p>
<blockquote>
<p>例如：user用户表，包含字段id,username,password</p>
</blockquote>
<p><strong>第二范式</strong></p>
<p>在第一范式的基础上更进一步，目标是确保表中的每列都和主键相关。如果一个关系满足第一范式，并且除了主键之外的其他列，都依赖于该主键，则满足第二范式。</p>
<blockquote>
<p>例如：一个用户只有一种角色，而一个角色对应多个用户。则可以按如下方式建立数据表关系，使其满足第二范式。</p>
<p>user用户表，字段id,username,password,role_id</p>
<p>role角色表，字段id,name</p>
<p>用户表通过角色id（role_id）来关联角色表</p>
</blockquote>
<p><strong>第三范式</strong></p>
<p>在第二范式的基础上更进一步，确保表中的列都和主键直接相关，而不是间接相关。</p>
<blockquote>
<p>例如：一个用户可以对应多个角色，一个角色也可以对应多个用户。则可以按如下方式建立数据表关系，使其满足第三范式。</p>
<p>user用户表，字段id,username,password</p>
<p>role角色表，字段id,name</p>
<p>user_role用户-角色中间表，id,user_id,role_id</p>
<p>像这样，通过第三张表（中间表）来建立用户表和角色表之间的关系，同时又符合范式化的原则，就可以称为第三范式。</p>
</blockquote>
<h2 id="范式和反范式的优缺点"><a href="#范式和反范式的优缺点" class="headerlink" title="范式和反范式的优缺点"></a>范式和反范式的优缺点</h2><p><strong>反范式：</strong>违反范式规则的数据库设计理念</p>
<p>范式的优点和缺点：</p>
<ul>
<li>范式化的更新操作通常比反范式化要快</li>
<li>当数据较好的范式化时，就只有很少或没有重复数据，所有只需要修改更少的数据</li>
<li>范式化的表通常更小，可以更好的存放在内存中，所以执行操作会更快</li>
<li>很少有多余的数据意味着检索列表数据时更少需要distinct或者group by 语句</li>
<li><strong>优点总结：</strong> 范式化的有点就是表通常较小，导致更新和检索速度较快，而且遵循范式的表一般很少或没有重复数据。</li>
<li><strong>缺点：</strong>是通常表需要关联，稍微复杂一些的查询语句在符合范式的表上都可能需要至少一次的关联，可能会更多。这不但代价昂贵，也可能是一些索引策略无效。</li>
</ul>
<p>反范式的优点和缺点：</p>
<ul>
<li>反范式化的表因为所有的数据都在一张表中，可以很好的避免关联</li>
<li>如果不需要关联表，则对大部分查询最差的情况－即使表没有使用索引－是全表扫描。当数据比内存大时这可能比关联要快得多，因为这样避免了随机I/O。</li>
<li>关联会使的，在执行数据库语句时，使得需要在一个索引中又排序又过滤。如果采用反范式化组织数据将两张表的字段合并一下，并且增加一个索引，就可以不通过关联写出这个查询。</li>
<li>表格内的冗余较多，删除数据时候会造成表有些有用的信息丢失。</li>
</ul>
<p>混用范式化和反范式化</p>
<ul>
<li>完全范式和完全反范式在实际的开发中几乎不存在。</li>
<li>最常见的反范式化数据的方法是复制或者缓存，在不同的表中存储相同的特定列。在MySQL5.0和更新版中，可以使用触发器更新缓存值，这使得实现这样的方案变得更简单。</li>
<li>另一个从父表冗余一些数据到子表的理由是排序的需要</li>
<li>缓存衍生值也是有用的；就是说对于一些数量统计显示，可以单独设定一个子查询来计算并显示或者在主表中建立一个统计字段保存和更新这个值</li>
</ul>
<h2 id="varchar和char-的区别"><a href="#varchar和char-的区别" class="headerlink" title="varchar和char 的区别"></a>varchar和char 的区别</h2><p>char是一种固定长度的类型，varchar则是一种可变长度的类型。</p>
<p>它们的区别是： char(M)类型的数据列里，每个值都占用M个字节，如果某个长度小于M，MySQL就会在它的右边用空格字符补足（在检索操作中那些填补出来的空格字符将被去掉）。在varchar(M)类型的数据列里，每个值只占用刚好够用的字节再加上一个用来记录其长度的字节（即总长度为L+1字节）．</p>
<p><strong>在mysql中,char和varchar都表示字符串类型.但他们存储和检索数据的方式并不相同.</strong></p>
<blockquote>
<p>在表结构定义中声明char和varchar类型时,必须指定字符串的长度.也就是该列所能存储多少个字符<strong>（不是字节,是字符）.例如：char(10)和varchar(10)都能存储10个字符.</strong></p>
<p>声明为char的列长度是固定的,char的长度可选范围在0-255之间.也就是char最大能存储255个字符.如果该列是utf8编码,则该列所占用的字节数=字符数<em>3。如果是gbk编码则该列所占用的字节数=字符数</em>2.</p>
<p>声明为varchar的列长度是可变的,在mysql5.0.3之前varchar的长度范围为0-255,mysql5.0.3之后varchar的长度范围为0-65535个字节.采用varchar类型存储数据需要1-2个字节(长度超过255时需要2个字节)来存储字符串的实际长度.如果该列的编码为gbk,每个字符最多占用2个字节,最大长度不能超过32766个字符.如果该列的编码为utf8,每个字符最多占3个字节,最大字符长度为21845.</p>
</blockquote>
<p><strong>总结：</strong></p>
<ol>
<li>char和varchar最大的不同就是一个是固定长度,一个是可变长度.由于是可变长度,因此存储的是实际字符串再加上一个记录字符串长度的字节。如果分配给char或varchar列的值超过 列的最大长度,则对值进行裁剪。</li>
<li>varchar(M)和char(M),M都表示字符数.varchar的最大长度为65535个字节,不同的编码所对应的最大可存储的字符数不同.char最多可以存放255个字符,不同的编码最大可用字节数不同.</li>
</ol>
<h2 id="length-与char-length"><a href="#length-与char-length" class="headerlink" title="length()与char_length()"></a>length()与char_length()</h2><ul>
<li><p>length():Return the length of a string in bytes.返回字符串所占的字节数(受编码影响).</p>
</li>
<li><p>char_length():Return number of characters in argument.返回字符串中的字符数.</p>
</li>
</ul>
<h2 id="myisam-和-innodb-的区别？"><a href="#myisam-和-innodb-的区别？" class="headerlink" title="myisam 和 innodb 的区别？"></a>myisam 和 innodb 的区别？</h2><p><strong>事务和外键</strong></p>
<ul>
<li>InnoDB支持事务和外键，具有安全性和完整性，适合大量insert或update操作</li>
<li>MyISAM不支持事务和外键，它提供高速存储和检索，适合大量的select查询操作</li>
</ul>
<p><strong>锁机制</strong></p>
<ul>
<li>InnoDB支持行级锁，锁定指定记录。<strong>基于索引来加锁实现。</strong></li>
<li>MyISAM支持表级锁，锁定整张表。</li>
</ul>
<p><strong>索引结构</strong></p>
<ul>
<li>InnoDB使用聚集索引（聚簇索引），索引和记录在一起存储，既缓存索引，也缓存记录。</li>
<li>MyISAM使用非聚集索引（非聚簇索引），索引和记录分开。</li>
</ul>
<p><strong>并发处理能力</strong></p>
<ul>
<li>MyISAM使用表锁，会导致写操作并发率低，读之间并不阻塞，读写阻塞。</li>
<li>InnoDB读写阻塞可以与隔离级别有关，可以采用多版本并发控制（MVCC）来支持高并发</li>
</ul>
<p><strong>存储文件</strong></p>
<ul>
<li>InnoDB表对应两个文件，一个.frm表结构文件，一个.ibd数据文件。InnoDB表最大支持64TB；</li>
<li>MyISAM表对应三个文件，一个.frm表结构文件，一个MYD表数据文件，一个.MYI索引文件。从MySQL5.0开始默认限制是256TB。</li>
</ul>
<h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><p><strong>MyISAM</strong></p>
<ul>
<li>不需要事务支持（不支持）</li>
<li>并发相对较低（锁定机制问题）</li>
<li>数据修改相对较少，以读为主</li>
<li>数据一致性要求不高</li>
</ul>
<p><strong>InnoDB</strong>  </p>
<ul>
<li>需要事务支持（具有较好的事务特性）</li>
<li>行级锁定对高并发有很好的适应能力</li>
<li>数据更新较为频繁的场景</li>
<li>数据一致性要求较高</li>
<li>硬件设备内存较大，可以利用InnoDB较好的缓存能力来提高内存利用率，减少磁盘IO</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>两种引擎该如何选择？</p>
<p>是否需要事务？有，InnoDB</p>
<p>是否存在并发修改？有，InnoDB</p>
<p>是否追求快速查询，且数据修改少？是，MyISAM</p>
<p>在绝大多数情况下，推荐使用InnoDB</p>
<h2 id="关系型和非关系型数据库的区别"><a href="#关系型和非关系型数据库的区别" class="headerlink" title="关系型和非关系型数据库的区别"></a>关系型和非关系型数据库的区别</h2><p>关系型数据库是简单的表结构，优点：易于维护，使用方便，直接用sql语句进行查询，支持复杂的多表的连接查询；缺点：读写性能差，尤其是面对海量数据的高效率读写；固定的表结构，灵活性差；高并发读写需求，面临硬盘I/O的瓶颈</p>
<p>非关系型数据库：（包括四种：键值存储数据库Redis，列存储数据库HBase，文档数据库MongoDB CoachDB，图形数据库IinforGrid）优点：格式灵活，支持以上四种格式；速度快；扩展性好；容易部署。缺点：不支持事务，不支持sql，不利于对复杂的查询</p>
<h2 id="数据库连接池的作用"><a href="#数据库连接池的作用" class="headerlink" title="数据库连接池的作用"></a>数据库连接池的作用</h2><p><strong>为什么会出现连接池：</strong> 在操作数据库的时候，可能会出现频繁的建立连接、关闭连接的情况。这样会大大降低系统的性能。</p>
<p><strong>连接池：</strong> 资源池是为了解决资源频繁分配和释放所造成的问题而出现的，应用在数据库管理领域就是建立一个数据库的连接池，当需要建立连接时，调用getConnection方法获得连接；当使用完毕时，通过releaseConnection方法直接返回，并不是释放连接，只是由连接池收回，以便下一次使用。</p>
<p><strong>作用：</strong></p>
<ul>
<li>资源复用：数据库的连接得到了重用，避免了频繁的创建连接、释放连接引起的性能开销。在减少系统消耗的基础上，也增进了系统运行环境的平稳性。</li>
<li>更快的响应速度：数据库连接池在初始化的过程中，往往已经建立了若干数据库连接置于池中备用。此时连接的初始化工作已经完成。对于业务请求而言，直接利用现有的可用连接，避免了数据库连接初始化和释放过程的时间，从而缩短了系统整体响应的时间。</li>
<li>统一的连接管理，避免了数据库连接泄漏：在较完备的数据库连接池实现中，可以根据预先的连接占用超时设定，强制收回被占用的连接。从而避免了常规数据库连接操作中可能出现的资源泄露。</li>
</ul>
<h2 id="如何查看空闲连接列表"><a href="#如何查看空闲连接列表" class="headerlink" title="如何查看空闲连接列表"></a>如何查看空闲连接列表</h2><p>show processlist</p>
<p>下图就是我在⾃⼰的数据库表执⾏命令的结果，其中的Command列显示为Sleep 的这⼀⾏，就表示现在系统⾥⾯有⼀个空闲连接。</p>
<p><img src="../img/mysql/27.png"></p>
<p>这⾥需要注意的是，我们数据库的客户端太久没响应，连接器就会⾃动断开了，这个时间参数 是wait_timeout控制住的，默认时⻓为8⼩时。 </p>
<p>断开后重连的时候会报错，如果你想再继续操作，你就需要重连了。</p>
<h3 id="那除了重新链接，还有别的⽅式么？"><a href="#那除了重新链接，还有别的⽅式么？" class="headerlink" title="那除了重新链接，还有别的⽅式么？"></a>那除了重新链接，还有别的⽅式么？</h3><p>使⽤⻓连接。 </p>
<p>但是这⾥有个缺点，使⽤⻓连接之后，内存会飙得很快，我们知道MySQL在执⾏过程中临时使⽤的内存 是管理在连接对象⾥⾯的。 </p>
<p>只有在链接断开的时候才能得到释放，那如果⼀直使⽤⻓连接，那就会导致OOM（Out Of Memory）， 会导致MySQL重启，在JVM⾥⾯就会导致频繁的Full GC。</p>
<p>也可以，定期断开⻓连接，使⽤⼀段时间后，或者程序⾥⾯判断执⾏过⼀个占⽤内存⽐较⼤的查询后就 断开连接，需要的时候重连就好了。</p>
<p>或者，执⾏⽐较⼤的⼀个查询后，执⾏mysql_reset_connection可以重新初始化连接资源。这个过程相⽐上 ⾯⼀种会好点，不需要重连，但是会初始化连接的状态。</p>
<h2 id="Mysql-如何查看你的-sql-执行情况"><a href="#Mysql-如何查看你的-sql-执行情况" class="headerlink" title="Mysql 如何查看你的 sql 执行情况"></a>Mysql 如何查看你的 sql 执行情况</h2><ol>
<li>查看log日志是否开启<br>show variables like ‘general_log’<br>set GLOBAL general_log=’ON’;<br>SET GLOBAL general_log_file = ‘/tmp/mysql.log’<br>不使用的时候记得关掉，否则会大量占用磁盘空间。</li>
<li>show processlist命令查看了当前正在执行的sql语句,同时可以查看用户的当前连接</li>
<li>查看慢日志<br>show variables like ‘%slow_query_log%’;<br>show variables like ‘long_query_time%’;设置慢日志记录什么样的SQL，默认10s<br>log-queries-not-using-indexes：未使用索引的查询也被记录到慢查询日志中,一般也开启这个变量</li>
<li>show status查看mysql运行状态（to learn）<br>比如查看mysql中有多少条慢查询记录： show global status like ‘%Slow_queries%’;</li>
</ol>
<h2 id="数据库连接的几种常用方式"><a href="#数据库连接的几种常用方式" class="headerlink" title="数据库连接的几种常用方式"></a>数据库连接的几种常用方式</h2><p><img src="../img/mysql/19.png"></p>
<p>了解：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/67472219">https://zhuanlan.zhihu.com/p/67472219</a></p>
<h2 id="如何高效处理大库DDL"><a href="#如何高效处理大库DDL" class="headerlink" title="如何高效处理大库DDL"></a>如何高效处理大库DDL</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mysql-dba/p/6192897.html">https://www.cnblogs.com/mysql-dba/p/6192897.html</a></p>
<h2 id="Mysql-视图"><a href="#Mysql-视图" class="headerlink" title="Mysql 视图"></a>Mysql 视图</h2><p>视图是一个虚拟表，是从数据库中一个或多个表中导出来的表，其内容由查询定义。同真实表一样，视图包含一系列带有名称的列和行数据。但是，数据库中只存放了视图的定义，而并没有存放视图中的数据。这些数据存放在原来的表中。使用视图查询数据时，数据库系统会从原来的表中取出对应的数据。因此，视图中的数据是依赖于原来的表中的数据的。一旦表中的数据发生改变，显示在视图中的数据也会发生改变。</p>
<p>视图是存储在数据库中的查询的SQL语句，它主要出于两种原因：安全原因，视图可以隐藏一些数据，例如，员工信息表，可以用视图只显示姓名、工龄、地址，而不显示社会保险号和工资数等；另一个原因是可使复杂的查询易于理解和使用。</p>
<h3 id="视图的作用"><a href="#视图的作用" class="headerlink" title="视图的作用"></a>视图的作用</h3><p>对其中所引用的基础表来说，视图的作用类似于筛选。定义视图的筛选可以来自当前或其他数据库的一个或多个表，或者其他视图。通过视图进行查询没有任何限制，通过它们进行数据修改时的限制也很少。视图的作用归纳为如下几点。</p>
<h4 id="简单性"><a href="#简单性" class="headerlink" title="简单性"></a>简单性</h4><p>看到的就是需要的。视图不仅可以简化用户对数据的理解，也可以简化他们的操作。那些被经常使用的查询可以被定义为视图，从而使得用户不必为以后的操作每次指定全部的条件。</p>
<h4 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h4><p>视图的安全性可以防止未授权用户查看特定的行或列，使有权限用户只能看到表中特定行的方法，如下：</p>
<p>（1）在表中增加一个标志用户名的列。</p>
<p>（2）建立视图，使用户只能看到标有自己用户名的行。</p>
<p>（3）把视图授权给其他用户。</p>
<h4 id="逻辑数据独立性"><a href="#逻辑数据独立性" class="headerlink" title="逻辑数据独立性"></a>逻辑数据独立性</h4><p>视图可以使应用程序和数据库表在一定程度上独立。如果没有视图，程序一定是建立在表上的。有了视图之后，程序可以建立在视图之上，从而程序与数据库表被视图分割开来。视图可以在以下几个方面使程序与数据独立。</p>
<p>（1）如果应用建立在数据库表上，当数据库表发生变化时，可以在表上建立视图，通过视图屏蔽表的变化，从而使应用程序可以不动。</p>
<p>（2）如果应用建立在数据库表上，当应用发生变化时，可以在表上建立视图，通过视图屏蔽应用的变化，从而使数据库表不动。</p>
<p>（3）如果应用建立在视图上，当数据库表发生变化时，可以在表上修改视图，通过视图屏蔽表的变化，从而使应用程序可以不动。</p>
<p>（4）如果应用建立在视图上，当应用发生变化时，可以在表上修改视图，通过视图屏蔽应用的变化，从而使数据库可以不动。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/pan_junbiao/article/details/86132535">https://blog.csdn.net/pan_junbiao/article/details/86132535</a></p>
<h2 id="mysql中查看sql执行情况的几种方法"><a href="#mysql中查看sql执行情况的几种方法" class="headerlink" title="mysql中查看sql执行情况的几种方法"></a>mysql中查看sql执行情况的几种方法</h2><ol>
<li><p>查看log日志是否开启<br>show variables like ‘general_log’<br>set GLOBAL general_log=’ON’;<br>SET GLOBAL general_log_file = ‘/tmp/mysql.log’<br>不使用的时候记得关掉，否则会大量占用磁盘空间。</p>
</li>
<li><p>show processlist命令查看了当前正在执行的sql语句,同时可以查看用户的当前连接</p>
</li>
<li><p>查看慢日志<br>show variables like ‘%slow_query_log%’;<br>show variables like ‘long_query_time%’;设置慢日志记录什么样的SQL，默认10s<br>log-queries-not-using-indexes：未使用索引的查询也被记录到慢查询日志中,一般也开启这个变量</p>
</li>
<li><p>show status查看mysql运行状态（to learn）<br>比如查看mysql中有多少条慢查询记录： show global status like ‘%Slow_queries%’;</p>
</li>
<li><p>查看sql的执行时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">show profiles;</span><br><span class="line"></span><br><span class="line">-- 查看profiles功能是否开启</span><br><span class="line">select @@profiling;</span><br><span class="line"></span><br><span class="line">-- 开启profiles功能</span><br><span class="line">set profiling&#x3D;1;</span><br><span class="line"></span><br><span class="line">+----------+------------+----------------------------+</span><br><span class="line">| Query_ID | Duration   | Query                      |</span><br><span class="line">+----------+------------+----------------------------+</span><br><span class="line">|        1 | 0.00173700 | select * from ip           |</span><br><span class="line">|        2 | 0.00057500 | select porxy, port from ip |</span><br><span class="line">+----------+------------+----------------------------+</span><br></pre></td></tr></table></figure></li>
<li><p>查看sql执行耗时详细信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">show profile for query Query_ID;</span><br><span class="line">+----------------------+----------+</span><br><span class="line">| Status               | Duration |</span><br><span class="line">+----------------------+----------+</span><br><span class="line">| starting             | 0.000073 |</span><br><span class="line">| checking permissions | 0.000031 |   ---检查是否在缓存中  </span><br><span class="line">| Opening tables       | 0.000207 |   ---打开表</span><br><span class="line">| init                 | 0.000067 |   ---初始化</span><br><span class="line">| System lock          | 0.000040 |   ---锁系统</span><br><span class="line">| optimizing           | 0.000005 |   ---优化查询</span><br><span class="line">| statistics           | 0.000021 |</span><br><span class="line">| preparing            | 0.000015 |   ---准备</span><br><span class="line">| executing            | 0.000003 |   ---执行</span><br><span class="line">| Sending data         | 0.000993 |</span><br><span class="line">| end                  | 0.000006 |</span><br><span class="line">| query end            | 0.000007 |</span><br><span class="line">| closing tables       | 0.000011 |</span><br><span class="line">| freeing items        | 0.000169 |</span><br><span class="line">| cleaning up          | 0.000089 |</span><br><span class="line">+----------------------+----------+</span><br></pre></td></tr></table></figure></li>
<li><p>sql 执行情况分析</p>
<p>使用explain分析sql执行情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">explain select * from ip;</span><br><span class="line"></span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------+</span><br><span class="line">|  1 | SIMPLE      | ip    | ALL  | NULL          | NULL | NULL    | NULL |  400 | NULL  |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------+</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">select_type</th>
<th align="left">table</th>
<th align="left">type</th>
<th align="left">possible_keys</th>
<th align="left">key</th>
<th align="left">key_len</th>
<th align="left">rows</th>
<th align="left">Extra</th>
</tr>
</thead>
<tbody><tr>
<td align="left">表示查询的类型</td>
<td align="left">输出结果集的表</td>
<td align="left">表示表的连接类型</td>
<td align="left">表示查询时，可能使用的索引</td>
<td align="left">表示实际使用的索引</td>
<td align="left">索引字段的长度</td>
<td align="left">扫描出的行数(估算的行数)</td>
<td align="left">执行情况的描述和说明</td>
</tr>
</tbody></table>
</li>
</ol>
<h2 id="mysql-外键优缺点"><a href="#mysql-外键优缺点" class="headerlink" title="mysql 外键优缺点"></a>mysql 外键优缺点</h2><p><strong>优点：</strong></p>
<p>设置外键可以保证数据的完整性与关联性，杜绝数据冗余</p>
<p>级联操作方便，比如涉及一个离职用户的所有相关信息，可以直接删除这个用户就能做到所有信息一起删除的操作</p>
<p><strong>缺点：</strong></p>
<p>主表进行修改或变更，会波及一大片从表，顿时会使公司部分业务处于不可用的状态，不利中小公司的设计，一般中小型公司都没有dba，开发人员对数据库了解的不够深，容易误操作，所以建议不用使用过多的外键来操作相关业务表</p>
<p>而且对于insert,  update,  delete等操作时都会先检查外键的约束条件再操作，性能有所下降</p>
<p><strong>结论：</strong></p>
<ol>
<li>在大型系统中（性能要求不高，安全要求高），使用外键；在大型系统中（性能要求高，安全自己控制），不用外键；小系统随便，最好用外键。</li>
<li>用外键要适当，不能过分追求</li>
<li>不用外键而用程序控制数据一致性和完整性时，应该写一层来保证，然后个个应用通过这个层来访问数据库。</li>
</ol>
<h2 id="like-和-regexp-的区别"><a href="#like-和-regexp-的区别" class="headerlink" title="like 和 regexp 的区别"></a>like 和 regexp 的区别</h2><p><code>like</code> 整个字段匹配表达式成功才返回</p>
<p><code>regexp</code> 部分字符匹配表达式成功即可返回</p>
<p>LIKE匹配整个列。如果被匹配的文本在列值 中出现，LIKE将不会找到它，相应的行也不被返回（除非使用 通配符）。而REGEXP在列值内进行匹配，如果被匹配的文本在 列值中出现，REGEXP将会找到它，相应的行将被返回。</p>
<h2 id="truncate-delete-drop的区别"><a href="#truncate-delete-drop的区别" class="headerlink" title="truncate delete drop的区别"></a>truncate delete drop的区别</h2><p>drop(DDL 语句)：是不可逆操作，会将表所占用空间全部释放掉；</p>
<p>truncate(DDL 语句)：只针对于删除表的操作，在删除过程中不会激活与表有关的删 除触发器并且不会把删除记录放在日志中；当表被 truncate 后，这个表和索引会恢 复到初始大小； </p>
<p>delete(DML 语句)：可以删除表也可以删除行，但是删除记录会被计入日志保存， 而且表空间大小不会恢复到原来；</p>
<p>执行速度：drop&gt;truncate&gt;delete。</p>
<h2 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h2><p>SQL注入是比较常见的网络攻击方式之一，它不是利用操作系统的BUG来实现攻击，而是针对程序员编程时的疏忽，通过SQL语句，实现无帐号登录，甚至篡改数据库。</p>
<ol>
<li><p>永远不要信任用户的输入，要对用户的输入进行校验，可以通过正则表达式，或限制长度，对单引号和双”-“进行转换等。</p>
</li>
<li><p>永远不要使用动态拼装SQL，可以使用参数化的SQL或者直接使用存储过程进行数据查询存取。</p>
</li>
<li><p>永远不要使用管理员权限的数据库连接，为每个应用使用单独的权限有限的数据库连接。</p>
</li>
<li><p>不要把机密信息明文存放，请加密或者hash掉密码和敏感的信息。</p>
</li>
<li><p>应用的异常信息应该给出尽可能少的提示，最好使用自定义的错误信息对原始错误信息进行包装，把异常信息存放在独立的表中。</p>
</li>
</ol>
<p>Java我们用PreparedStatement</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String sql&#x3D; &quot;select * from users where username&#x3D;? and password&#x3D;?;</span><br><span class="line">   PreparedStatement preState &#x3D; conn.prepareStatement(sql);</span><br><span class="line">   preState.setString(1, userName);</span><br><span class="line">   preState.setString(2, password);</span><br><span class="line">   ResultSet rs &#x3D; preState.executeQuery();</span><br></pre></td></tr></table></figure>

<p>或者，我们可以用正则，把 有 单引号(‘)，分号(;) 和 注释符号(–)的语句给替换掉来防止SQL注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return str.replaceAll(&quot;.*([&#39;;]+|(--)+).*&quot;, &quot; &quot;);</span><br></pre></td></tr></table></figure>

<p>PreparedStatement防止sql注入原理：<a target="_blank" rel="noopener" href="https://blog.csdn.net/czh500/article/details/78830636">https://blog.csdn.net/czh500/article/details/78830636</a></p>
<p><img src="../img/mysql/20.png"></p>
<p>SQL注入验证：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/078df7a35671">https://www.jianshu.com/p/078df7a35671</a></p>
<h2 id="Mysql-函数"><a href="#Mysql-函数" class="headerlink" title="Mysql 函数"></a>Mysql 函数</h2><p>数学函数</p>
<ul>
<li>Abs（num）求绝对值 </li>
<li>floor（num）向下取整 </li>
<li>ceil（num）向上取整</li>
</ul>
<p>字符串函数</p>
<ul>
<li>insert (s1,index,length,s2) 替换函数 <ul>
<li>S1 表示被替换的字符串</li>
<li>s2 表示将要替换的字符串 </li>
<li>Index 表示被替换的位置, 从 1 开始 </li>
<li>Lebgth 表示被替换的长度 </li>
</ul>
</li>
<li>upper（str），ucase（str）将字母改为大写 </li>
<li>lower（str），lcase（str）将字母改为小写 </li>
<li>left（str，length）返回 str 字符串的前 length 个字符 </li>
<li>right（str，length）返回 str 字符串的后 length 个字符 </li>
<li>substring（str，index，length）返回 str 字符串从 index 位开始长度为 length 个字符（index 从 1 开始） </li>
<li> reverse（str）将 str 字符串倒序输出</li>
</ul>
<p>日期函数</p>
<ul>
<li>curdate（）、current_date( ) 获取当前日期</li>
<li>curtime（）、current_time( ) 获取当前日期</li>
<li>now（）获取当前日期和时间 </li>
<li>datediff（d1、d2）d1 和 d2 之间的天数差 </li>
<li>adddate（date，num）返回 date 日期开始，之后 num 天的日期 </li>
<li>subdate（date，num）返回 date 日期开始，之前 num 天的日期</li>
</ul>
<p>聚合函数</p>
<ul>
<li>Count（字段）根据某个字段统计总记录数（当前数据库保存到多少条数据）</li>
<li>sum（字段）计算某个字段的数值总和</li>
<li>avg（字段）计算某个字段的数值的平均值</li>
<li> Max（字段）、min（字段）求某个字段最大或最小值</li>
</ul>
<h2 id="数据库备份"><a href="#数据库备份" class="headerlink" title="数据库备份"></a>数据库备份</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">以下命令需要在未登录状态下执行</span><br><span class="line"></span><br><span class="line">-- 导出整个数据库</span><br><span class="line">mysqldump -u 用户名 -p 数据库名 &gt; 导出文件名</span><br><span class="line"></span><br><span class="line">-- 导出一个表</span><br><span class="line">mysqldump -u 用户名 -p 数据库名 表名 &gt; 导出文件名</span><br><span class="line"></span><br><span class="line">-- 导出一个数据库结构</span><br><span class="line">mysqldump -u dbuser -p -d --add-drop-table</span><br><span class="line">dbname &gt;d:&#x2F;dbname_db.sql</span><br><span class="line"></span><br><span class="line">-d 没有数据 </span><br><span class="line">--add-drop-table 在每个 create 语句之前增加一个 drop table</span><br></pre></td></tr></table></figure>
<p>=======</p>
<h2 id="关于数据库自增ID"><a href="#关于数据库自增ID" class="headerlink" title="关于数据库自增ID"></a>关于数据库自增ID</h2><p>一张表，里面有 ID 自增主键，当 insert 了 17 条记录之后，删除了第 15,16,17 条记录， 再把 Mysql 重启，再 insert 一条记录，这条记录的 ID 是 18 还是 15 ？</p>
<ul>
<li>如果表的类型是 MyISAM，那么是 18 因为 MyISAM 表会把自增主键的最大 ID 记录到数据文件里，重启 MySQL 自增主键的最大 ID 也不会丢失 </li>
<li>如果表的类型是 InnoDB，那么是 15 InnoDB 表只是把自增主键的最大 ID 记录到内存中，所以重启数据库或者是对表进行 OPTIMIZE 操作，都会导致最大 ID 丢失</li>
</ul>
<h2 id="与-Oracle-相比，Mysql-有什么优势？"><a href="#与-Oracle-相比，Mysql-有什么优势？" class="headerlink" title="与 Oracle 相比，Mysql 有什么优势？"></a>与 Oracle 相比，Mysql 有什么优势？</h2><ul>
<li>Mysql 是开源软件，随时可用，无需付费。 </li>
<li>Mysql 是便携式的。操作简单、部署方便</li>
<li>带有命令提示符的 GUI。 </li>
<li>Mysql 的引擎是插件式</li>
</ul>
<h2 id="mysql中float、double、decimal的区别"><a href="#mysql中float、double、decimal的区别" class="headerlink" title="mysql中float、double、decimal的区别"></a>mysql中float、double、decimal的区别</h2><p>浮点数以 8 位精度存储在 FLOAT 中，并且有四个字节。 </p>
<p>浮点数存储在 DOUBLE 中，精度为 18 位，有八个字节。</p>
<p>float类型表示单精度浮点数值，double类型表示双精度浮点数值，float和double都是浮点型，而decimal是定点型；</p>
<p>MySQL 浮点型和定点型可以用类型名称后加（M，D）来表示，M表示该值的总共长度，D表示小数点后面的长度，M和D又称为精度和标度，如float(5,2)的 可显示为999.99，MySQL保存值时会进行四舍五入，如果插入999.009，则结果为999.01。</p>
<p>float和double在不指定精度时，默认会按照实际的精度来显示，而DECIMAL在不指定精度时，默认整数为10，小数为0。</p>
<p>float和double求SUM的结果都是不精确的，只有decimal求SUM得到的是精准数值：</p>
<p>所以，decimal 类型是适合财务和货币计算的128位数据类型。</p>
<h2 id="LENGTH-与CHAR-LENGTH-区别"><a href="#LENGTH-与CHAR-LENGTH-区别" class="headerlink" title="LENGTH()与CHAR_LENGTH()区别"></a>LENGTH()与CHAR_LENGTH()区别</h2><p>无论是LENGTH()还是CHAR_LENGTH()都是为了统计字符串的长度。只不过，LENGTH()是按照字节来统计的，CHAR_LENGTH()是按照字符来统计的。例如：一个包含5个字符且每个字符占两个字节的字符串而言，LENGTH()返回长度10，CHAR_LENGTH()返回长度是5；如果对于单字节的字符，则两者返回结果相同。</p>
<h2 id="mysql-和-oracle-的区别"><a href="#mysql-和-oracle-的区别" class="headerlink" title="mysql 和 oracle 的区别"></a>mysql 和 oracle 的区别</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bailing80/p/11440927.html">https://www.cnblogs.com/bailing80/p/11440927.html</a></p>
<p><strong>(1) 对事务的提交</strong></p>
<p>   MySQL 默认是自动提交，而 Oracle 默认不自动提交，需要用户手动提交</p>
<p><strong>(2) 分页查询</strong></p>
<p>   MySQL 是直接在 SQL 语句中写 “select… from …where…limit x, y”, 有 limit 就可以实现分页; 而 Oracle 则是需要用到伪列 ROWNUM 和嵌套查询</p>
<p><strong>(3) 事务隔离级别</strong></p>
<p>​    MySQL 是 read commited 的隔离级别，而 Oracle 是 repeatable read 的隔离级别，同时二者都支持 serializable 串行化事务隔离级别，可以实现最高级别的</p>
<p><strong>(4) 对事务的支持</strong></p>
<p>   MySQL 在 innodb 存储引擎的行级锁的情况下才可支持事务，而 Oracle 则完全支持事务</p>
<p><strong>(5) 保存数据的持久性</strong></p>
<p>   MySQL 是在数据库更新或者重启，则会丢失数据，Oracle 把提交的 sql 操作线写入了在线联机日志文件中，保持到了磁盘上，可以随时恢复</p>
<p><strong>(6) 并发性</strong></p>
<p>   MySQL 以表级锁为主，对资源锁定的粒度很大，如果一个 session 对一个表加锁时间过长，会让其他 session 无法更新此表中的数据。</p>
<p> 虽然 InnoDB 引擎的表可以用行级锁，但这个行级锁的机制依赖于表的索引，如果表没有索引，或者 sql 语句没有使用索引，那么仍然使用表级锁。</p>
<p> Oracle 使用行级锁，对资源锁定的粒度要小很多，只是锁定 sql 需要的资源，并且加锁是在数据库中的数据行上，不依赖与索引。所以 Oracle 对并</p>
<p> 发性的支持要好很多。</p>
<p><strong>(7) 逻辑备份</strong></p>
<p>   MySQL 逻辑备份时要锁定数据，才能保证备份的数据是一致的，影响业务正常的 dml 使用, Oracle 逻辑备份时不锁定数据，且备份的数据是一致</p>
<p><strong>(8) 复制</strong></p>
<p>   MySQL: 复制服务器配置简单，但主库出问题时，丛库有可能丢失一定的数据。且需要手工切换丛库到主库。</p>
<p>   Oracle: 既有推或拉式的传统数据复制，也有 dataguard 的双机或多机容灾机制，主库出现问题是，可以自动切换备库到主库，但配置管理较复杂。</p>
<p><strong>(9) 性能诊断</strong></p>
<p>   MySQL 的诊断调优方法较少，主要有慢查询日志。</p>
<p>   Oracle 有各种成熟的性能诊断调优工具，能实现很多自动分析、诊断功能。比如 awr、addm、sqltrace、tkproof 等   </p>
<p><strong>(10) 权限与安全</strong></p>
<p>   MySQL 的用户与主机有关，感觉没有什么意义，另外更容易被仿冒主机及 ip 有可乘之机。</p>
<p>   Oracle 的权限与安全概念比较传统，中规中矩。</p>
<p><strong>(11) 分区表和分区索引</strong></p>
<p>   MySQL 的分区表还不太成熟稳定。</p>
<p>   Oracle 的分区表和分区索引功能很成熟，可以提高用户访问 db 的体验。</p>
<p><strong>(12) 管理工具</strong></p>
<p>   MySQL 管理工具较少，在 linux 下的管理工具的安装有时要安装额外的包（phpmyadmin， etc)，有一定复杂性。</p>
<p>   Oracle 有多种成熟的命令行、图形界面、web 管理工具，还有很多第三方的管理工具，管理极其方便高效。</p>
<p><strong>(13) 最重要的区别</strong></p>
<p>   MySQL 是轻量型数据库，并且免费，没有服务恢复数据。</p>
<p>   Oracle 是重量型数据库，收费，Oracle 公司对 Oracle 数据库有任何服务。</p>
<p><strong>(13)自动增长的数据类型处理</strong></p>
<p>​     MYSQL 有自动增长的数据类型，插入记录时不用操作此字段，会自动获得数据值。ORACLE 没有自动增长的数据类型，需要建立一个自动增长的序列号，插入记录时要把序列号的下一个值赋于此字段。</p>
<p><strong>(14)单引号的处理</strong></p>
<p>​     MYSQL 里可以用双引号包起字符串，ORACLE 里只可以用单引号包起字符串。在插入和修改字符串前必须做单引号的替换：把所有出现的一个单引号替换成两个单引号</p>
<h2 id="Mysql-慢查询"><a href="#Mysql-慢查询" class="headerlink" title="Mysql 慢查询"></a>Mysql 慢查询</h2><h3 id="Mysql-什么情况会造成慢查？"><a href="#Mysql-什么情况会造成慢查？" class="headerlink" title="Mysql 什么情况会造成慢查？"></a>Mysql 什么情况会造成慢查？</h3><p><a target="_blank" rel="noopener" href="https://www.infoq.cn/article/xw54gb1oe6fpxiggch19">https://www.infoq.cn/article/xw54gb1oe6fpxiggch19</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39390545/article/details/109253328">https://blog.csdn.net/qq_39390545/article/details/109253328</a></p>
<p><strong>网络层面</strong></p>
<ul>
<li>网络丢包、重传等</li>
<li>网卡满（传输大字段），网络链路变长</li>
</ul>
<p><strong>IO</strong></p>
<ul>
<li>磁盘IO被其他任务占用</li>
<li>raid 卡 充放电，raid 卡重置</li>
</ul>
<p><strong>数据库层面</strong></p>
<ul>
<li>没有索引，或者没有正确使用索引</li>
<li>隐式转换（发生隐式转换时，MySQL 选择执行计划并不能利用到合适的索引而是选择全表扫描导致慢查询。）</li>
<li>数据量大（符合条件的记录数太多）</li>
<li>数据分布不均匀</li>
<li>表结构设计不合理</li>
<li>innodb 刷脏页</li>
<li>undo 没有被 purge/回收</li>
</ul>
<h2 id="大库-DDL-操作"><a href="#大库-DDL-操作" class="headerlink" title="大库 DDL 操作"></a>大库 DDL 操作</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/frog4/article/details/82702745">https://blog.csdn.net/frog4/article/details/82702745</a></p>
<h2 id="Mysql-应用架构演变"><a href="#Mysql-应用架构演变" class="headerlink" title="Mysql 应用架构演变"></a>Mysql 应用架构演变</h2><p>一个简单的网站架构一般包含以下几层</p>
<p>用户请求 –&gt;应用层 –&gt; 服务层 –&gt; 存储层</p>
<ul>
<li>用户请求–&gt;应用层的优化：nginx + tomcat集群进行优化</li>
<li>应用层–&gt;服务层的优化：分布式，微服务</li>
<li>服务层–&gt;存储层：数据库存储及优化</li>
</ul>
<p>网站在不同的并发访问量和数据量级下，MySQL应用架构的演变过程。</p>
<h3 id="架构V1-0-单机单库"><a href="#架构V1-0-单机单库" class="headerlink" title="架构V1.0 - 单机单库"></a>架构V1.0 - 单机单库</h3><p>一个简单的网站或者应用，背后的架构可以非常简单，数据存储只需要一个MySQL Instance 就能满足数据读取和写入需求（这里忽略掉了数据备份的Instance），处于这个阶段的系统，一般会把所有的信息都存到一个MySQL Instance里面。</p>
<blockquote>
<p>DAL （Data Access Layer）数据访问层</p>
<p>主要功能：负责数据库的访问。简单的说就是实现对数据表的CRUD</p>
</blockquote>
<p><img src="../img/mysql/21.png" alt="image.png"></p>
<h4 id="V1-0-瓶颈"><a href="#V1-0-瓶颈" class="headerlink" title="V1.0 瓶颈"></a>V1.0 瓶颈</h4><ul>
<li>数据量太大，超出一台服务器承受能力范围</li>
<li>读写数据量太大，超出一台服务器承受能力范围</li>
<li>可用性太差，一台服务器挂掉，应用也会挂掉</li>
</ul>
<h3 id="架构V2-0-主从架构"><a href="#架构V2-0-主从架构" class="headerlink" title="架构V2.0 - 主从架构"></a>架构V2.0 - 主从架构</h3><p>V2.0 架构主要解决架构V1.0下的<strong>高可用</strong>和<strong>读扩展</strong>问题，通过给Instance挂载从库解决读取的压力，主库宕机也可以通过主从切换保障高可用。在MySQL的场景下就是通过主从结构（爽主结构也属于特殊的主从结构），主库抗写压力，通过从库来分担读压力，对于写少读多的应用，V2.0主从架构完全能够胜任。</p>
<p><img src="../img/mysql/22.png" alt="image.png"></p>
<h4 id="V2-0-瓶颈"><a href="#V2-0-瓶颈" class="headerlink" title="V2.0 瓶颈"></a>V2.0 瓶颈</h4><ul>
<li>数据量太大，超过一台服务器承受能力范围</li>
<li>写操作太多，超出一台服务器的承受能力范围</li>
</ul>
<h3 id="架构V3-0-分库分表"><a href="#架构V3-0-分库分表" class="headerlink" title="架构V3.0 - 分库分表"></a>架构V3.0 - 分库分表</h3><p>对于V1.0 和 V2.0遇到写入瓶颈和存储瓶颈时，可以通过水平拆分来解决，水平拆分和垂直拆分有较大的区别，垂直拆分完的结果，每个Instance都拥有完整的数据，而水平拆分之后，任何实例都只有全量的 1/n 的数据。下图所示，将UserInfo 拆分为3个Sharding，每个Sharding持有总量的 1/3数据，3个Sharding数据的总和等于一份完整数据。</p>
<p><img src="../img/mysql/23.png" alt="image.png"></p>
<h4 id="V3-0架构的挑战"><a href="#V3-0架构的挑战" class="headerlink" title="V3.0架构的挑战"></a>V3.0架构的挑战</h4><ul>
<li><p>数据如何路由（分片）</p>
</li>
<li><ul>
<li>范围拆分</li>
<li>List 拆分</li>
<li>Hash 拆分</li>
</ul>
</li>
<li><p>数据库一致性</p>
</li>
</ul>
<h3 id="V4-0-云数据库"><a href="#V4-0-云数据库" class="headerlink" title="V4.0 云数据库"></a>V4.0 云数据库</h3><p>云数据库（云计算）现在是各大IT公司内部作为节约成本的一个突破口，对于数据存储的MySQL来说，如何让其成为Saas（Software as a Service）是关键点。MySQL作为一个Saas服务，服务提供商负责解决可配置性，可扩展性，多用户存储结构设计等这些疑难问题。</p>
<p><img src="../img/mysql/24.png" alt="image.png"></p>
<h2 id="Mysql-基础架构"><a href="#Mysql-基础架构" class="headerlink" title="Mysql 基础架构"></a>Mysql 基础架构</h2><p><img src="../img/mysql/25.png"></p>
<h2 id="Mysql-体系架构"><a href="#Mysql-体系架构" class="headerlink" title="Mysql 体系架构"></a>Mysql 体系架构</h2><p>MySQL Server架构自顶向下大致可以分网络连接层、服务层、存储引擎层和系统文件层。</p>
<h3 id="网络连接层"><a href="#网络连接层" class="headerlink" title="网络连接层"></a>网络连接层</h3><p>客户端连接器（Client Connectors）：提供与MySQL服务器建立的支持。目前几乎支持所有主流 的服务端编程技术，例如常见的 Java、C、Python、.NET等，它们通过各自API技术与MySQL建立链接</p>
<h3 id="服务层（MySQL-Server）"><a href="#服务层（MySQL-Server）" class="headerlink" title="服务层（MySQL Server）"></a>服务层（MySQL Server）</h3><p>服务层是MySQL Server的核心，主要包含系统管理和控制工具、连接池、SQL接口、解析器、查询优 化器和缓存六个部分。</p>
<ul>
<li><p><strong>连接池（Connection Pool）：</strong>负责存储和管理客户端与数据库的连接，一个线程负责管理一个连接。</p>
</li>
<li><ul>
<li>Authentication 权限控制</li>
<li>Thread Reuse 线程复用</li>
<li>Connection Limits 连接数限制</li>
<li>Check Memory 内存检查</li>
<li>Caches 缓存</li>
</ul>
</li>
<li><p><strong>系统管理和控制工具（Management Services &amp; Utilities）：</strong>例如备份恢复、安全管理、集群 管理等 </p>
</li>
<li><p><strong>SQL接口（SQL Interface）：</strong>用于接受客户端发送的各种SQL命令，并且返回用户需要查询的结果。比如DML、DDL、存储过程、视图、触发器等。 </p>
</li>
</ul>
<blockquote>
<p>DML (Data Manipulation Language) 数据操纵语言。用户通过它可以实现对数据库的基本操作。</p>
<p>DDL</p>
</blockquote>
<ul>
<li><strong>解析器（Parser）：</strong>负责将请求的SQL解析生成一个”解析树”。然后根据一些MySQL规则进一步检查解析树是否合法。 </li>
<li><strong>查询优化器（Optimizer）：</strong>当“解析树”通过解析器语法检查后，将交由优化器将其转化成执行计 划，然后与存储引擎交互。</li>
</ul>
<blockquote>
<p>select uid,name from user where gender=1; </p>
<p>选取 –&gt; 投影 –&gt; 联接 策略 </p>
<p>1）select先根据where语句进行<strong>选取</strong>，并不是查询出全部数据再过滤 </p>
<p>2）select查询根据uid和name进行属性<strong>投影</strong>，并不是取出所有字段 </p>
<p>3）将前面选取和<strong>投影</strong>联接起来终生成查询结果 </p>
</blockquote>
<ul>
<li><strong>缓存（Cache&amp;Buﬀer）：</strong> 缓存机制是由一系列小缓存组成的。比如表缓存，记录缓存，权限缓存，引擎缓存等。如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据。</li>
</ul>
<h3 id="存储引擎层"><a href="#存储引擎层" class="headerlink" title="存储引擎层"></a>存储引擎层</h3><p>存储引擎负责MySQL中数据的存储与提取，与底层系统文件进行交互。MySQL存储引擎是插件式的， 服务器中的查询执行引擎通过接口与存储引擎进行通信，接口屏蔽了不同存储引擎之间的差异 。现在有 很多种存储引擎，各有各的特点，常见的是MyISAM和InnoDB。 </p>
<h3 id="系统文件层"><a href="#系统文件层" class="headerlink" title="系统文件层"></a>系统文件层</h3><p>该层负责将数据库的数据和日志存储在文件系统之上，并完成与存储引擎的交互，是文件的物理存储 层。主要包含日志文件，数据文件，配置文件，pid 文件，socket 文件等。</p>
<h4 id="日志文件"><a href="#日志文件" class="headerlink" title="日志文件"></a>日志文件</h4><ul>
<li><p>错误日志（Error log） </p>
</li>
<li><ul>
<li>默认开启，show variables like ‘%log_error%’ </li>
</ul>
</li>
<li><p>通用查询日志（General query log） </p>
</li>
<li><ul>
<li>记录一般查询语句，show variables like ‘%general%’; </li>
</ul>
</li>
<li><p>二进制日志（binary log） </p>
</li>
<li><ul>
<li>记录了对MySQL数据库执行的更改操作，并且记录了语句的发生时间、执行时长；但是它不 记录select、show等不修改数据库的SQL。</li>
<li>主要用于数据库恢复和主从复制。 </li>
<li>show variables like ‘%log_bin%’; //是否开启 </li>
<li>show variables like ‘%binlog%’; //参数查看 </li>
<li>show binary logs;//查看日志文件 </li>
</ul>
</li>
<li><p>慢查询日志（Slow query log）</p>
</li>
<li><ul>
<li>记录所有执行时间超时的查询SQL，默认是10秒。 </li>
<li>show variables like ‘%slow_query%’; //是否开启 </li>
<li>show variables like ‘%long_query_time%’; //时长 </li>
</ul>
</li>
<li><p>配置文件 </p>
</li>
<li><ul>
<li>用于存放MySQL所有的配置信息文件，比如my.cnf、my.ini等。 </li>
</ul>
</li>
<li><p>数据文件 </p>
</li>
<li><ul>
<li>db.opt 文件：记录这个库的默认使用的字符集和校验规则。 </li>
<li>frm 文件：存储与表相关的元数据（meta）信息，包括表结构的定义信息等，每一张表都会 有一个frm 文件。 </li>
<li>MYD 文件：MyISAM 存储引擎专用，存放 MyISAM 表的数据（data)，每一张表都会有一个 .MYD 文件。 </li>
<li>MYI 文件：MyISAM 存储引擎专用，存放 MyISAM 表的索引相关信息，每一张 MyISAM 表对 应一个 .MYI 文件。 </li>
<li>ibd文件和 IBDATA 文件：存放 InnoDB 的数据文件（包括索引）。InnoDB 存储引擎有两种 表空间方式：独享表空间和共享表空间。独享表空间使用 .ibd 文件来存放数据，且每一张 InnoDB 表对应一个 .ibd 文件。共享表空间使用 .ibdata 文件，所有表共同使用一个（或多 个，自行配置）.ibdata 文件。 </li>
<li>ibdata1 文件：系统表空间数据文件，存储表元数据、Undo日志等 。 </li>
<li>ib_logﬁle0、ib_logﬁle1 文件：Redo log 日志文件。</li>
</ul>
</li>
<li><p>pid 文件 </p>
</li>
<li><ul>
<li>pid 文件是 mysqld 应用程序在 Unix/Linux 环境下的一个进程文件，和许多其他 Unix/Linux 服务 端程序一样，它存放着自己的进程 id。 </li>
</ul>
</li>
<li><p>socket 文件 </p>
</li>
<li><ul>
<li>socket 文件也是在 Unix/Linux 环境下才有的，用户在 Unix/Linux 环境下客户端连接可以不通过 TCP/IP 网络而直接使用 Unix Socket 来连接 MySQL。 </li>
</ul>
</li>
</ul>
<h2 id="SQL-运行机制"><a href="#SQL-运行机制" class="headerlink" title="SQL 运行机制"></a>SQL 运行机制</h2><p><img src="../img/mysql/26.png"></p>
<h3 id="①建立连接"><a href="#①建立连接" class="headerlink" title="①建立连接"></a>①建立连接</h3><p>（Connectors&amp;Connection Pool），通过客户端/服务器通信协议与MySQL建立连 接。MySQL 客户端与服务端的通信方式是 “ 半双工 ”。对于每一个 MySQL 的连接，时刻都有一个 线程状态来标识这个连接正在做什么。 </p>
<p><strong>通讯机制：</strong> </p>
<p>双工：能同时发送和接收数据，例如平时打电话。 </p>
<p>半双工：指的某一时刻，要么发送数据，要么接收数据，不能同时。例如早期对讲机 </p>
<p>单工：只能发送数据或只能接收数据。例如单行道 </p>
<p><strong>线程状态：</strong></p>
<p>show processlist; //查看用户正在运行的线程信息，root用户能查看所有线程，其他用户只能看自己的 </p>
<ul>
<li><p>id：线程ID，可以使用kill xx； user：启动这个线程的用户 </p>
</li>
<li><p>Host：发送请求的客户端的IP和端口号 </p>
</li>
<li><p>db：当前命令在哪个库执行 </p>
</li>
<li><p>Command：该线程正在执行的操作命令 </p>
</li>
<li><ul>
<li>Create DB：正在创建库操作 </li>
<li>Drop DB：正在删除库操作 </li>
<li>Execute：正在执行一个PreparedStatement </li>
<li>Close Stmt：正在关闭一个PreparedStatement </li>
<li>Query：正在执行一个语句 </li>
<li>Sleep：正在等待客户端发送语句 </li>
<li>Quit：正在退出 </li>
<li>Shutdown：正在关闭服务器 </li>
</ul>
</li>
<li><p>Time：表示该线程处于当前状态的时间，单位是秒 </p>
</li>
<li><p>State：线程状态 </p>
</li>
<li><ul>
<li>Updating：正在搜索匹配记录，进行修改 </li>
<li>Sleeping：正在等待客户端发送新请求 </li>
<li>Starting：正在执行请求处理 </li>
<li>Checking table：正在检查数据表 </li>
<li>Closing table : 正在将表中数据刷新到磁盘中 </li>
<li>Locked：被其他查询锁住了记录 </li>
<li>Sending Data：正在处理Select查询，同时将结果发送给客户端 </li>
</ul>
</li>
<li><p>Info：一般记录线程执行的语句，默认显示前100个字符。想查看完整的使用show full processlist; </p>
</li>
</ul>
<h3 id="②查询缓存"><a href="#②查询缓存" class="headerlink" title="②查询缓存"></a>②查询缓存</h3><p>（Cache&amp;Buﬀer），这是MySQL的一个可优化查询的地方，如果开启了查询缓存且在 查询缓存过程中查询到完全相同的SQL语句，则将查询结果直接返回给客户端；如果没有开启查询 缓存或者没有查询到完全相同的 SQL 语句则会由解析器进行语法语义解析，并生成“解析树”。 </p>
<ul>
<li><p>缓存Select查询的结果和SQL语句 </p>
</li>
<li><p>执行Select查询时，先查询缓存，判断是否存在可用的记录集，要求是否完全相同（包括参数值），这样才会匹配缓存数据命中。 </p>
</li>
<li><p>即使开启查询缓存，以下SQL也不能缓存 </p>
</li>
<li><ul>
<li>查询语句使用SQL_NO_CACHE </li>
<li>查询的结果大于query_cache_limit设置 </li>
<li>查询中有一些不确定的参数，比如now() </li>
</ul>
</li>
<li><p>show variables like ‘%query_cache%’; //查看查询缓存是否启用，空间大小，限制等 </p>
</li>
<li><p>show status like ‘Qcache%’; //查看更详细的缓存参数，可用缓存空间，缓存块，缓存多少等</p>
</li>
</ul>
<h3 id="③解析器"><a href="#③解析器" class="headerlink" title="③解析器"></a>③解析器</h3><p>（Parser）将客户端发送的SQL进行语法解析，生成”解析树”。预处理器根据一些MySQL 规则进一步检查“解析树”是否合法，例如这里将检查数据表和数据列是否存在，还会解析名字和别名，看看它们是否有歧义，后生成新的“解析树”。 </p>
<h3 id="④查询优化器"><a href="#④查询优化器" class="headerlink" title="④查询优化器"></a>④查询优化器</h3><p>（Optimizer）根据“解析树”生成优的执行计划。MySQL使用很多优化策略生成 优的执行计划，可以分为两类：静态优化（编译时优化）、动态优化（运行时优化）。 </p>
<ul>
<li><p>等价变换策略 </p>
</li>
<li><ul>
<li>5=5 and a&gt;5 改成 a &gt; 5 </li>
<li>a &lt; b and a=5 改成b&gt;5 and a=5 </li>
<li>基于联合索引，调整条件位置等 </li>
</ul>
</li>
<li><p>优化count、min、max等函数 </p>
</li>
<li><ul>
<li>InnoDB引擎min函数只需要找索引左边 </li>
<li>InnoDB引擎max函数只需要找索引右边 </li>
<li>MyISAM引擎count(*)，不需要计算，直接返回 </li>
</ul>
</li>
<li><p>提前终止查询 </p>
</li>
<li><ul>
<li>使用了limit查询，获取limit所需的数据，就不在继续遍历后面数据 </li>
</ul>
</li>
<li><p>in的优化 </p>
</li>
<li><ul>
<li>MySQL对in查询，会先进行排序，再采用二分法查找数据。比如where id in (2,1,3)，变 成 in (1,2,3)  </li>
</ul>
</li>
</ul>
<h3 id="⑤查询执行引擎负责执行-SQL-语句"><a href="#⑤查询执行引擎负责执行-SQL-语句" class="headerlink" title="⑤查询执行引擎负责执行 SQL 语句"></a>⑤查询执行引擎负责执行 SQL 语句</h3><p>此时查询执行引擎会根据 SQL 语句中表的存储引擎类型，以 及对应的API接口与底层存储引擎缓存或者物理文件的交互，得到查询结果并返回给客户端。若开 启用查询缓存，这时会将SQL 语句和结果完整地保存到查询缓存（Cache&amp;Buﬀer）中，以后若有 相同的 SQL 语句执行则直接返回结果。 </p>
<ul>
<li>如果开启了查询缓存，先将查询结果做缓存操作 </li>
<li>返回结果过多，采用增量模式返回</li>
</ul>
<h2 id="Mysql-innodb-页结构"><a href="#Mysql-innodb-页结构" class="headerlink" title="Mysql innodb 页结构"></a>Mysql innodb 页结构</h2><p><img src="../img/mysql/28.png"></p>
<p><img src="../img/mysql/29.png"></p>
<ul>
<li>各个数据⻚可以组成⼀个双向链表 </li>
<li>⽽每个数据⻚中的记录⼜可以组成⼀个单向链表 <ul>
<li>每个数据⻚都会为存储在它⾥边⼉的记录⽣成⼀个⻚⽬录，在通过主键查找某条记录的时候可 以在⻚⽬录中使⽤⼆分法快速定位到对应的槽，然后再遍历该槽对应分组中的记录即可快速找 到指定的记录 </li>
<li>以其他列(⾮主键)作为搜索条件：只能从最⼩记录开始依次遍历单链表中的每条记录。 </li>
</ul>
</li>
</ul>
<p>所以说，如果我们写 select * from user where username=’zhangsan’ 这样没有进⾏任何优化的sql语句，默认 会这样做：</p>
<ul>
<li>定位到记录所在的⻚ 需要遍历双向链表，</li>
<li>找到所在的⻚ 从所在的⻚内中查找相应的记录 </li>
<li>由于不是根据主键查询，只能遍历所在⻚的单链表了 </li>
</ul>
<p>很明显，在数据量很⼤的情况下这样查找会很慢！看起来跟回表有点点像。</p>

  
  
  <div class="footer">
      <script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>
<div id="bsa-native"></div>
<script>
_bsa.init('custom', 'CKYD62QM', 'placement:vuejsorg',
  {
    target: '#bsa-native',
    template: '<a class="native-box" href="##statlink##"><div class="native-sponsor">Sponsor</div><div class="native-text"><strong>##company##</strong> — ##description##</div></a>'
  }
);
</script>


    Caught a mistake or want to contribute to the documentation?
    <a href="https://github.com/vuejs/vuejs.org/blob/master/src/mysql/other.md" rel="noopener" target="_blank">
      Edit this on GitHub!
    </a>
    <!-- Deployed on
    <a href="https://url.netlify.com/HJ8X2mxP8" rel="noopener" target="_blank">
      Netlify
    </a>. -->
  </div>
</div>

      </div>
      <script src="/js/smooth-scroll.min.js"></script>
    

    <!-- main custom script for sidebars, version selects etc. -->
    <script src="/js/css.escape.js"></script>
    <script src="/js/common.js"></script>

    <!-- search -->
    <link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel='stylesheet' type='text/css'>
    
<link rel="stylesheet" href="/css/search.css">

    <script src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script>
    [
      '#search-query-nav',
      '#search-query-sidebar',
      '#search-query-menu'
    ].forEach(function (selector) {
      if (!document.querySelector(selector)) return
      // search index defaults to v2
      var match = window.location.pathname.match(/^\/(v\d+)/)
      var version = match ? match[1] : 'v2'
      docsearch({
      appId: 'BH4D9OD16A',
      apiKey: '85cc3221c9f23bfbaa4e3913dd7625ea',
      indexName: 'vuejs',
      inputSelector: selector,
      algoliaOptions: { facetFilters: ["version:" + version] },
      autocompleteOptions: { hint: false, appendTo: 'body'}
      })
    })
    </script>
  </body>
</html>
