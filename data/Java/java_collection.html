


<!DOCTYPE html>
<html lang="en" class="with-v3-banner">
  <head>
    <title>Notes</title>
    <meta charset="utf-8">
    <meta name="description" content="Notes - Personal review warehouse">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="alternate" hreflang="x-default" href="https://vuejs.org/data/Java/java_collection.html">
    <link rel="alternate" hreflang="zh" href="https://cn.vuejs.org/data/Java/java_collection.html">
    <link rel="alternate" hreflang="ja" href="https://jp.vuejs.org/data/Java/java_collection.html">
    <link rel="alternate" hreflang="ru" href="https://ru.vuejs.org/data/Java/java_collection.html">
    <link rel="alternate" hreflang="ko" href="https://kr.vuejs.org/data/Java/java_collection.html">
    <link rel="alternate" hreflang="pt-BR" href="https://br.vuejs.org/data/Java/java_collection.html">
    <link rel="alternate" hreflang="fr" href="https://fr.vuejs.org/data/Java/java_collection.html">
    <link rel="alternate" hreflang="es" href="https://es.vuejs.org/data/Java/java_collection.html">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Notes">
    <meta property="og:description" content="Notes - Personal review warehouse">
    <meta property="og:image" content="https://vuejs.org//images/logo.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Notes">
    <meta name="twitter:description" content="Notes - Personal review warehouse">
    <meta name="twitter:image" content="https://vuejs.org/images/logo.png">

    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png">
    <meta name="msapplication-TileImage" content="/images/icons/ms-icon-144x144.png">
    <link rel="icon" href="/images/logo.png" type="image/png">

    <meta name="msapplication-TileColor" content="#4fc08d">
    <meta name="theme-color" content="#4fc08d">

    <meta name="msapplication-config" content="browserconfig.xml">
    <link rel="manifest" href="/manifest.json">

    <link href="https://fonts.googleapis.com" rel="preconnect" crossorigin>
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    <link href="https://maxcdn.bootstrapcdn.com" rel="preconnect" crossorigin>

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Dosis:500&text=Vue.js&display=swap" rel="stylesheet">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- main page styles -->
    
<link rel="stylesheet" href="/css/page.css">


    <!-- this needs to be loaded before guide's inline scripts -->
    <script src="/js/vue.js"></script>

    

    <script>
      Vue.config.productionTip = false
      window.PAGE_TYPE = ""
    </script>

    <!-- ga -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46852172-1', 'vuejs.org');
      ga('send', 'pageview');
    </script>

    <!-- vimeo analytics -->
    <script type="text/javascript" defer="defer" src="https://extend.vimeocdn.com/ga/72160148.js"></script>
  <meta name="generator" content="Hexo 5.4.0"></head>
  <body class="docs">
    <div id="mobile-bar" >
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>
    <div>
  <div id="v3-banner">
    <span class="hidden-sm">Welcome to yanliang's notes</span>
  </div>

  <header id="header">
    <a id="logo" href="/">
      <img src="/images/logo.png" alt="vue logo">
      <span>Notes - personal review warehouse</span>
    </a>
    <ul id="nav">
      <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input" aria-label="Search">
  </form>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">â­ï¸Java</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Documentation</h4></li>
    <li>
      <ul>
        <li><a href="/java/oop/" class="nav-link">OOP</a></li>
        <li><a href="/v2/api/" class="nav-link">API</a></li>
        <li><a href="/v2/style-guide/" class="nav-link">Style Guide</a></li>
        <li><a href="/v2/examples/" class="nav-link">Examples</a></li>
        <li><a href="/v2/cookbook/" class="nav-link">Cookbook</a></li>
      </ul>
    </li>
    <li><h4>Video Courses</h4></li>
    <li>
      <ul>
        <li>
          <a href="https://www.vuemastery.com/courses/" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue Mastery
          </a>
        </li>
        <li>
          <a
            href="https://vueschool.io/?friend=vuejs&utm_source=Vuejs.org&utm_medium=Link&utm_content=Navbar%20Dropdown"
            class="nav-link"
            target="_blank" rel="sponsored noopener"
          >
            Vue School
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container learn">
  <a class="nav-link">ç½‘ç»œ</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <!-- <li><h4>Documentation</h4></li> -->
    <li>
      <ul>
        <li><a href="/network">Review List</a></li>
        <li><a href="/network/tcp/">ğŸ”¥TCP</a></li>
        <li><a href="/network/http/">HTTP</a></li>
        <li><a href="/network/ip/">IP</a></li>
      </ul>
    </li>
    <li><h4>Video Courses</h4></li>
    <li>
      <ul>
        <li>
          <a href="https://www.vuemastery.com/courses/" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue Mastery
          </a>
        </li>
        <li>
          <a
            href="https://vueschool.io/?friend=vuejs&utm_source=Vuejs.org&utm_medium=Link&utm_content=Navbar%20Dropdown"
            class="nav-link"
            target="_blank" rel="sponsored noopener"
          >
            Vue School
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/os/">æ“ä½œç³»ç»Ÿ</a>
</li>
<li>
  <a href="/mysql/">ğŸ’¼æ•°æ®åº“</a>
</li>
<li>
  <a target="_blank" rel="noopener" href="https://codetop.cc/#/home">â¤ï¸ç®—æ³•</a>
</li>
<li class="nav-dropdown-container resources">
  <a href="#" class="nav-link">Resources</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/resources/partners.html" class="nav-link">Partners</a></li>
    <li><a href="/resources/themes.html" class="nav-link">Themes</a></li>
    <li><a href="https://github.com/vuejs/awesome-vue" class="nav-link" target="_blank" rel="noopener">Awesome Vue</a></li>
    <li><a href="https://awesomejs.dev/for/vue/" class="nav-link" target="_blank" rel="noopener">Browse packages for Vue</a></li>
  </ul>
</li>

<!-- <li>
  <a href="/partners" class="nav-link ">Partners</a>
</li> -->
<li class="nav-dropdown-container support-vue">
  <a href="/support-vuejs/" class="nav-link">Support Vue</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/support-vuejs/#One-time-Donations" class="nav-link">One-time Donations</a></li>
    <li><a href="/support-vuejs/#Recurring-Pledges" class="nav-link">Recurring Pledges</a></li>
    <li><a href="https://vue.threadless.com" target="_blank" rel="noopener" class="nav-link">T-Shirt Shop</a></li>
  </ul>
</li>

<li class="nav-dropdown-container language">
  <a class="nav-link">Translations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a target="_blank" rel="noopener" href="https://cn.vuejs.org/data/Java/java_collection.html" class="nav-link">ä¸­æ–‡</a></li>
    <li><a target="_blank" rel="noopener" href="https://jp.vuejs.org/data/Java/java_collection.html" class="nav-link">æ—¥æœ¬èª</a></li>
    <li><a target="_blank" rel="noopener" href="https://ru.vuejs.org/data/Java/java_collection.html" class="nav-link">Ğ ÑƒÑÑĞºĞ¸Ğ¹</a></li>
    <li><a target="_blank" rel="noopener" href="https://kr.vuejs.org/data/Java/java_collection.html" class="nav-link">í•œêµ­ì–´</a></li>
    <li><a target="_blank" rel="noopener" href="https://br.vuejs.org/data/Java/java_collection.html" class="nav-link">PortuguÃªs</a></li>
    <li><a target="_blank" rel="noopener" href="https://fr.vuejs.org/data/Java/java_collection.html" class="nav-link">FranÃ§ais</a></li>
    <li><a target="_blank" rel="noopener" href="https://vi.vuejs.org/data/Java/java_collection.html" class="nav-link">Tiáº¿ng Viá»‡t</a></li>
    <li><a target="_blank" rel="noopener" href="https://es.vuejs.org/data/Java/java_collection.html" class="nav-link">EspaÃ±ol</a></li>
    <li><a target="_blank" rel="noopener" href="https://docs.vuejs.id/data/Java/java_collection.html" class="nav-link">Bahasa Indonesia</a></li>
  </ul>
</li>


    </ul>
  </header>
</div>

    
      <div id="main" class="fix-sidebar">
        
  <div class="sidebar">
    <ul class="main-menu">
      <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input" aria-label="Search">
  </form>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">â­ï¸Java</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Documentation</h4></li>
    <li>
      <ul>
        <li><a href="/java/oop/" class="nav-link">OOP</a></li>
        <li><a href="/v2/api/" class="nav-link">API</a></li>
        <li><a href="/v2/style-guide/" class="nav-link">Style Guide</a></li>
        <li><a href="/v2/examples/" class="nav-link">Examples</a></li>
        <li><a href="/v2/cookbook/" class="nav-link">Cookbook</a></li>
      </ul>
    </li>
    <li><h4>Video Courses</h4></li>
    <li>
      <ul>
        <li>
          <a href="https://www.vuemastery.com/courses/" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue Mastery
          </a>
        </li>
        <li>
          <a
            href="https://vueschool.io/?friend=vuejs&utm_source=Vuejs.org&utm_medium=Link&utm_content=Navbar%20Dropdown"
            class="nav-link"
            target="_blank" rel="sponsored noopener"
          >
            Vue School
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container learn">
  <a class="nav-link">ç½‘ç»œ</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <!-- <li><h4>Documentation</h4></li> -->
    <li>
      <ul>
        <li><a href="/network">Review List</a></li>
        <li><a href="/network/tcp/">ğŸ”¥TCP</a></li>
        <li><a href="/network/http/">HTTP</a></li>
        <li><a href="/network/ip/">IP</a></li>
      </ul>
    </li>
    <li><h4>Video Courses</h4></li>
    <li>
      <ul>
        <li>
          <a href="https://www.vuemastery.com/courses/" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue Mastery
          </a>
        </li>
        <li>
          <a
            href="https://vueschool.io/?friend=vuejs&utm_source=Vuejs.org&utm_medium=Link&utm_content=Navbar%20Dropdown"
            class="nav-link"
            target="_blank" rel="sponsored noopener"
          >
            Vue School
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/os/">æ“ä½œç³»ç»Ÿ</a>
</li>
<li>
  <a href="/mysql/">ğŸ’¼æ•°æ®åº“</a>
</li>
<li>
  <a target="_blank" rel="noopener" href="https://codetop.cc/#/home">â¤ï¸ç®—æ³•</a>
</li>
<li class="nav-dropdown-container resources">
  <a href="#" class="nav-link">Resources</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/resources/partners.html" class="nav-link">Partners</a></li>
    <li><a href="/resources/themes.html" class="nav-link">Themes</a></li>
    <li><a href="https://github.com/vuejs/awesome-vue" class="nav-link" target="_blank" rel="noopener">Awesome Vue</a></li>
    <li><a href="https://awesomejs.dev/for/vue/" class="nav-link" target="_blank" rel="noopener">Browse packages for Vue</a></li>
  </ul>
</li>

<!-- <li>
  <a href="/partners" class="nav-link ">Partners</a>
</li> -->
<li class="nav-dropdown-container support-vue">
  <a href="/support-vuejs/" class="nav-link">Support Vue</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/support-vuejs/#One-time-Donations" class="nav-link">One-time Donations</a></li>
    <li><a href="/support-vuejs/#Recurring-Pledges" class="nav-link">Recurring Pledges</a></li>
    <li><a href="https://vue.threadless.com" target="_blank" rel="noopener" class="nav-link">T-Shirt Shop</a></li>
  </ul>
</li>

<li class="nav-dropdown-container language">
  <a class="nav-link">Translations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a target="_blank" rel="noopener" href="https://cn.vuejs.org/data/Java/java_collection.html" class="nav-link">ä¸­æ–‡</a></li>
    <li><a target="_blank" rel="noopener" href="https://jp.vuejs.org/data/Java/java_collection.html" class="nav-link">æ—¥æœ¬èª</a></li>
    <li><a target="_blank" rel="noopener" href="https://ru.vuejs.org/data/Java/java_collection.html" class="nav-link">Ğ ÑƒÑÑĞºĞ¸Ğ¹</a></li>
    <li><a target="_blank" rel="noopener" href="https://kr.vuejs.org/data/Java/java_collection.html" class="nav-link">í•œêµ­ì–´</a></li>
    <li><a target="_blank" rel="noopener" href="https://br.vuejs.org/data/Java/java_collection.html" class="nav-link">PortuguÃªs</a></li>
    <li><a target="_blank" rel="noopener" href="https://fr.vuejs.org/data/Java/java_collection.html" class="nav-link">FranÃ§ais</a></li>
    <li><a target="_blank" rel="noopener" href="https://vi.vuejs.org/data/Java/java_collection.html" class="nav-link">Tiáº¿ng Viá»‡t</a></li>
    <li><a target="_blank" rel="noopener" href="https://es.vuejs.org/data/Java/java_collection.html" class="nav-link">EspaÃ±ol</a></li>
    <li><a target="_blank" rel="noopener" href="https://docs.vuejs.id/data/Java/java_collection.html" class="nav-link">Bahasa Indonesia</a></li>
  </ul>
</li>


    </ul>
  </div>

<div class="content  ">
  <p class="tip warning v3-warning">
    Welcome to yanliang's notes.
  </p>

  
  
  
    <p>[TOC]</p>
<h2 id="Java-å®¹å™¨æœ‰å“ªäº›ï¼Ÿ-å“ªäº›æ˜¯åŒæ­¥å®¹å™¨ï¼Ÿ-å“ªäº›æ˜¯å¹¶å‘å®¹å™¨ï¼Ÿ"><a href="#Java-å®¹å™¨æœ‰å“ªäº›ï¼Ÿ-å“ªäº›æ˜¯åŒæ­¥å®¹å™¨ï¼Ÿ-å“ªäº›æ˜¯å¹¶å‘å®¹å™¨ï¼Ÿ" class="headerlink" title="Java å®¹å™¨æœ‰å“ªäº›ï¼Ÿ å“ªäº›æ˜¯åŒæ­¥å®¹å™¨ï¼Ÿ å“ªäº›æ˜¯å¹¶å‘å®¹å™¨ï¼Ÿ"></a>Java å®¹å™¨æœ‰å“ªäº›ï¼Ÿ å“ªäº›æ˜¯åŒæ­¥å®¹å™¨ï¼Ÿ å“ªäº›æ˜¯å¹¶å‘å®¹å™¨ï¼Ÿ</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903954719965192">https://juejin.cn/post/6844903954719965192</a></p>
<p>Java å®¹å™¨ä¸»è¦åˆ†ä¸¤ç§ï¼šCollection å’Œ Mapï¼ŒCollection æ˜¯ç”¨äºå­˜å‚¨å¯¹è±¡çš„é›†åˆï¼ŒMap æ˜¯ç”¨äºå­˜å‚¨é”®å€¼å¯¹çš„é›†åˆã€‚ å…¶ä¸­Collectionåˆå¯ä»¥åˆ†ä¸ºList å’Œ Setä¸¤ç§é›†åˆã€‚</p>
<ul>
<li><p>å®ç°Listæ¥å£çš„é›†åˆä¸»è¦æœ‰ï¼šArrayListï¼ŒLinkedListï¼ŒVectorï¼ˆStackï¼‰</p>
</li>
<li><p>å®ç°Setæ¥å£çš„é›†åˆä¸»è¦æœ‰ï¼šHashSetï¼ŒLinkedSetï¼ŒTreeSet</p>
</li>
<li><p>å®ç°mapæ¥å£çš„é›†åˆä¸»è¦æœ‰ï¼šHashMapï¼ŒLinkedHashMapï¼ŒTreeMapï¼ŒHashTable</p>
</li>
</ul>
<p>å…¶ä¸­å±äº <strong>åŒæ­¥å®¹å™¨</strong> çš„æœ‰ï¼šVectorï¼ŒStackï¼ŒHashTableï¼Œå¦å¤– Collections æä¾›äº†ä»¥ä¸‹å‡ ç§æ–¹æ³•å¯ä»¥å°†éåŒæ­¥å®¹å™¨è½¬åŒ–ä¸ºåŒæ­¥å®¹å™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List list = Collections.synchronizedList(<span class="keyword">new</span> ArrayList());</span><br><span class="line">Set set = Collections.synchronizedSet(<span class="keyword">new</span> HashSet());</span><br><span class="line">Map map = Collections.synchronizedMap(<span class="keyword">new</span> HashMap());</span><br></pre></td></tr></table></figure>

<p><strong>å¹¶å‘å®¹å™¨</strong></p>
<ol>
<li><p>CopyOnWriteArrayList</p>
</li>
<li><p>CopyOnWriteArraySet</p>
</li>
<li><p>ConcurrentHashMap</p>
</li>
<li><p>ConcurrentSkipListMap</p>
</li>
<li><p>ConcurrentSkipListSet</p>
</li>
</ol>
<h2 id="é›†åˆæ¡†æ¶æœ‰å“ªäº›ä¼˜ç‚¹"><a href="#é›†åˆæ¡†æ¶æœ‰å“ªäº›ä¼˜ç‚¹" class="headerlink" title="é›†åˆæ¡†æ¶æœ‰å“ªäº›ä¼˜ç‚¹"></a>é›†åˆæ¡†æ¶æœ‰å“ªäº›ä¼˜ç‚¹</h2><ul>
<li>ä½¿ç”¨æ ¸å¿ƒé›†åˆç±»é™ä½å¼€å‘æˆæœ¬ï¼Œè€Œéå®ç°æˆ‘ä»¬è‡ªå·±çš„é›†åˆç±»ã€‚</li>
<li>éšç€ä½¿ç”¨ç»è¿‡ä¸¥æ ¼æµ‹è¯•çš„é›†åˆæ¡†æ¶ç±»ï¼Œä»£ç è´¨é‡ä¼šå¾—åˆ°æé«˜ã€‚</li>
<li>é€šè¿‡ä½¿ç”¨ JDK é™„å¸¦çš„é›†åˆç±»ï¼Œå¯ä»¥é™ä½ä»£ç ç»´æŠ¤æˆæœ¬ã€‚</li>
<li>å¤ç”¨æ€§å’Œå¯æ“ä½œæ€§ã€‚</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆé›†åˆç±»æ²¡æœ‰å®ç°-Cloneable-å’Œ-Serializable-æ¥å£ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé›†åˆç±»æ²¡æœ‰å®ç°-Cloneable-å’Œ-Serializable-æ¥å£ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé›†åˆç±»æ²¡æœ‰å®ç° Cloneable å’Œ Serializable æ¥å£ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé›†åˆç±»æ²¡æœ‰å®ç° Cloneable å’Œ Serializable æ¥å£ï¼Ÿ</h2><p>å…‹éš†ï¼ˆcloningï¼‰æˆ–è€…åºåˆ—åŒ–ï¼ˆserializationï¼‰çš„è¯­ä¹‰å’Œå«ä¹‰æ˜¯è·Ÿå…·ä½“çš„å®ç°ç›¸å…³çš„ã€‚å› æ­¤åº”è¯¥ç”±é›†åˆç±»çš„å…·ä½“å®ç°ç±»æ¥å†³å®šå¦‚ä½•è¢«å…‹éš†æˆ–è€…åºåˆ—åŒ–</p>
<h3 id="é›†åˆæ¡†æ¶ä¸­çš„æ³›å‹æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ"><a href="#é›†åˆæ¡†æ¶ä¸­çš„æ³›å‹æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ" class="headerlink" title="é›†åˆæ¡†æ¶ä¸­çš„æ³›å‹æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ"></a>é›†åˆæ¡†æ¶ä¸­çš„æ³›å‹æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ</h3><p>Java5 å¼•å…¥äº†æ³›å‹ï¼Œæ‰€æœ‰çš„é›†åˆæ¥å£å’Œå®ç°éƒ½å¤§é‡åœ°ä½¿ç”¨å®ƒã€‚æ³›å‹å…è®¸æˆ‘ä»¬ä¸ºé›†åˆæä¾›ä¸€ä¸ªå¯ä»¥å®¹çº³çš„å¯¹è±¡ç±»å‹ã€‚å› æ­¤ï¼Œå¦‚æœä½ æ·»åŠ å…¶å®ƒç±»å‹çš„ä»»ä½•å…ƒç´ ï¼Œå®ƒä¼šåœ¨ç¼–è¯‘æ—¶æŠ¥é”™ã€‚è¿™é¿å…äº†åœ¨è¿è¡Œæ—¶å‡ºç° ClassCastExceptionï¼Œå› ä¸ºä½ å°†ä¼šåœ¨ç¼–è¯‘æ—¶å¾—åˆ°æŠ¥é”™ä¿¡æ¯ã€‚</p>
<p>æ³›å‹ä¹Ÿä½¿å¾—ä»£ç æ•´æ´ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨æ˜¾å¼è½¬æ¢å’Œ instanceOf æ“ä½œç¬¦ã€‚å®ƒä¹Ÿç»™è¿è¡Œæ—¶å¸¦æ¥å¥½å¤„ï¼Œå› ä¸ºä¸ä¼šäº§ç”Ÿç±»å‹æ£€æŸ¥çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p>
<ul>
<li>ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥</li>
<li>ä½¿ä»£ç æ•´æ´</li>
<li><strong>è¿è¡Œæ—¶ä¸ä¼šäº§ç”Ÿç±»å‹æ£€æŸ¥ç›¸å…³çš„å­—èŠ‚ç æŒ‡ä»¤</strong></li>
</ul>
<h2 id="Collection-å’Œ-Collections-çš„åŒºåˆ«ï¼Ÿ"><a href="#Collection-å’Œ-Collections-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="Collection å’Œ Collections çš„åŒºåˆ«ï¼Ÿ"></a>Collection å’Œ Collections çš„åŒºåˆ«ï¼Ÿ</h2><ul>
<li>Collection ï¼Œæ˜¯é›†åˆç±»çš„ä¸Šçº§æ¥å£ï¼Œç»§æ‰¿ä¸ä»–çš„æ¥å£ä¸»è¦æœ‰ Set å’ŒList ã€‚</li>
<li>Collections ï¼Œæ˜¯é’ˆå¯¹é›†åˆç±»çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œå®ƒæä¾›ä¸€ç³»åˆ—é™æ€æ–¹æ³•å®ç°å¯¹å„ç§é›†åˆçš„æœç´¢ã€æ’åºã€çº¿ç¨‹å®‰å…¨åŒ–ç­‰æ“ä½œã€‚</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯è¿­ä»£å™¨-Iterator-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è¿­ä»£å™¨-Iterator-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è¿­ä»£å™¨(Iterator)ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è¿­ä»£å™¨(Iterator)ï¼Ÿ</h2><p>Iterator æ¥å£æä¾›äº†å¾ˆå¤šå¯¹é›†åˆå…ƒç´ è¿›è¡Œè¿­ä»£çš„æ–¹æ³•ã€‚æ¯ä¸€ä¸ªé›†åˆç±»éƒ½åŒ…å«äº†å¯ä»¥è¿”å›è¿­ä»£å™¨å®ä¾‹çš„ è¿­ä»£æ–¹æ³•ã€‚è¿­ä»£å™¨å¯ä»¥åœ¨è¿­ä»£çš„è¿‡ç¨‹ä¸­åˆ é™¤åº•å±‚é›†åˆçš„å…ƒç´ ã€‚</p>
<h3 id="Iteratorå’ŒListIteratorçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Iteratorå’ŒListIteratorçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Iteratorå’ŒListIteratorçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Iteratorå’ŒListIteratorçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ä¸‹é¢åˆ—å‡ºäº†ä»–ä»¬çš„åŒºåˆ«ï¼š</p>
<ul>
<li>Iterator å¯ç”¨æ¥éå† Set å’Œ List é›†åˆï¼Œä½†æ˜¯ ListIterator åªèƒ½ç”¨æ¥éå† List ã€‚</li>
<li>Iterator å¯¹é›†åˆåªèƒ½æ˜¯å‰å‘éå†ï¼ŒListIterator æ—¢å¯ä»¥å‰å‘ä¹Ÿå¯ä»¥åå‘ã€‚</li>
<li>ListIterator å®ç°äº† Iterator æ¥å£ï¼Œå¹¶åŒ…å«å…¶ä»–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šå¢åŠ å…ƒç´ ï¼Œæ›¿æ¢å…ƒç´ ï¼Œè·å–å‰ä¸€ä¸ªå’Œåä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œç­‰ç­‰ã€‚</li>
</ul>
<h2 id="fail-fast"><a href="#fail-fast" class="headerlink" title="fail-fast"></a>fail-fast</h2><p>fail-fast æœºåˆ¶æ˜¯<strong>Javaé›†åˆ</strong>(Collection)ä¸­çš„ä¸€ç§<strong>é”™è¯¯æœºåˆ¶</strong>ã€‚ åœ¨ç”¨è¿­ä»£å™¨éå†ä¸€ä¸ªé›†åˆå¯¹è±¡æ—¶ï¼Œå¦‚æœéå†è¿‡ç¨‹ä¸­å¯¹é›†åˆå¯¹è±¡çš„ç»“æ„è¿›è¡Œäº†ä¿®æ”¹ï¼ˆå¢åŠ ã€åˆ é™¤ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡º<strong>Concurrent Modification Exception</strong>ï¼ˆå¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼‰ã€‚</p>
<p><strong>åŸç†ï¼š</strong>è¿­ä»£å™¨åœ¨éå†æ—¶ç›´æ¥è®¿é—®é›†åˆä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨éå†è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ª modCount å˜é‡ã€‚é›†åˆåœ¨è¢«éå†æœŸé—´å¦‚æœå†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šæ”¹å˜modCountçš„å€¼ã€‚æ¯å½“è¿­ä»£å™¨ä½¿ç”¨hashNext()/next()éå†ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šæ£€æµ‹modCountå˜é‡æ˜¯å¦ä¸ºexpectedmodCountå€¼ï¼Œæ˜¯çš„è¯å°±è¿”å›éå†ï¼›å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢éå†ã€‚<br>æ³¨æ„ï¼šè¿™é‡Œå¼‚å¸¸çš„æŠ›å‡ºæ¡ä»¶æ˜¯æ£€æµ‹åˆ° modCountï¼=expectedmodCount è¿™ä¸ªæ¡ä»¶ã€‚å¦‚æœé›†åˆå‘ç”Ÿå˜åŒ–æ—¶ä¿®æ”¹modCountå€¼åˆšå¥½åˆè®¾ç½®ä¸ºäº†expectedmodCountå€¼ï¼Œåˆ™å¼‚å¸¸ä¸ä¼šæŠ›å‡ºã€‚å› æ­¤ï¼Œä¸èƒ½ä¾èµ–äºè¿™ä¸ªå¼‚å¸¸æ˜¯å¦æŠ›å‡ºè€Œè¿›è¡Œå¹¶å‘æ“ä½œçš„ç¼–ç¨‹ï¼Œè¿™ä¸ªå¼‚å¸¸åªå»ºè®®ç”¨äºæ£€æµ‹å¹¶å‘ä¿®æ”¹çš„bugã€‚<br>åœºæ™¯ï¼šjava.utilåŒ…ä¸‹çš„é›†åˆç±»éƒ½æ˜¯å¿«é€Ÿå¤±è´¥çš„ï¼Œä¸èƒ½åœ¨å¤šçº¿ç¨‹ä¸‹å‘ç”Ÿå¹¶å‘ä¿®æ”¹ï¼ˆè¿­ä»£è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ï¼‰ã€‚</p>
<p><strong>å¦‚ä½•é¿å…fail-fastæŠ›å¼‚å¸¸ï¼Ÿ</strong></p>
<p>1.å¦‚æœéè¦åœ¨éå†çš„æ—¶å€™ä¿®æ”¹é›†åˆï¼Œé‚£ä¹ˆå»ºè®®ç”¨è¿­ä»£å™¨çš„removeç­‰æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç”¨é›†åˆçš„removeç­‰æ–¹æ³•ã€‚(è€å®éµå®ˆé˜¿é‡Œå·´å·´javaå¼€å‘è§„èŒƒâ€¦â€¦)</p>
<p>2.å¦‚æœæ˜¯å¹¶å‘çš„ç¯å¢ƒï¼Œé‚£è¿˜è¦å¯¹Iteratorå¯¹è±¡åŠ é”ï¼›ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨Collections.synchronizedListã€‚</p>
<p>3.CopyOnWriteArrayListï¼ˆé‡‡ç”¨fail-safeï¼‰</p>
<p><strong>å®‰å…¨å¤±è´¥ï¼ˆfailâ€”safeï¼‰</strong><br>é‡‡ç”¨å®‰å…¨å¤±è´¥æœºåˆ¶çš„é›†åˆå®¹å™¨ï¼Œåœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†ã€‚</p>
<p><strong>åŸç†ï¼š</strong>ç”±äºè¿­ä»£æ—¶æ˜¯å¯¹åŸé›†åˆçš„æ‹·è´è¿›è¡Œéå†ï¼Œæ‰€ä»¥åœ¨éå†è¿‡ç¨‹ä¸­å¯¹åŸé›†åˆæ‰€ä½œçš„ä¿®æ”¹å¹¶ä¸èƒ½è¢«è¿­ä»£å™¨æ£€æµ‹åˆ°ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘Concurrent Modification Exceptionã€‚è™½ç„¶fail-safeä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†å­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹</p>
<ol>
<li>å¤åˆ¶æ—¶éœ€è¦é¢å¤–çš„ç©ºé—´å’Œæ—¶é—´ä¸Šçš„å¼€é”€ã€‚</li>
<li>ä¸èƒ½ä¿è¯éå†çš„æ˜¯æœ€æ–°å†…å®¹ã€‚</li>
</ol>
<p>åœºæ™¯ï¼šjava.util.concurrentåŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯å®‰å…¨å¤±è´¥ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨ï¼Œå¹¶å‘ä¿®æ”¹ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Kato_op/article/details/80356618">https://blog.csdn.net/Kato_op/article/details/80356618</a></p>
<h2 id="å¿«é€Ÿå¤±è´¥-fail-fast-å’Œå®‰å…¨å¤±è´¥-fail-safe-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å¿«é€Ÿå¤±è´¥-fail-fast-å’Œå®‰å…¨å¤±è´¥-fail-safe-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¿«é€Ÿå¤±è´¥(fail-fast)å’Œå®‰å…¨å¤±è´¥(fail-safe)çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å¿«é€Ÿå¤±è´¥(fail-fast)å’Œå®‰å…¨å¤±è´¥(fail-safe)çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Iterator çš„å®‰å…¨å¤±è´¥æ˜¯åŸºäºå¯¹åº•å±‚é›†åˆåšæ‹·è´ï¼Œå› æ­¤ï¼Œå®ƒä¸å—æºé›†åˆä¸Šä¿®æ”¹çš„å½±å“ã€‚</p>
<p>java.util åŒ…ä¸‹é¢çš„æ‰€æœ‰çš„é›†åˆç±»éƒ½æ˜¯å¿«é€Ÿå¤±è´¥çš„ï¼Œè€Œ java.util.concurrent åŒ…ä¸‹é¢çš„æ‰€æœ‰çš„ç±»éƒ½æ˜¯å®‰å…¨å¤±è´¥çš„ã€‚å¿«é€Ÿå¤±è´¥çš„è¿­ä»£å™¨ä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸ï¼Œè€Œå®‰å…¨å¤±è´¥çš„è¿­ä»£å™¨æ°¸è¿œä¸ä¼šæŠ›å‡ºè¿™æ ·çš„å¼‚å¸¸ã€‚</p>
<h2 id="Enumeration-æ¥å£å’Œ-Iterator-æ¥å£çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ"><a href="#Enumeration-æ¥å£å’Œ-Iterator-æ¥å£çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Enumeration æ¥å£å’Œ Iterator æ¥å£çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ"></a>Enumeration æ¥å£å’Œ Iterator æ¥å£çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ</h2><p>Enumeration é€Ÿåº¦æ˜¯ Iterator çš„2å€ï¼ŒåŒæ—¶å ç”¨æ›´å°‘çš„å†…å­˜ã€‚ä½†æ˜¯ï¼ŒIterator è¿œè¿œæ¯” Enumeration å®‰å…¨ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹ä¸èƒ½å¤Ÿä¿®æ”¹æ­£åœ¨è¢« iterator éå†çš„é›†åˆé‡Œé¢çš„å¯¹è±¡ã€‚åŒæ—¶ï¼ŒIterator å…è®¸è°ƒç”¨è€…åˆ é™¤åº•å±‚é›†åˆé‡Œé¢çš„å…ƒç´ ï¼Œè¿™å¯¹ Enumeration æ¥è¯´æ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<h2 id="comparable-å’Œ-Comparator-çš„åŒºåˆ«"><a href="#comparable-å’Œ-Comparator-çš„åŒºåˆ«" class="headerlink" title="comparable å’Œ Comparator çš„åŒºåˆ«"></a>comparable å’Œ Comparator çš„åŒºåˆ«</h2><p>Comparableå’ŒComparatoréƒ½æ˜¯ç”¨æ¥å®ç°é›†åˆä¸­å…ƒç´ çš„æ¯”è¾ƒã€æ’åºçš„ã€‚</p>
<ul>
<li><p>Comparableæ˜¯åœ¨é›†åˆå†…éƒ¨å®šä¹‰çš„æ–¹æ³•å®ç°çš„æ’åºï¼Œä½äºjava.lang ä¸‹ã€‚</p>
</li>
<li><p>Comparatoræ˜¯åœ¨é›†åˆå¤–éƒ¨å®ç°çš„æ’åºï¼Œä½äºjava.util ä¸‹ã€‚</p>
</li>
</ul>
<p>Comparableæ˜¯ä¸€ä¸ªå¯¹è±¡æœ¬èº«å°±å·²ç»æ”¯æŒè‡ªæ¯”è¾ƒæ‰€éœ€è¦å®ç°çš„æ¥å£ï¼Œå¦‚Stringã€Integerè‡ªå·±å°±å®ç°äº†Comparableæ¥å£ï¼Œå¯å®Œæˆæ¯”è¾ƒå¤§å°æ“ä½œã€‚è‡ªå®šä¹‰ç±»è¦åœ¨åŠ å…¥listå®¹å™¨ä¸­åèƒ½å¤Ÿæ’åºï¼Œä¹Ÿå¯ä»¥å®ç°Comparableæ¥å£ï¼Œåœ¨ç”¨Collectionsç±»çš„sortæ–¹æ³•æ’åºæ—¶è‹¥ä¸æŒ‡å®šComparatorï¼Œé‚£å°±ä»¥è‡ªç„¶é¡ºåºæ’åºã€‚æ‰€è°“è‡ªç„¶é¡ºåºå°±æ˜¯å®ç°Comparableæ¥å£è®¾å®šçš„æ’åºæ–¹å¼ã€‚</p>
<p>Comparatoræ˜¯ä¸€ä¸ªä¸“ç”¨çš„æ¯”è¾ƒå™¨ï¼Œå½“è¿™ä¸ªå¯¹è±¡ä¸æ”¯æŒè‡ªæ¯”è¾ƒæˆ–è€…è‡ªæ¯”è¾ƒå‡½æ•°ä¸èƒ½æ»¡è¶³è¦æ±‚æ—¶ï¼Œå¯å†™ä¸€ä¸ªæ¯”è¾ƒå™¨æ¥å®Œæˆä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å¤§å°çš„æ¯”è¾ƒã€‚Comparatorä½“ç°äº†ä¸€ç§ç­–ç•¥æ¨¡å¼(strategy design pattern)ï¼Œå°±æ˜¯ä¸æ”¹å˜å¯¹è±¡è‡ªèº«ï¼Œè€Œç”¨ä¸€ä¸ªç­–ç•¥å¯¹è±¡(strategy object)æ¥æ”¹å˜å®ƒçš„è¡Œä¸ºã€‚æ€»è€Œè¨€ä¹‹Comparableæ˜¯è‡ªå·²å®Œæˆæ¯”è¾ƒï¼ŒComparatoræ˜¯å¤–éƒ¨ç¨‹åºå®ç°æ¯”è¾ƒã€‚</p>
<p>é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903603258261518">https://juejin.cn/post/6844903603258261518</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Integer&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">arrayList.add(-<span class="number">1</span>);</span><br><span class="line">arrayList.add(<span class="number">3</span>);</span><br><span class="line">arrayList.add(<span class="number">3</span>);</span><br><span class="line">arrayList.add(-<span class="number">5</span>);</span><br><span class="line">arrayList.add(<span class="number">7</span>);</span><br><span class="line">arrayList.add(<span class="number">4</span>);</span><br><span class="line">arrayList.add(-<span class="number">9</span>);</span><br><span class="line">arrayList.add(-<span class="number">7</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;åŸå§‹æ•°ç»„:&quot;</span>);</span><br><span class="line">System.out.println(arrayList);</span><br><span class="line"><span class="comment">// void reverse(List list)ï¼šåè½¬</span></span><br><span class="line">Collections.reverse(arrayList);</span><br><span class="line">System.out.println(<span class="string">&quot;Collections.reverse(arrayList):&quot;</span>);</span><br><span class="line">System.out.println(arrayList);</span><br><span class="line"></span><br><span class="line"><span class="comment">// void sort(List list),æŒ‰è‡ªç„¶æ’åºçš„å‡åºæ’åº</span></span><br><span class="line">Collections.sort(arrayList);</span><br><span class="line">System.out.println(<span class="string">&quot;Collections.sort(arrayList):&quot;</span>);</span><br><span class="line">System.out.println(arrayList);</span><br><span class="line"><span class="comment">// å®šåˆ¶æ’åºçš„ç”¨æ³•</span></span><br><span class="line">Collections.sort(arrayList, <span class="keyword">new</span> Comparator&lt;Integer&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Integer o1, Integer o2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o2.compareTo(o1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">&quot;å®šåˆ¶æ’åºåï¼š&quot;</span>);</span><br><span class="line">System.out.println(arrayList);</span><br><span class="line"></span><br><span class="line">OutPut :</span><br><span class="line"></span><br><span class="line">åŸå§‹æ•°ç»„:</span><br><span class="line">[-<span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, -<span class="number">5</span>, <span class="number">7</span>, <span class="number">4</span>, -<span class="number">9</span>, -<span class="number">7</span>]</span><br><span class="line">Collections.reverse(arrayList):</span><br><span class="line">[-<span class="number">7</span>, -<span class="number">9</span>, <span class="number">4</span>, <span class="number">7</span>, -<span class="number">5</span>, <span class="number">3</span>, <span class="number">3</span>, -<span class="number">1</span>]</span><br><span class="line">Collections.sort(arrayList):</span><br><span class="line">[-<span class="number">9</span>, -<span class="number">7</span>, -<span class="number">5</span>, -<span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>]</span><br><span class="line">å®šåˆ¶æ’åºåï¼š</span><br><span class="line">[<span class="number">7</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, -<span class="number">1</span>, -<span class="number">5</span>, -<span class="number">7</span>, -<span class="number">9</span>]</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">// personå¯¹è±¡æ²¡æœ‰å®ç°Comparableæ¥å£ï¼Œæ‰€ä»¥å¿…é¡»å®ç°ï¼Œè¿™æ ·æ‰ä¸ä¼šå‡ºé”™ï¼Œæ‰å¯ä»¥ä½¿treemapä¸­çš„æ•°æ®æŒ‰é¡ºåºæ’åˆ—</span></span><br><span class="line"><span class="comment">// å‰é¢ä¸€ä¸ªä¾‹å­çš„Stringç±»å·²ç»é»˜è®¤å®ç°äº†Comparableæ¥å£ï¼Œè¯¦ç»†å¯ä»¥æŸ¥çœ‹Stringç±»çš„APIæ–‡æ¡£ï¼Œå¦å¤–å…¶ä»–</span></span><br><span class="line"><span class="comment">// åƒIntegerç±»ç­‰éƒ½å·²ç»å®ç°äº†Comparableæ¥å£ï¼Œæ‰€ä»¥ä¸éœ€è¦å¦å¤–å®ç°äº†</span></span><br><span class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Person</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Té‡å†™compareToæ–¹æ³•å®ç°æŒ‰å¹´é¾„æ¥æ’åº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Person o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.age &gt; o.getAge()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.age &lt; o.getAge()) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TreeMap&lt;Person, String&gt; pdata = <span class="keyword">new</span> TreeMap&lt;Person, String&gt;();</span><br><span class="line">        pdata.put(<span class="keyword">new</span> Person(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">30</span>), <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        pdata.put(<span class="keyword">new</span> Person(<span class="string">&quot;æå››&quot;</span>, <span class="number">20</span>), <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        pdata.put(<span class="keyword">new</span> Person(<span class="string">&quot;ç‹äº”&quot;</span>, <span class="number">10</span>), <span class="string">&quot;wangwu&quot;</span>);</span><br><span class="line">        pdata.put(<span class="keyword">new</span> Person(<span class="string">&quot;å°çº¢&quot;</span>, <span class="number">5</span>), <span class="string">&quot;xiaohong&quot;</span>);</span><br><span class="line">        <span class="comment">// å¾—åˆ°keyçš„å€¼çš„åŒæ—¶å¾—åˆ°keyæ‰€å¯¹åº”çš„å€¼</span></span><br><span class="line">        Set&lt;Person&gt; keys = pdata.keySet();</span><br><span class="line">        <span class="keyword">for</span> (Person key : keys) &#123;</span><br><span class="line">            System.out.println(key.getAge() + <span class="string">&quot;-&quot;</span> + key.getName());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">OutPut :</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>-å°çº¢</span><br><span class="line"><span class="number">10</span>-ç‹äº”</span><br><span class="line"><span class="number">20</span>-æå››</span><br><span class="line"><span class="number">30</span>-å¼ ä¸‰</span><br></pre></td></tr></table></figure>

<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><h3 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h3><p><strong>é»˜è®¤åˆå§‹å®¹é‡ä¸º0ï¼ˆæ— å‚æ„é€ ï¼Œæ‡’åˆå§‹åŒ–ï¼Œé¦–æ¬¡åˆå§‹åŒ–10ï¼‰ï¼Œ æ‰©å®¹æ—¶ï¼Œæ‰©å®¹å¤§å°ä¸ºä¹‹å‰çš„1.5å€</strong></p>
<p>ArrayList æ˜¯ List æ¥å£çš„å¯å˜æ•°ç»„çš„å®ç°ã€‚åº•å±‚ä½¿ç”¨ Object[] æ¥å­˜å‚¨å¯¹è±¡ã€‚åŒæ—¶æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆã€‚</p>
<p>æ¯ä¸ªArrayListå®ä¾‹éƒ½æœ‰ä¸€ä¸ªå®¹é‡ï¼Œè¯¥å®¹é‡æ˜¯æŒ‡ç”¨æ¥å­˜å‚¨åˆ—è¡¨å…ƒç´ çš„æ•°ç»„çš„å¤§å°ã€‚éšç€å‘ArrayListä¸­ä¸æ–­æ·»åŠ å…ƒç´ ï¼Œå…¶å®¹é‡ä¹Ÿè‡ªåŠ¨å¢é•¿ã€‚è‡ªåŠ¨å¢é•¿ä¼šå¸¦æ¥æ•°æ®å‘æ–°æ•°ç»„çš„é‡æ–°æ‹·è´ï¼Œå› æ­¤ï¼Œå¦‚æœå¯é¢„çŸ¥æ•°æ®é‡çš„å¤§å°ï¼Œå°±å¯åœ¨æ„é€ ArrayListå®ä¾‹æ—¶æŒ‡å®šå…¶å®¹é‡ã€‚</p>
<p>åœ¨æ·»åŠ å¤§é‡å…ƒç´ å‰ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥ä½¿ç”¨ensureCapacityæ“ä½œæ¥å¢åŠ ArrayListå®ä¾‹çš„å®¹é‡ï¼Œè¿™å¯ä»¥å‡å°‘é€’å¢å¼å†åˆ†é…çš„æ•°é‡ã€‚</p>
<ul>
<li><p>ç»§æ‰¿è‡ª AbstractListï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å¯¹ä¸€äº›åŸºç¡€çš„listæ“ä½œåšäº†ä¸€äº›å°è£…ã€‚</p>
</li>
<li><p>å®ç°äº†RandomAccess æ ‡è®°æ¥å£ï¼Œè¡¨æ˜å¯ä»¥å®ç°å¿«é€Ÿéšæœºè®¿é—®ã€‚</p>
</li>
<li><p>å®ç°äº†Cloneableæ¥å£çš„å®ç°è¡¨ç¤ºè¯¥å®¹å™¨å…·æœ‰Cloneå‡½æ•°æ“ä½œï¼ŒSerializableæ˜¯åºåˆ—åŒ–ã€‚</p>
</li>
</ul>
<h4 id="RandomAccess-æ¥å£çš„ä½œç”¨"><a href="#RandomAccess-æ¥å£çš„ä½œç”¨" class="headerlink" title="RandomAccess æ¥å£çš„ä½œç”¨"></a>RandomAccess æ¥å£çš„ä½œç”¨</h4><p>**<code>ArrayList</code> <strong>å®ç°äº†</strong> <code>RandomAccess</code> <strong>æ¥å£ï¼Œå°±è¡¨æ˜äº†ä»–å…·æœ‰å¿«é€Ÿéšæœºè®¿é—®åŠŸèƒ½ã€‚</strong> <code>RandomAccess</code> <strong>æ¥å£åªæ˜¯æ ‡è¯†ï¼Œå¹¶ä¸æ˜¯è¯´</strong> <code>ArrayList</code> <strong>å®ç°</strong> <code>RandomAccess</code>  æ¥å£æ‰å…·æœ‰å¿«é€Ÿéšæœºè®¿é—®åŠŸèƒ½çš„ï¼</p>
<h4 id="ä¸ºä»€ä¹ˆArrayListè‡ªåŠ¨å®¹é‡æ‰©å……é€‰æ‹©æ‰©å……1-5å€ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆArrayListè‡ªåŠ¨å®¹é‡æ‰©å……é€‰æ‹©æ‰©å……1-5å€ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆArrayListè‡ªåŠ¨å®¹é‡æ‰©å……é€‰æ‹©æ‰©å……1.5å€ï¼Ÿ"></a>ä¸ºä»€ä¹ˆArrayListè‡ªåŠ¨å®¹é‡æ‰©å……é€‰æ‹©æ‰©å……1.5å€ï¼Ÿ</h4><p>è¿™ç§ç®—æ³•æ„é€ å‡ºæ¥çš„æ–°çš„æ•°ç»„é•¿åº¦çš„å¢é‡éƒ½ä¼šæ¯”ä¸Šä¸€æ¬¡å¤§( è€Œä¸”æ˜¯è¶Šæ¥è¶Šå¤§) ï¼Œé¿å…é¢‘ç¹newInstance çš„æƒ…å†µã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆArrayList-ä¸é€‚åˆé¢‘ç¹æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆArrayList-ä¸é€‚åˆé¢‘ç¹æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆArrayList ä¸é€‚åˆé¢‘ç¹æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Ÿ"></a>ä¸ºä»€ä¹ˆArrayList ä¸é€‚åˆé¢‘ç¹æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Ÿ</h4><p>ArrayListä¸­ç»å¸¸ä¼šè°ƒç”¨ System.arraycopy è¿™ä¸ªæ•ˆç‡å¾ˆä½çš„æ“ä½œæ¥å¤åˆ¶æ•°ç»„ï¼Œæ‰€ä»¥å¯¼è‡´ArrayListåœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œä¸­æ•ˆç‡ä¸é«˜ã€‚</p>
<h4 id="jdk1-6ä¸­æ‰©å®¹ç®—æ³•çš„ç¼ºé™·"><a href="#jdk1-6ä¸­æ‰©å®¹ç®—æ³•çš„ç¼ºé™·" class="headerlink" title="jdk1.6ä¸­æ‰©å®¹ç®—æ³•çš„ç¼ºé™·"></a>jdk1.6ä¸­æ‰©å®¹ç®—æ³•çš„ç¼ºé™·</h4><p>ï¼ˆç”±äºjdk1.7å’Œjdk1.8åœ¨æ‰©å®¹ç®—æ³•æ–¹é¢å·®åˆ«ä¸å¤§ï¼Œæ‰€ä»¥ä¸‹é¢æ²¡æœ‰ä¸¥æ ¼åŒºåˆ†ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">jdk1<span class="number">.6</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;  </span><br><span class="line">    modCount++;  </span><br><span class="line">    <span class="keyword">int</span> oldCapacity = elementData.length;  </span><br><span class="line">    <span class="keyword">if</span> (minCapacity &gt; oldCapacity) &#123;  </span><br><span class="line">        Object oldData[] = elementData;  </span><br><span class="line">        <span class="keyword">int</span> newCapacity = (oldCapacity * <span class="number">3</span>)/<span class="number">2</span> + <span class="number">1</span>;  </span><br><span class="line">        <span class="keyword">if</span> (newCapacity &lt; minCapacity)  </span><br><span class="line">            newCapacity = minCapacity;  </span><br><span class="line">        <span class="comment">// minCapacity is usually close to size, so this is a win:  </span></span><br><span class="line">        elementData = Arrays.copyOf(elementData, newCapacity);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºjdk1.6çš„ensureCapacityæ–¹æ³•åªæ˜¯ç®€å•è¿›è¡Œäº†é€»è¾‘ä¸Šçš„æ“ä½œï¼Œæ²¡æœ‰è¿‡å¤šè€ƒè™‘intå‹æº¢å‡ºçš„é—®é¢˜ï¼Œä»1.7å¼€å§‹å¯¹è¿™ä¸ªè¿›è¡Œäº†å®Œå–„ã€‚</p>
<p>è€Œä¸”æ²¡è€ƒè™‘å…¥å‚minCapacityå¯èƒ½å› ä¸ºintæº¢å‡ºå˜ä¸ºè´Ÿæ•°ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥å¤–éƒ¨æ‰‹åŠ¨è°ƒç”¨ï¼Œæ‰‹åŠ¨æ‰©å®¹ä¼ å…¥è´Ÿæ•°è¿™ä¸ªè‚¯å®šæ˜¯åº”è¯¥æ‹¦æˆªæ‰çš„ã€‚ä½†æ˜¯è‡ªåŠ¨æ‰©å®¹ä¼šå› ä¸ºintæº¢å‡ºäº§ç”Ÿè´Ÿæ•°ï¼Œç¢°åˆ°è¿™ç§æƒ…å†µæ—¶åº”è¯¥ç‰¹æ®Šå¤„ç†ï¼Œè€Œä¸æ˜¯ä»€ä¹ˆéƒ½ä¸åšï¼Œç­‰ç€åé¢æŠ›å‡ºä¸€ä¸ªArrayIndexOutOfBoundsExceptionã€‚</p>
<p>è¿˜æœ‰å°±æ˜¯ä¸‹é¢è¿™å¥ä»£ç ä¼šé€ æˆè¿‡æ—©æº¢å‡º</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> newCapacity = (oldCapacity * <span class="number">3</span>)/<span class="number">2</span> + <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶ä¸Šé¢è¿™è¡Œä»£ç å’Œ1.7å¼€å§‹çš„oldCapacity + (oldCapacity &gt;&gt; 1) å·®ä¸å¤šï¼Œéƒ½æ˜¯ç›¸å½“äº1.5å€ï¼Œä½†å®é™…ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>
<p><strong>è¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªåŒºåˆ«</strong></p>
<p><strong>ç¬¬ä¸€ä¸ªåŒºåˆ«</strong>æ˜¯jdk1.6çš„ä¹˜é™¤è¿ç®—çš„æ•°å­¦ç»“æœæ¯”åé¢ä¸€ä¸ªå¤§1æ¯”å¦‚oldCapacity=10ï¼Œ1.6çš„ç®—æ³•å¾—åˆ°16ï¼Œ1.7å¼€å§‹çš„ç®—æ³•å¾—åˆ°15ï¼Œè¿™ä¸ªå½±å“ä¸å¤§ï¼›</p>
<p><strong>ç¬¬äºŒä¸ªåŒºåˆ«</strong>å°±æ˜¯ä¸¤è€…åœ¨æ•°å­—æ¯”è¾ƒå¤§æ—¶è¿ç®—ç»“æœä¸ä¸€æ ·ï¼Œæ¯”å¦‚oldCapacity=10^9ï¼Œè¿™ä¸ªæ•°å’ŒInteger.MAX_VALUEä½æ•°ä¸€æ ·ï¼Œç”¨1.6çš„ç®—æ³•å¾—åˆ°çš„ä¼šæ˜¯é”™è¯¯çš„-647483647ï¼Œç”¨1.7çš„åˆ™æ˜¯æ­£ç¡®çš„1500000000ï¼Œè¿™æ—¶å€™æ˜æ˜å¯ä»¥1.5å€æ‰©å®¹ï¼Œä½†æ˜¯jdk1.6å´ç”¨çš„æ˜¯æŒ‰éœ€æ‰©å®¹ã€‚</p>
<p>ensureCapacityï¼ˆç§°ä¹‹ä¸ºæ‰‹åŠ¨ï¼Œæ˜¯å› ä¸ºæ­¤æ–¹æ³•æ˜¯publicçš„ï¼Œå¯ä»¥å¤–éƒ¨æ‰‹åŠ¨è°ƒç”¨ï¼‰ã€‚åœ¨1.6ç‰ˆæœ¬æ˜¯åªæœ‰è¿™ä¸ªæ‰‹åŠ¨çš„æ–¹æ³•ï¼Œå†…éƒ¨è‡ªåŠ¨æ“ä½œä¹Ÿæ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œ1.7å¼€å§‹è¿›è¡Œäº†åŒºåˆ†ï¼Œå¹¶ä¸”è¿›ä¸€æ­¥æ”¹è¿›äº†æ‰©å®¹æ“ä½œã€‚</p>
<ul>
<li><p>ä»1.7å¼€å§‹å°†å†…éƒ¨æ‰©å®¹å’Œå¤–éƒ¨å¯ä»¥è°ƒç”¨çš„æ‰©å®¹æ–¹æ³•åˆ†å¼€äº†ï¼Œé€šè¿‡æºç å¯ä»¥çœ‹å‡ºï¼šå¤–éƒ¨è°ƒç”¨çš„æ‰‹åŠ¨æ‰©å®¹æ–¹æ³•ensureCapacityè¦å¤šä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ minCapacity &gt;  minExpandï¼Œè¿™ä¸ªåˆ¤æ–­æ¡ä»¶æ‹¦æˆªæ‰è´Ÿæ•°çš„minCapacityï¼Œè¿™æ ·è°ƒç”¨å†…éƒ¨æ‰©å®¹ensureCapacityInternalæ–¹æ³•æ—¶ï¼ŒminCapacityä¸€å®šæ˜¯æ­£æ•°ï¼›å†…éƒ¨æ‰©å®¹æ–¹æ³•ç›´æ¥å°±ç”¨minCapacity - elementData.length &gt; 0åˆ¤æ–­ï¼Œæ­¤æ¡ä»¶å¯ä»¥æ£€æµ‹å‡ºintå‹æº¢å‡ºï¼Œç¢°åˆ°æº¢å‡ºæœ€åä¼šæŠ›å‡ºä¸€ä¸ªOOMé”™è¯¯ã€‚jdk1.7ç”¨OOMï¼Œè¿™æ¯”jdk1.6ç”¨ArrayIndexOutOfBoundsExceptionæ›´å¥½ï¼Œå› ä¸ºæ­¤æ—¶æ•°ç»„å¤§å°è¶…å‡ºäº†è™šæ‹Ÿæœºå¯¹æ•°ç»„çš„é™åˆ¶ï¼Œè™šæ‹Ÿæœºæ— æ³•å¤„ç†è¿™ç§æƒ…å†µäº†ï¼ŒæŠ›å‡ºä¸€ä¸ªERRORæ˜¯åˆç†çš„ã€‚</p>
</li>
<li><p>ä½¿ç”¨è¿™è¡Œä»£ç </p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™è¡Œä»£ç ä¸ä»…ä»…æ˜¯ä½¿ç”¨ä½è¿ç®—åŠ å¿«æ‰§è¡Œé€Ÿåº¦ï¼Œä¸Šé¢è¯´äº†ï¼Œè¿™ç§åšæ³•æ‰æ˜¯å¯¹çš„ï¼Œæ˜¯çœŸæ­£çš„1.5å€ã€‚ä¸ä»…ä»…å› ä¸ºé‚£ä¸€ä¸ªå¤§å°çš„å·®åˆ«ï¼Œæ›´é‡è¦çš„æ˜¯é¿å…è¿‡æ—©å‡ºç°intæº¢å‡ºçš„æƒ…å†µï¼Œä¿è¯äº†å†…éƒ¨è‡ªåŠ¨æ‰©å®¹ä¼šå°½é‡æŒ‰è§„å®šçš„ç­–ç•¥æ‰§è¡Œã€‚åŒæ—¶æ•´ä¸ªæ‰©å®¹å¤„ç†æµç¨‹ä¸­å¤šå¢åŠ äº†å‡ å¤„ifåˆ¤æ–­ï¼Œå¯¹å„ç§æƒ…å†µå¤„ç†æ›´åŠ å®Œå–„ã€‚</p>
<h4 id="Integer-MAX-VALUE-8-è¿™é‡Œä¸ºä»€ä¹ˆè¦å‡å»8ï¼Ÿ"><a href="#Integer-MAX-VALUE-8-è¿™é‡Œä¸ºä»€ä¹ˆè¦å‡å»8ï¼Ÿ" class="headerlink" title="Integer.MAX_VALUE - 8  è¿™é‡Œä¸ºä»€ä¹ˆè¦å‡å»8ï¼Ÿ"></a>Integer.MAX_VALUE - 8  è¿™é‡Œä¸ºä»€ä¹ˆè¦å‡å»8ï¼Ÿ</h4><p>ä¸»è¦æ˜¯è€ƒè™‘åˆ°ä¸åŒçš„JVM,æœ‰çš„VMä¼šåœ¨åŠ å…¥ä¸€äº›æ•°æ®å¤´,å½“æ‰©å®¹åçš„å®¹é‡å¤§äºMAX_ARRAY_SIZE,æˆ‘ä»¬ä¼šå°†æœ€å°éœ€è¦å®¹é‡å’ŒMAX_ARRAY_SIZEåšæ¯”è¾ƒ,å¦‚æœæ¯”å®ƒå¤§, åªèƒ½å–Integer.MAX_VALUE,å¦åˆ™æ˜¯Integer.MAX_VALUE -8ã€‚<strong>è¿™ä¸ªæ˜¯ä»jdk1.7å¼€å§‹æ‰æœ‰çš„</strong></p>
<h4 id="modCountå±æ€§çš„ä½œç”¨ï¼Ÿ"><a href="#modCountå±æ€§çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="modCountå±æ€§çš„ä½œç”¨ï¼Ÿ"></a>modCountå±æ€§çš„ä½œç”¨ï¼Ÿ</h4><p><code>modCount</code>å±æ€§ä»£è¡¨ä¸ºç»“æ„æ€§ä¿®æ”¹ï¼ˆ æ”¹å˜listçš„sizeå¤§å°ã€ä»¥å…¶ä»–æ–¹å¼æ”¹å˜ä»–å¯¼è‡´æ­£åœ¨è¿›è¡Œè¿­ä»£æ—¶å‡ºç°é”™è¯¯çš„ç»“æœï¼‰çš„æ¬¡æ•°ï¼Œè¯¥å±æ€§è¢«<code>Iterato</code>rä»¥åŠ<code>ListIterator</code>çš„å®ç°ç±»æ‰€ä½¿ç”¨ï¼Œä¸”å¾ˆå¤šéçº¿ç¨‹å®‰å…¨ä½¿ç”¨<code>modCount</code>å±æ€§ã€‚</p>
<p> åˆå§‹åŒ–è¿­ä»£å™¨æ—¶ä¼šç»™è¿™ä¸ªmodCountèµ‹å€¼ï¼Œå¦‚æœåœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°è¿™ä¸ªå¯¹è±¡çš„modCountå’Œè¿­ä»£å™¨å­˜å‚¨çš„modCountä¸ä¸€æ ·ï¼Œ<code>Iterator</code>æˆ–è€…<code>ListIterator</code> å°†æŠ›å‡º<code>ConcurrentModificationException</code>å¼‚å¸¸ï¼Œ</p>
<p>è¿™æ˜¯jdkåœ¨é¢å¯¹è¿­ä»£éå†çš„æ—¶å€™ä¸ºäº†é¿å…ä¸ç¡®å®šæ€§è€Œé‡‡å–çš„ fail-fastï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰åŸåˆ™ï¼š</p>
<p>åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆä¸­ï¼Œå¦‚æœä½¿ç”¨è¿­ä»£å™¨çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°é›†åˆè¢«ä¿®æ”¹ï¼Œä¼šæŠ›å‡º<code>ConcurrentModificationExceptions</code>é”™è¯¯ï¼Œè¿™å°±æ˜¯fail-fastæœºåˆ¶ã€‚å¯¹é›†åˆè¿›è¡Œç»“æ„æ€§ä¿®æ”¹æ—¶ï¼Œ<code>modCount</code>éƒ½ä¼šå¢åŠ ï¼Œåœ¨åˆå§‹åŒ–è¿­ä»£å™¨æ—¶ï¼Œ<code>modCount</code>çš„å€¼ä¼šèµ‹ç»™<code>expectedModCount</code>ï¼Œåœ¨è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œåªè¦<code>modCount</code>æ”¹å˜äº†ï¼Œ<code>int expectedModCount = modCount</code>ç­‰å¼å°±ä¸æˆç«‹äº†ï¼Œè¿­ä»£å™¨æ£€æµ‹åˆ°è¿™ä¸€ç‚¹ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ï¼š<code>urrentModificationExceptions</code>ã€‚</p>
<h4 id="jdk1-8çš„æ— å‚æ„é€ å‡½æ•°å’Œä¹‹å‰ç‰ˆæœ¬çš„æ„é€ å‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#jdk1-8çš„æ— å‚æ„é€ å‡½æ•°å’Œä¹‹å‰ç‰ˆæœ¬çš„æ„é€ å‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="jdk1.8çš„æ— å‚æ„é€ å‡½æ•°å’Œä¹‹å‰ç‰ˆæœ¬çš„æ„é€ å‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«?"></a>jdk1.8çš„æ— å‚æ„é€ å‡½æ•°å’Œä¹‹å‰ç‰ˆæœ¬çš„æ„é€ å‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«?</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">jdk1<span class="number">.6</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;    </span><br><span class="line">    <span class="keyword">this</span>(<span class="number">10</span>);    </span><br><span class="line">&#125; </span><br><span class="line">jdk1<span class="number">.7</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;    </span><br><span class="line">    <span class="keyword">super</span>();    </span><br><span class="line">    <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;    </span><br><span class="line">&#125;</span><br><span class="line">jdk1<span class="number">.8</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;    </span><br><span class="line">    <span class="keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹æ¯”ä¸‹å¯ä»¥çœ‹å‡ºï¼šjdk1.6çš„æ— å‚æ„é€ æ–¹æ³•ï¼ˆé»˜è®¤æ„é€ æ–¹æ³•ï¼‰æ„é€ çš„ArrayListçš„åº•å±‚æ•°ç»„elementDataå¤§å°ï¼ˆå®¹é‡ï¼‰é»˜è®¤ä¸º10ï¼›ä»1.7å¼€å§‹ï¼Œæ— å‚æ„é€ æ–¹æ³•æ„é€ çš„ArrayListçš„åº•å±‚æ•°ç»„elementDataå¤§å°é»˜è®¤ä¸º0ã€‚</p>
<p>javaé›†åˆç±»åœ¨jdk1.7ç‰ˆæœ¬åŸºæœ¬ä¸Šéƒ½æœ‰ä¸€ç§æ”¹åŠ¨ï¼šæ‡’åˆå§‹åŒ–ã€‚æ‡’åˆå§‹åŒ–æŒ‡çš„æ˜¯é»˜è®¤æ„é€ æ–¹æ³•æ„é€ çš„é›†åˆç±»ï¼Œå æ®å°½å¯èƒ½å°‘çš„å†…å­˜ç©ºé—´ï¼ˆå¯¹äºArrayListæ¥è¯´ï¼Œä½¿ç”¨ç©ºæ•°ç»„æ¥å æ®å°½é‡å°‘çš„ç©ºé—´ï¼Œä¸ä½¿ç”¨nullæ˜¯ä¸ºäº†é¿å…nullåˆ¤æ–­ï¼‰ï¼Œåœ¨ç¬¬ä¸€æ¬¡è¿›è¡ŒåŒ…å«æœ‰æ·»åŠ è¯­ä¹‰çš„æ“ä½œæ—¶ï¼Œæ‰è¿›è¡ŒçœŸæ­£çš„<strong>åˆå§‹åŒ–</strong>å·¥ä½œã€‚</p>
<p>1.7å¼€å§‹çš„ArrayListï¼Œé»˜è®¤æ„é€ æ–¹æ³•æ„é€ çš„å®ä¾‹ï¼Œåº•å±‚æ•°ç»„æ˜¯ç©ºæ•°ç»„ï¼Œå®¹é‡ä¸º0ï¼Œåœ¨è¿›è¡Œç¬¬ä¸€æ¬¡add/addAllç­‰æ“ä½œæ—¶æ‰ä¼šçœŸæ­£ç»™åº•å±‚æ•°ç»„èµ‹éemptyçš„å€¼ã€‚å¦‚æœadd/addAllæ·»åŠ çš„å…ƒç´ å°äº10ï¼Œåˆ™æŠŠelementDataæ•°ç»„æ‰©å®¹ä¸º10ä¸ªå…ƒç´ å¤§å°ï¼Œå¦åˆ™ä½¿ç”¨åˆšå¥½åˆé€‚çš„å¤§å°ï¼ˆä¾‹å¦‚ï¼Œç¬¬ä¸€æ¬¡addAllæ·»åŠ 6ä¸ªï¼Œé‚£ä¹ˆæ‰©å®¹ä¸º10ä¸ªï¼Œç¬¬ä¸€æ¬¡æ·»åŠ å¤§äº10ä¸ªçš„ï¼Œæ¯”å¦‚24ä¸ªï¼Œæ‰©å®¹ä¸º24ä¸ªï¼Œåˆšå¥½åˆé€‚ï¼‰</p>
<p>1.8ç‰ˆæœ¬ï¼Œé»˜è®¤æ„é€ çš„å®ä¾‹è¿™ä¸ªè¡Œä¸ºæ²¡æœ‰æ”¹å˜ï¼Œåªæ˜¯ç”¨çš„æ•°ç»„åå­—å˜äº†ã€‚</p>
<h3 id="ArrayList-å’Œ-LinkedList-çš„æ’å…¥å’Œè®¿é—®çš„æ—¶é—´å¤æ‚åº¦"><a href="#ArrayList-å’Œ-LinkedList-çš„æ’å…¥å’Œè®¿é—®çš„æ—¶é—´å¤æ‚åº¦" class="headerlink" title="ArrayList å’Œ LinkedList çš„æ’å…¥å’Œè®¿é—®çš„æ—¶é—´å¤æ‚åº¦"></a>ArrayList å’Œ LinkedList çš„æ’å…¥å’Œè®¿é—®çš„æ—¶é—´å¤æ‚åº¦</h3><p>ArrayList åº•å±‚æ˜¯åŸºäº Object[] æ¥è¿›è¡Œæ•°æ®å­˜å‚¨çš„ï¼Œé’ˆå¯¹æ•°æ®çš„æ’å…¥å’Œåˆ é™¤éœ€è¦è¿›è¡Œæ•°æ®çš„ç§»åŠ¨å› æ­¤æ—¶é—´å¤æ‚åº¦å¤§è‡´ä¸ºOï¼ˆnï¼‰ï¼Œæ•°æ®æ”¯æŒæŒ‰ç…§ä¸‹æ ‡è¿›è¡Œéšæœºè®¿é—®ï¼Œå› æ­¤è®¿é—®æ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆ1ï¼‰</p>
<p>LinkedList åº•å±‚æ˜¯åŸºäºåŒå‘é“¾è¡¨æ¥è¿›è¡Œæ•°æ®å­˜å‚¨çš„ï¼Œé’ˆå¯¹æ•°æ®çš„æ’å…¥å’Œåˆ é™¤åªéœ€è¦æ›¿æ¢å“åº”çš„æŒ‡é’ˆå³å¯ï¼Œå› æ­¤æ’å…¥çš„æ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆ1ï¼‰ï¼Œç”±äºé“¾è¡¨ç»“æ„ä¸æ”¯æŒéšæœºè®¿é—®æŸ¥æ‰¾å…ƒç´ åªèƒ½è¿›è¡Œéå†ï¼Œå› æ­¤è®¿é—®æ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆnï¼‰</p>
<h3 id="ArrayListå’ŒLinkedListçš„åŒºåˆ«ã€ä¼˜ç¼ºç‚¹ä»¥åŠåº”ç”¨åœºæ™¯"><a href="#ArrayListå’ŒLinkedListçš„åŒºåˆ«ã€ä¼˜ç¼ºç‚¹ä»¥åŠåº”ç”¨åœºæ™¯" class="headerlink" title="ArrayListå’ŒLinkedListçš„åŒºåˆ«ã€ä¼˜ç¼ºç‚¹ä»¥åŠåº”ç”¨åœºæ™¯"></a>ArrayListå’ŒLinkedListçš„åŒºåˆ«ã€ä¼˜ç¼ºç‚¹ä»¥åŠåº”ç”¨åœºæ™¯</h3><p><strong>åŒºåˆ«ï¼š</strong></p>
<ul>
<li><code>ArrayList</code>æ˜¯å®ç°äº†åŸºäºåŠ¨æ€æ•°ç»„çš„æ•°æ®ç»“æ„ï¼Œ<code>LinkedList</code>æ˜¯åŸºäºé“¾è¡¨ç»“æ„ã€‚</li>
<li>å¯¹äºéšæœºè®¿é—®çš„<code>get</code>å’Œ<code>set</code>æ–¹æ³•æŸ¥è¯¢å…ƒç´ ï¼Œ<code>ArrayList</code>è¦ä¼˜äº<code>LinkedList</code>ï¼Œå› ä¸º<code>LinkedList</code>å¾ªç¯é“¾è¡¨å¯»æ‰¾å…ƒç´ ã€‚</li>
<li>å¯¹äºæ–°å¢å’Œåˆ é™¤æ“ä½œ<code>add</code>å’Œ<code>remove</code>ï¼Œ<code>LinkedList</code>æ¯”è¾ƒé«˜æ•ˆï¼Œå› ä¸º<code>ArrayList</code>è¦ç§»åŠ¨æ•°æ®ã€‚</li>
</ul>
<p><strong>ä¼˜ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å¯¹<code>ArrayList</code>å’Œ<code>LinkedList</code>è€Œè¨€ï¼Œåœ¨æœ«å°¾å¢åŠ ä¸€ä¸ªå…ƒç´ æ‰€èŠ±çš„å¼€é”€éƒ½æ˜¯å›ºå®šçš„ã€‚å¯¹<code>ArrayList</code>è€Œè¨€ï¼Œä¸»è¦æ˜¯åœ¨å†…éƒ¨æ•°ç»„ä¸­å¢åŠ ä¸€é¡¹ï¼ŒæŒ‡å‘æ‰€æ·»åŠ çš„å…ƒç´ ï¼Œå¶å°”å¯èƒ½ä¼šå¯¼è‡´å¯¹æ•°ç»„é‡æ–°è¿›è¡Œåˆ†é…ï¼›è€Œå¯¹<code>LinkedList</code>è€Œè¨€ï¼Œè¿™ä¸ªå¼€é”€æ˜¯ ç»Ÿä¸€çš„ï¼Œåˆ†é…ä¸€ä¸ªå†…éƒ¨<code>Entry</code>å¯¹è±¡ã€‚</li>
<li>åœ¨<code>ArrayList</code>é›†åˆä¸­æ·»åŠ æˆ–è€…åˆ é™¤ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå½“å‰çš„åˆ—è¡¨ç§»åŠ¨å…ƒç´ åé¢æ‰€æœ‰çš„å…ƒç´ éƒ½ä¼šè¢«ç§»åŠ¨ã€‚è€Œ<code>LinkedList</code>é›†åˆä¸­æ·»åŠ æˆ–è€…åˆ é™¤ä¸€ä¸ªå…ƒç´ çš„å¼€é”€æ˜¯å›ºå®šçš„ã€‚</li>
<li><code>LinkedList</code>é›†åˆä¸æ”¯æŒ é«˜æ•ˆçš„éšæœºéšæœºè®¿é—®ï¼ˆ<code>RandomAccess</code>ï¼‰ï¼Œå› ä¸ºå¯èƒ½äº§ç”ŸäºŒæ¬¡é¡¹çš„è¡Œä¸ºã€‚</li>
<li><code>ArrayList</code>çš„ç©ºé—´æµªè´¹ä¸»è¦ä½“ç°åœ¨åœ¨liståˆ—è¡¨çš„ç»“å°¾é¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼Œè€Œ<code>LinkedList</code>çš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æ¶ˆè€—ç›¸å½“çš„ç©ºé—´</li>
</ul>
<p><strong>åº”ç”¨åœºæ™¯:</strong></p>
<p><code>ArrayList</code>ä½¿ç”¨åœ¨æŸ¥è¯¢æ¯”è¾ƒå¤šï¼Œä½†æ˜¯æ’å…¥å’Œåˆ é™¤æ¯”è¾ƒå°‘çš„æƒ…å†µï¼Œè€Œ<code>LinkedList</code>ç”¨åœ¨æŸ¥è¯¢æ¯”è¾ƒå°‘è€Œæ’å…¥åˆ é™¤æ¯”è¾ƒå¤šçš„æƒ…å†µ</p>
<h3 id="Vectorå’ŒArrayList"><a href="#Vectorå’ŒArrayList" class="headerlink" title="Vectorå’ŒArrayList"></a>Vectorå’ŒArrayList</h3><p><strong>ç›¸åŒç‚¹ï¼š</strong>è¿™ä¸¤ä¸ªç±»éƒ½å®ç°äº†Listæ¥å£ï¼Œä»–ä»¬éƒ½æ˜¯æœ‰åºçš„é›†åˆï¼ˆå‚¨å­˜æœ‰åºï¼‰ï¼Œåº•å±‚éƒ½ç”¨æ•°ç»„å®ç°ã€‚å¯ä»¥é€šè¿‡ç´¢å¼•æ¥è·å–æŸä¸ªå…ƒç´ ã€‚å…è®¸å…ƒç´ é‡å¤å’Œå‡ºç°nullå€¼ã€‚ArrayListå’ŒVectorçš„è¿­ä»£å™¨å®ç°éƒ½æ˜¯fail-fastçš„ã€‚</p>
<p><strong>ä¸åŒç‚¹ï¼š</strong>vectoræ˜¯çº¿ç¨‹åŒæ­¥çš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œarraylistæ˜¯çº¿ç¨‹å¼‚æ­¥çš„ï¼Œæ˜¯ä¸å®‰å…¨çš„ã€‚å¦‚æœä¸è€ƒè™‘åˆ°çº¿ç¨‹çš„å®‰å…¨å› ç´ ï¼Œä¸€èˆ¬ç”¨arraylistæ•ˆç‡æ¯”è¾ƒé«˜ã€‚</p>
<p>æ‰©å®¹æ—¶ï¼Œarraylistæ‰©å®¹1.5å€ï¼Œvectoræ‰©å®¹2å€ï¼ˆæˆ–è€…æ‰©å®¹æŒ‡å®šçš„å¤§å°ï¼‰</p>
<p>ArrayList å’ŒVectoræ˜¯é‡‡ç”¨æ•°ç»„æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œæ­¤æ•°ç»„å…ƒç´ æ•°å¤§äºå®é™…å­˜å‚¨çš„æ•°æ®ä»¥ä¾¿å¢åŠ å’Œæ’å…¥å…ƒç´ ï¼Œéƒ½å…è®¸ç›´æ¥åºå·ç´¢å¼•å…ƒç´ ï¼Œä½†æ˜¯æ’å…¥æ•°æ®è¦è®¾è®¡åˆ°æ•°ç»„å…ƒç´ ç§»åŠ¨ç­‰å†…å­˜æ“ä½œï¼Œæ‰€ä»¥ç´¢å¼•æ•°æ®å¿«æ’å…¥æ•°æ®æ…¢ï¼ŒVectorç”±äºä½¿ç”¨äº†synchronizedæ–¹æ³•ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰æ‰€ä»¥æ€§èƒ½ä¸Šæ¯”ArrayListè¦å·®ï¼ŒLinkedListä½¿ç”¨åŒå‘é“¾è¡¨å®ç°å­˜å‚¨ï¼ŒæŒ‰åºå·ç´¢å¼•æ•°æ®éœ€è¦è¿›è¡Œå‘å‰æˆ–å‘åéå†ï¼Œä½†æ˜¯æ’å…¥æ•°æ®æ—¶åªéœ€è¦è®°å½•æœ¬é¡¹çš„å‰åé¡¹å³å¯ï¼Œæ‰€ä»¥æ’å…¥æ•°åº¦è¾ƒå¿«ï¼</p>
<h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h3><p>LinkedListæ˜¯ä¸€ä¸ªå®ç°äº†Listæ¥å£å’ŒDequeæ¥å£çš„åŒç«¯é“¾è¡¨ã€‚ LinkedListåº•å±‚çš„é“¾è¡¨ç»“æ„ä½¿å®ƒæ”¯æŒé«˜æ•ˆçš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œå¦å¤–å®ƒå®ç°äº†Dequeæ¥å£ï¼Œä½¿å¾—LinkedListç±»ä¹Ÿå…·æœ‰é˜Ÿåˆ—çš„ç‰¹æ€§;å…è®¸åŒ…å«nullå€¼ã€‚ LinkedListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœæƒ³ä½¿LinkedListå˜æˆçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥è°ƒç”¨é™æ€ç±»Collectionsç±»ä¸­çš„synchronizedListæ–¹æ³•ï¼š</p>
<p>List list=Collections.synchronizedList(new LinkedList(â€¦));</p>
<p>LinkedListæ˜¯ä¸€ç§å¯ä»¥åœ¨ä»»ä½•ä½ç½®è¿›è¡Œé«˜æ•ˆåœ°æ’å…¥å’Œç§»é™¤æ“ä½œçš„æœ‰åºåºåˆ—ï¼Œå®ƒæ˜¯åŸºäºåŒå‘é“¾è¡¨å®ç°çš„ã€‚å†…éƒ¨æœ‰ä¸‰ä¸ªå˜é‡ï¼Œsizeè¡¨ç¤ºé“¾è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œ firstæŒ‡å‘é“¾è¡¨å¤´éƒ¨ï¼ŒlastæŒ‡å‘é“¾è¡¨å°¾éƒ¨ã€‚</p>
<h3 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h3><p><code>Vector</code>ï¼Œä¸€ä¸ªå¯å˜é•¿çš„æ•°ç»„ï¼Œåº•å±‚å®ç°ä¸ ArrayList å¤§åŒå°å¼‚ï¼Œä½†<code>Vector</code>æ˜¯åŒæ­¥çš„ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ï¼Œ<code>Vector</code>çš„å¾ˆå¤šæ–¹æ³•ä¹‹å‰éƒ½åŠ äº†å…³é”®å­—<code>synchronized</code>ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>åˆå§‹å®¹é‡ä¸º10ï¼Œ é»˜è®¤æ‰©å±•2å€</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> newCapacity = oldCapacity + ((capacityIncrement &gt; <span class="number">0</span>) ?</span><br><span class="line">                                  capacityIncrement : oldCapacity);</span><br></pre></td></tr></table></figure>

<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><p>Setæ¥å£ç»§æ‰¿äº†Collectionæ¥å£ã€‚Seté›†åˆä¸­ä¸èƒ½åŒ…å«é‡å¤çš„å…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ä½ åªéœ€å°†å…ƒç´ åŠ å…¥setä¸­ï¼Œé‡å¤çš„å…ƒç´ ä¼šè‡ªåŠ¨ç§»é™¤ã€‚æœ‰ä¸‰ç§å¸¸è§çš„Setå®ç°â€”â€”HashSet, TreeSetå’ŒLinkedHashSetã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªè®¿é—®å¿«é€Ÿçš„Setï¼Œä½ åº”è¯¥ä½¿ç”¨HashSetï¼›å½“ä½ éœ€è¦ä¸€ä¸ªæ’åºçš„Setï¼Œä½ åº”è¯¥ä½¿ç”¨TreeSetï¼›å½“ä½ éœ€è¦è®°å½•ä¸‹æ’å…¥æ—¶çš„é¡ºåºæ—¶ï¼Œä½ åº”è¯¥ä½¿ç”¨LinedHashSetã€‚</p>
<h3 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h3><p>HashSetæ˜¯æ˜¯åŸºäº HashMap å®ç°çš„ï¼Œåº•å±‚é‡‡ç”¨ HashMap æ¥ä¿å­˜å…ƒç´ ,æ‰€ä»¥å®ƒä¸ä¿è¯set çš„è¿­ä»£é¡ºåºï¼›ç‰¹åˆ«æ˜¯å®ƒä¸ä¿è¯è¯¥é¡ºåºæ’ä¹…ä¸å˜ã€‚add()ã€remove()ä»¥åŠcontains()ç­‰æ–¹æ³•éƒ½æ˜¯å¤æ‚åº¦ä¸ºO(1)çš„æ–¹æ³•ã€‚ç”±äºHashMapä¸­keyä¸å¯é‡å¤ï¼Œæ‰€ä»¥HashSetå…ƒç´ ä¸å¯é‡å¤ã€‚å¯ä»¥å­˜å‚¨nullå…ƒç´ ï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</p>
<h3 id="TreeSet"><a href="#TreeSet" class="headerlink" title="TreeSet"></a>TreeSet</h3><p>TreeSetæ˜¯ä¸€ä¸ªæœ‰åºé›†ï¼ŒåŸºäºTreeMapå®ç°ï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</p>
<p>TreeSetåº•å±‚é‡‡ç”¨TreeMapå­˜å‚¨ï¼Œæ„é€ å™¨å¯åŠ¨æ—¶æ–°å»ºTreeMapã€‚TreeSetå­˜å‚¨å…ƒç´ å®é™…ä¸ºTreeMapå­˜å‚¨çš„é”®å€¼å¯¹ä¸º&lt;key,PRESENT&gt;çš„key;ï¼ŒPRESENTä¸ºå›ºå®šå¯¹è±¡ï¼šprivate static final Object PRESENT = new Object().</p>
<p>TreeSetæ”¯æŒä¸¤ç§ä¸¤ç§æ’åºæ–¹å¼ï¼ˆè‡ªç„¶æ’åºå’Œå®šåˆ¶æ’åºï¼‰ï¼Œé€šè¿‡ä¸åŒæ„é€ å™¨è°ƒç”¨å®ç°ã€‚</p>
<h3 id="LinkedHashSet"><a href="#LinkedHashSet" class="headerlink" title="LinkedHashSet"></a>LinkedHashSet</h3><p>LinkedHashSetä»‹äºHashSetå’ŒTreeSetä¹‹é—´ã€‚å“ˆå¸Œè¡¨å’Œé“¾æ¥åˆ—è¡¨å®ç°ã€‚åŸºæœ¬æ–¹æ³•çš„å¤æ‚åº¦ä¸ºO(1)ã€‚</p>
<p>LinkedHashSet æ˜¯ Set çš„ä¸€ä¸ªå…·ä½“å®ç°ï¼Œå…¶ç»´æŠ¤ç€ä¸€ä¸ªè¿è¡Œäºæ‰€æœ‰æ¡ç›®çš„åŒé‡é“¾æ¥åˆ—è¡¨ã€‚æ­¤é“¾æ¥åˆ—è¡¨å®šä¹‰äº†è¿­ä»£é¡ºåºï¼Œè¯¥è¿­ä»£é¡ºåºå¯ä¸ºæ’å…¥é¡ºåºæˆ–æ˜¯è®¿é—®é¡ºåºã€‚</p>
<p>LinkedHashSet ç»§æ‰¿äº HashSetï¼Œå¹¶ä¸”å…¶å†…éƒ¨æ˜¯é€šè¿‡ LinkedHashMap æ¥å®ç°çš„ã€‚æœ‰ç‚¹ç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰è¯´çš„LinkedHashMap å…¶å†…éƒ¨æ˜¯åŸºäº Hashmap å®ç°çš„ä¸€æ ·ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦è¿­ä»£çš„é¡ºåºä¸ºæ’å…¥é¡ºåºæˆ–è€…è®¿é—®é¡ºåºï¼Œé‚£ä¹ˆ LinkedHashSet æ˜¯éœ€è¦ä½ é¦–å…ˆè€ƒè™‘çš„ã€‚</p>
<p>LinkedHashSet åº•å±‚ä½¿ç”¨ LinkedHashMap æ¥ä¿å­˜æ‰€æœ‰å…ƒç´ ï¼Œå› ä¸ºç»§æ‰¿äº HashSetï¼Œæ‰€æœ‰çš„æ–¹æ³•æ“ä½œä¸Šåˆä¸ HashSet ç›¸åŒï¼Œå› æ­¤ LinkedHashSet çš„å®ç°ä¸Šéå¸¸ç®€å•ï¼Œåªæä¾›äº†å››ä¸ªæ„é€ æ–¹æ³•ï¼Œå¹¶é€šè¿‡ä¼ é€’ä¸€ä¸ªæ ‡è¯†å‚æ•°ï¼Œè°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ï¼Œåº•å±‚æ„é€ ä¸€ä¸ª LinkedHashMap æ¥å®ç°ï¼Œåœ¨ç›¸å…³æ“ä½œä¸Šä¸çˆ¶ç±» HashSet çš„æ“ä½œç›¸åŒï¼Œç›´æ¥è°ƒç”¨çˆ¶ç±» HashSet çš„æ–¹æ³•å³å¯ã€‚</p>
<h3 id="æ— åºæ€§å’Œä¸å¯é‡å¤æ€§çš„å«ä¹‰æ˜¯ä»€ä¹ˆ"><a href="#æ— åºæ€§å’Œä¸å¯é‡å¤æ€§çš„å«ä¹‰æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ— åºæ€§å’Œä¸å¯é‡å¤æ€§çš„å«ä¹‰æ˜¯ä»€ä¹ˆ"></a>æ— åºæ€§å’Œä¸å¯é‡å¤æ€§çš„å«ä¹‰æ˜¯ä»€ä¹ˆ</h3><p>1ã€ä»€ä¹ˆæ˜¯æ— åºæ€§ï¼Ÿæ— åºæ€§ä¸ç­‰äºéšæœºæ€§ ï¼Œæ— åºæ€§æ˜¯æŒ‡å­˜å‚¨çš„æ•°æ®åœ¨åº•å±‚æ•°ç»„ä¸­å¹¶éæŒ‰ç…§æ•°ç»„ç´¢å¼•çš„é¡ºåºæ·»åŠ  ï¼Œè€Œæ˜¯æ ¹æ®æ•°æ®çš„å“ˆå¸Œå€¼å†³å®šçš„ã€‚<br>2ã€ä»€ä¹ˆæ˜¯ä¸å¯é‡å¤æ€§ï¼Ÿä¸å¯é‡å¤æ€§æ˜¯æŒ‡æ·»åŠ çš„å…ƒç´ æŒ‰ç…§ equals()åˆ¤æ–­æ—¶ ï¼Œè¿”å› falseï¼Œéœ€è¦åŒæ—¶é‡å†™ equals()æ–¹æ³•å’Œ HashCode()æ–¹æ³•ã€‚</p>
<h3 id="æ¯”è¾ƒ-HashSetã€LinkedHashSet-å’Œ-TreeSet-ä¸‰è€…çš„å¼‚åŒ"><a href="#æ¯”è¾ƒ-HashSetã€LinkedHashSet-å’Œ-TreeSet-ä¸‰è€…çš„å¼‚åŒ" class="headerlink" title="æ¯”è¾ƒ HashSetã€LinkedHashSet å’Œ TreeSet ä¸‰è€…çš„å¼‚åŒ"></a>æ¯”è¾ƒ HashSetã€LinkedHashSet å’Œ TreeSet ä¸‰è€…çš„å¼‚åŒ</h3><p>HashSet æ˜¯ Set æ¥å£çš„ä¸»è¦å®ç°ç±» ï¼ŒHashSet çš„åº•å±‚æ˜¯ HashMapï¼Œçº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¯ä»¥å­˜å‚¨ null å€¼ï¼›</p>
<p>LinkedHashSet æ˜¯ HashSet çš„å­ç±»ï¼Œèƒ½å¤ŸæŒ‰ç…§æ·»åŠ çš„é¡ºåºéå†ï¼›</p>
<p>TreeSet åº•å±‚ä½¿ç”¨çº¢é»‘æ ‘ï¼Œèƒ½å¤ŸæŒ‰ç…§æ·»åŠ å…ƒç´ çš„é¡ºåºè¿›è¡Œéå†ï¼Œæ’åºçš„æ–¹å¼æœ‰è‡ªç„¶æ’åºå’Œå®šåˆ¶æ’åºã€‚</p>
<h3 id="Setä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œå¦‚ä½•å®ç°ï¼Ÿ"><a href="#Setä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œå¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="Setä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œå¦‚ä½•å®ç°ï¼Ÿ"></a>Setä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</h3><p>HashSetå®ç°äº†Setæ¥å£åº•å±‚åŸºäºHashMapæ¥å®ç°ï¼Œåœ¨å°†ä¸€ä¸ªkey-valueå¯¹æ”¾å…¥HashMapä¸­æ—¶ï¼Œé¦–å…ˆæ ¹æ®keyçš„hashCode()è¿”å›å€¼å†³å®šè¯¥Entryçš„å­˜å‚¨ä½ç½®ï¼Œå¦‚æœä¸¤ä¸ªkeyçš„hashå€¼ç›¸åŒï¼Œé‚£ä¹ˆå®ƒä»¬çš„å­˜å‚¨ä½ç½®ç›¸åŒã€‚å¦‚æœè¿™ä¸ªä¸¤ä¸ªkeyçš„equalsæ¯”è¾ƒè¿”å›trueã€‚é‚£ä¹ˆæ–°æ·»åŠ çš„Entryçš„valueä¼šè¦†ç›–åŸæ¥çš„Entryçš„valueï¼Œkeyä¸ä¼šè¦†ç›–ã€‚ä¸”HashSetä¸­add()ä¸­ map.put(e, PRESENT)==null ä¸ºfalseï¼ŒHashSetæ·»åŠ å…ƒç´ å¤±è´¥ã€‚å› æ­¤,å¦‚æœå‘HashSetä¸­æ·»åŠ ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å…ƒç´ ï¼Œæ–°æ·»åŠ çš„é›†åˆå…ƒç´ ä¸ä¼šè¦†ç›–åŸæ¥å·²æœ‰çš„é›†åˆå…ƒç´ ã€‚</p>
<h3 id="HashSet-å’Œ-TreeSet-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#HashSet-å’Œ-TreeSet-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="HashSet å’Œ TreeSet æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>HashSet å’Œ TreeSet æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>HashSet æ˜¯ç”±ä¸€ä¸ª hash è¡¨æ¥å®ç°çš„ï¼Œå› æ­¤ï¼Œå®ƒçš„å…ƒç´ æ˜¯æ— åºçš„ã€‚add()ï¼Œremove()ï¼Œcontains()æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼ŒTreeSet æ˜¯ç”±ä¸€ä¸ªæ ‘å½¢çš„ç»“æ„æ¥å®ç°çš„ï¼Œå®ƒé‡Œé¢çš„å…ƒç´ æ˜¯æœ‰åºçš„ã€‚å› æ­¤ï¼Œadd()ï¼Œremove()ï¼Œcontains() æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ã€‚</p>
<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h3><p><code>HashMap</code> æ˜¯ <code>Map</code> çš„ä¸€ä¸ªå®ç°ç±»ï¼Œå®ƒä»£è¡¨çš„æ˜¯ä¸€ç§é”®å€¼å¯¹çš„æ•°æ®å­˜å‚¨å½¢å¼ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚</p>
<p><code>jdk 8</code> ä¹‹å‰ï¼Œå…¶å†…éƒ¨æ˜¯ç”± <strong>æ•°ç»„ + é“¾è¡¨</strong> æ¥å®ç°çš„ï¼Œè€Œ <code>jdk 8</code> å¯¹äºé“¾è¡¨é•¿åº¦è¶…è¿‡ 8 çš„é“¾è¡¨å°†è½¬å‚¨ä¸º çº¢é»‘æ ‘ã€‚JDK 1.8 ä¹‹æ‰€ä»¥æ·»åŠ çº¢é»‘æ ‘æ˜¯å› ä¸ºä¸€æ—¦é“¾è¡¨è¿‡é•¿ï¼Œä¼šä¸¥é‡å½±å“ HashMap çš„æ€§èƒ½ï¼Œè€Œçº¢é»‘æ ‘å…·æœ‰å¿«é€Ÿå¢åˆ æ”¹æŸ¥çš„ç‰¹ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆçš„è§£å†³é“¾è¡¨è¿‡é•¿æ—¶æ“ä½œæ¯”è¾ƒæ…¢çš„é—®é¢˜ã€‚</p>
<p><code>HashMap</code>æœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸º<code>null</code>ï¼ˆnull key å“ˆå¸Œå€¼ä¸º0ï¼‰ï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸º<code>null</code>ã€‚ä¸ä¿è¯æœ‰åº (æ¯”å¦‚æ’å…¥çš„é¡ºåº)ã€ä¹Ÿä¸ä¿è¯åºä¸éšæ—¶é—´å˜åŒ–ã€‚</p>
<p><code>HashMap</code>éçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™<code>HashMap</code>ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ <code>Collections</code>çš„<code>synchronizedMap</code>æ–¹æ³•ä½¿<code>HashMap</code>å…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨<code>ConcurrentHashMap</code>ï¼ŒHashTableã€‚</p>
<h4 id="HashMapçš„hashå“ˆå¸Œå‡½æ•°çš„è®¾è®¡åŸç†ï¼Œä»¥åŠHashMapä¸‹æ ‡è·å–æ–¹å¼ï¼Ÿ"><a href="#HashMapçš„hashå“ˆå¸Œå‡½æ•°çš„è®¾è®¡åŸç†ï¼Œä»¥åŠHashMapä¸‹æ ‡è·å–æ–¹å¼ï¼Ÿ" class="headerlink" title="HashMapçš„hashå“ˆå¸Œå‡½æ•°çš„è®¾è®¡åŸç†ï¼Œä»¥åŠHashMapä¸‹æ ‡è·å–æ–¹å¼ï¼Ÿ"></a>HashMapçš„hashå“ˆå¸Œå‡½æ•°çš„è®¾è®¡åŸç†ï¼Œä»¥åŠHashMapä¸‹æ ‡è·å–æ–¹å¼ï¼Ÿ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> h;</span><br><span class="line">  <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// indexFor æ˜¯ jdk1.7 çš„æºç ï¼Œjdk1.8 æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ä½†æ˜¯ jdk1.8 ä¹Ÿæ˜¯é€šè¿‡å–æ¨¡è¿ç®—æ¥è®¡ç®—çš„</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexFor</span><span class="params">(<span class="keyword">int</span> h, <span class="keyword">int</span> length)</span> </span>&#123; </span><br><span class="line">   <span class="keyword">return</span> h &amp; (length-<span class="number">1</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="../img/java/35.png"></p>
<ol>
<li>é¦–å…ˆè·å–hashcodeï¼Œä¸€ä¸ª32ä½çš„intå€¼</li>
<li>ç„¶åå°†hashcodeå·¦ç§»16ä½çš„å€¼è¿›è¡Œä¸æˆ–ï¼Œå³å°†é«˜ä½ä¸ä½ä½è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå‡å°‘ç¢°æ’æœºç‡ã€‚</li>
<li>å°†è®¡ç®—å¾—åˆ°çš„hashå€¼ä¸hashmapå®¹é‡-1ï¼Œè¿›è¡Œå–ä½™è¿ç®—ï¼Œä½†åœ¨è®¡ç®—æœºè¿ç®—ä¸­&amp;è‚¯å®šæ¯”%å¿«ï¼Œåˆå› ä¸ºh % n = h &amp;ï¼ˆn - 1ï¼‰ï¼Œæ‰€ä»¥æœ€ç»ˆå°†ç¬¬äºŒæ­¥å¾—åˆ°çš„hashè·Ÿn-1è¿›è¡Œä¸è¿ç®—ã€‚næ˜¯tableä¸­çš„é•¿åº¦ã€‚</li>
</ol>
<blockquote>
<p>å¯¹äºä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„<code>hashCode()</code>è¿”å›å€¼ç›¸åŒï¼Œé‚£ä¹ˆç¨‹åºè°ƒç”¨æ–¹æ³•ä¸€æ‰€è®¡ç®—å¾—åˆ°çš„<code>Hash</code>ç å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠ<code>hash</code>å€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚ä½†æ˜¯ï¼Œæ¨¡è¿ç®—çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨ <code>&amp;</code> ä½è¿ç®—æ¥ä¼˜åŒ–æ•ˆç‡ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•éå¸¸å·§å¦™ï¼Œå®ƒé€šè¿‡<code>h &amp; (table.length -1)</code>æ¥å¾—åˆ°è¯¥å¯¹è±¡çš„ä¿å­˜ä½ï¼Œè€Œ<code>HashMap</code>åº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯ *****2 çš„ n æ¬¡æ–¹*****ï¼Œè¿™æ˜¯<code>HashMap</code>åœ¨é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ã€‚å½“ length æ€»æ˜¯ 2 çš„ n æ¬¡æ–¹æ—¶ï¼Œ<code>h&amp; (length-1)</code>è¿ç®—ç­‰ä»·äºå¯¹ length å–æ¨¡ï¼Œä¹Ÿå°±æ˜¯<code>h%length</code>ï¼Œä½†æ˜¯ <em><strong>*&amp;*</strong></em> æ¯” <em><strong>*%*</strong></em> å…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚</p>
<p>åœ¨<code>JDK1.8</code>çš„å®ç°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡<code>hashCode()</code>çš„é«˜ 16 ä½å¼‚æˆ–ä½ 16 ä½å®ç°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥ Node æ•°ç»„ table çš„ length æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½ Bit éƒ½å‚ä¸åˆ° Hash çš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚</p>
</blockquote>
<p><strong>è®¾è®¡åŸå› ï¼š</strong></p>
<ol>
<li>ä¸€å®šè¦å°½å¯èƒ½é™ä½hashç¢°æ’ï¼Œè¶Šåˆ†æ•£è¶Šå¥½ï¼›</li>
<li>ç®—æ³•ä¸€å®šè¦å°½å¯èƒ½é«˜æ•ˆï¼Œå› ä¸ºè¿™æ˜¯é«˜é¢‘æ“ä½œ, å› æ­¤é‡‡ç”¨ä½è¿ç®—ï¼›</li>
</ol>
<h4 id="HashMap-åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å›è¿›è¡Œæ‰©å®¹ï¼Ÿæˆ–è€…æœ‰å“ªäº›æ“ä½œä¼šå¯¼è‡´æ‰©å®¹ï¼Ÿ"><a href="#HashMap-åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å›è¿›è¡Œæ‰©å®¹ï¼Ÿæˆ–è€…æœ‰å“ªäº›æ“ä½œä¼šå¯¼è‡´æ‰©å®¹ï¼Ÿ" class="headerlink" title="HashMap åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å›è¿›è¡Œæ‰©å®¹ï¼Ÿæˆ–è€…æœ‰å“ªäº›æ“ä½œä¼šå¯¼è‡´æ‰©å®¹ï¼Ÿ"></a>HashMap åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å›è¿›è¡Œæ‰©å®¹ï¼Ÿæˆ–è€…æœ‰å“ªäº›æ“ä½œä¼šå¯¼è‡´æ‰©å®¹ï¼Ÿ</h4><ol>
<li>åœ¨æ‰§è¡Œ HashMap çš„æ„é€ å‡½æ•°æˆ–è€… putAll() æ–¹æ³•æ—¶å¦‚æœå¾…æ·»åŠ çš„ map.size() å¤§äºé˜ˆå€¼æ—¶è¿›è¡Œæ‰©å®¹</li>
<li>å› ä¸ºhashmapä½¿ç”¨çš„æ˜¯æ‡’åˆå§‹åŒ–ï¼Œé¦–æ¬¡æ·»åŠ å…ƒç´ çš„æ—¶å€™ä¼šè¿›è¡Œresize()</li>
<li>å½“putåŠ å…¥èŠ‚ç‚¹åï¼Œå‘ç°sizeï¼ˆé”®å€¼å¯¹æ•°é‡ï¼‰&gt;thresholdæ—¶ï¼Œè¿›è¡Œæ‰©å®¹</li>
</ol>
<blockquote>
<p>JDK1.7çš„æ—¶å€™æ˜¯å…ˆè¿›è¡Œæ‰©å®¹åè¿›è¡Œæ’å…¥ï¼Œè€Œåœ¨JDK1.8çš„æ—¶å€™åˆ™æ˜¯å…ˆæ’å…¥åè¿›è¡Œæ‰©å®¹</p>
<p>å…ˆæ‰©å®¹å†putå°±æ˜¯ä¸ç®¡å½“å‰æ’å…¥çš„å€¼æ‰€å±çš„æ¡¶æ˜¯ä¸æ˜¯ç©ºï¼Œéƒ½å…ˆæ‰©å®¹ï¼Œä¼šé€ æˆæ— æ•ˆæ‰©å®¹ï¼›å…ˆputåœ¨æ‰©å®¹ï¼Œä¼šåœ¨putæ—¶å‘ç°æ˜¯å¦å½“å‰æ¡¶ä¸ºç©ºï¼Œå³æ˜¯å¦å‘ç”Ÿhashå†²çªï¼Œå¦‚æœå‘ç”Ÿäº†å°±æ‰©å®¹ï¼Œä¸å‘ç”Ÿå°±ç­‰ä¸‹ä¸€æ¬¡æ’å…¥å†²çªæˆ–å¤§äºé˜€å€¼æ—¶æ‰©å®¹</p>
</blockquote>
<h4 id="Javaä¸­HashMapçš„keyå€¼è¦æ˜¯ä¸ºç±»å¯¹è±¡åˆ™è¯¥ç±»éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿ"><a href="#Javaä¸­HashMapçš„keyå€¼è¦æ˜¯ä¸ºç±»å¯¹è±¡åˆ™è¯¥ç±»éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿ" class="headerlink" title="Javaä¸­HashMapçš„keyå€¼è¦æ˜¯ä¸ºç±»å¯¹è±¡åˆ™è¯¥ç±»éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿ"></a>Javaä¸­HashMapçš„keyå€¼è¦æ˜¯ä¸ºç±»å¯¹è±¡åˆ™è¯¥ç±»éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿ</h4><p>éœ€è¦åŒæ—¶é‡å†™è¯¥ç±»çš„hashCode()æ–¹æ³•å’Œå®ƒçš„equals()æ–¹æ³•ã€‚</p>
<p>ä»æºç å¯ä»¥å¾—çŸ¥ï¼Œåœ¨æ’å…¥å…ƒç´ çš„æ—¶å€™æ˜¯å…ˆç®—å‡ºè¯¥å¯¹è±¡çš„hashCodeã€‚å¦‚æœhashcodeç›¸ç­‰è¯çš„ã€‚é‚£ä¹ˆè¡¨æ˜è¯¥å¯¹è±¡æ˜¯å­˜å‚¨åœ¨åŒä¸€ä¸ªä½ç½®ä¸Šçš„ã€‚å¦‚æœè°ƒç”¨equals()æ–¹æ³•ï¼Œä¸¤ä¸ªkeyç›¸åŒï¼Œåˆ™æ›¿æ¢å…ƒç´ å¦‚æœè°ƒç”¨equals()æ–¹æ³•ï¼Œä¸¤ä¸ªkeyä¸ç›¸åŒï¼Œåˆ™è¯´æ˜è¯¥hashCodeä»…ä»…æ˜¯ç¢°å·§ç›¸åŒï¼Œæ­¤æ—¶æ˜¯æ•£åˆ—å†²çªï¼Œå°†æ–°å¢çš„å…ƒç´ æ”¾åœ¨æ¡¶å­ä¸Š</p>
<p>é‡å†™äº†equals()æ–¹æ³•ï¼Œå°±è¦é‡å†™hashCode()çš„æ–¹æ³•ã€‚å› ä¸ºequals()è®¤å®šäº†è¿™ä¸¤ä¸ªå¯¹è±¡ç›¸åŒï¼Œè€ŒåŒä¸€ä¸ªå¯¹è±¡è°ƒç”¨hashCode()æ–¹æ³•æ—¶ï¼Œæ˜¯åº”è¯¥è¿”å›ç›¸åŒçš„å€¼çš„ï¼</p>
<h4 id="HashMap-get-æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#HashMap-get-æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="HashMap get æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹"></a>HashMap get æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹</h4><p><strong>jdk 1.8</strong></p>
<p>å¯¹è¾“å…¥çš„keyçš„å€¼è®¡ç®—hashå€¼,</p>
<p>é¦–å…ˆåˆ¤æ–­hashmapä¸­çš„æ•°ç»„æ˜¯å¦ä¸ºç©ºå’Œæ•°ç»„çš„é•¿åº¦æ˜¯å¦ä¸º0,å¦‚æœä¸ºç©ºå’Œä¸º0,åˆ™ç›´æ¥æ”¾å›null</p>
<p>å¦‚æœä¸ä¸ºç©ºå’Œ0,è®¡ç®—keyå¯¹åº”çš„æ•°ç»„ä¸‹æ ‡,åˆ¤æ–­å¯¹åº”ä½ç½®ä¸Šçš„ç¬¬ä¸€ä¸ªnodeæ˜¯å¦æ»¡è¶³æ¡ä»¶,å¦‚æœæ»¡è¶³æ¡ä»¶,ç›´æ¥è¿”å›</p>
<p>å¦‚æœä¸æ»¡è¶³æ¡ä»¶,åˆ¤æ–­å½“å‰nodeæ˜¯å¦æ˜¯æœ€åä¸€ä¸ª,å¦‚æœæ˜¯,è¯´æ˜ä¸å­˜åœ¨key,åˆ™è¿”å›null</p>
<p>å¦‚æœä¸æ˜¯æœ€åä¸€ä¸ª,åˆ¤æ–­æ˜¯å¦æ˜¯çº¢é»‘æ ‘,å¦‚æœæ˜¯çº¢é»‘æ ‘,åˆ™ä½¿ç”¨çº¢é»‘æ ‘çš„æ–¹å¼è·å–å¯¹åº”çš„key,</p>
<p>å¦‚æœä¸æ˜¯çº¢é»‘æ ‘,éå†é“¾è¡¨æ˜¯å¦æœ‰æ»¡è¶³æ¡ä»¶çš„,å¦‚æœæœ‰,ç›´æ¥æ”¾å›,å¦åˆ™è¿”å›null</p>
<h4 id="HashMap-put-æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#HashMap-put-æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="HashMap put æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹"></a>HashMap put æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹</h4><p><img src="../img/java/36.png"></p>
<p>â‘ .åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„ table æ˜¯å¦ä¸ºç©ºæˆ–ä¸ºnullï¼Œå¦åˆ™æ‰§è¡Œresize()è¿›è¡Œæ‰©å®¹ï¼› </p>
<p>â‘¡.æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ’å…¥çš„æ•°ç»„ç´¢å¼• iï¼Œå¦‚æœtable[i]==nullï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ ï¼Œè½¬å‘â‘¥ï¼Œå¦‚æœtable[i]ä¸ä¸ºç©ºï¼Œè½¬å‘â‘¢ï¼›</p>
<p> â‘¢.åˆ¤æ–­ table[i] çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–valueï¼Œå¦åˆ™è½¬å‘â‘£ï¼Œè¿™é‡Œçš„ç›¸åŒæŒ‡çš„æ˜¯hashCodeä»¥åŠequalsï¼› </p>
<p>â‘£.åˆ¤æ–­table[i] æ˜¯å¦ä¸ºtreeNodeï¼Œå³table[i] æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹ï¼Œå¦åˆ™è½¬å‘â‘¤ï¼› </p>
<p>â‘¤.éå†table[i]ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¦åˆ™è¿›è¡Œé“¾è¡¨çš„æ’å…¥æ“ä½œï¼›éå†è¿‡ç¨‹ä¸­è‹¥å‘ç°keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–valueå³å¯ï¼› </p>
<p>â‘¥.æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡thresholdï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¯¹keyçš„hashCode()åšhash</span></span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">               <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="comment">// æ­¥éª¤â‘ ï¼štabä¸ºç©ºåˆ™åˆ›å»º</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// æ­¥éª¤â‘¡ï¼šè®¡ç®—indexï¼Œå¹¶å¯¹nullåšå¤„ç† </span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>) </span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// æ­¥éª¤â‘¢ï¼šèŠ‚ç‚¹keyå­˜åœ¨ï¼Œç›´æ¥è¦†ç›–value</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// æ­¥éª¤â‘£ï¼šåˆ¤æ–­è¯¥é“¾ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="comment">// æ­¥éª¤â‘¤ï¼šè¯¥é“¾ä¸ºé“¾è¡¨</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key,value,<span class="keyword">null</span>);</span><br><span class="line">                     <span class="comment">//é“¾è¡¨é•¿åº¦å¤§äº8è½¬æ¢ä¸ºçº¢é»‘æ ‘è¿›è¡Œå¤„ç†</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st  </span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                 <span class="comment">// keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–value</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k)))) </span><br><span class="line">                         <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// æ­¥éª¤â‘¥ï¼šè¶…è¿‡æœ€å¤§å®¹é‡ å°±æ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>jdk 1.7  put()æ–¹æ³•</p>
<ul>
<li>è°ƒç”¨putæ–¹æ³•çš„æ—¶å€™é¦–å…ˆåˆ¤æ–­hashmapæ•°ç»„æ˜¯å¦ä¸ºç©ºæ•°ç»„,</li>
<li>å¦‚æœä¸ºç©º,è¿›è¡Œåˆå§‹åŒ–,åˆ¤æ–­keyçš„å€¼æ˜¯å¦æ˜¯null,</li>
<li>å¦‚æœæ˜¯null,æŠŠå¯¹åº”çš„valueå€¼å­˜è¿›æ•°ç»„ä¸­ä¸‹æ ‡ä¸º0çš„ä½ç½®,</li>
<li>è®¡ç®—keyçš„hashå€¼,å¹¶è®¡ç®—å‡ºä¸‹æ ‡,</li>
<li>éå†ä¸‹æ ‡å¯¹åº”çš„é“¾è¡¨,åŒ¹é…hashå€¼å’Œkeyçš„å€¼,</li>
<li>å¦‚æœå­˜åœ¨,åˆ™è¦†ç›–,è¿”å›æ—§å€¼</li>
<li>å¦‚æœä¸å­˜åœ¨,æ–°æ·»åŠ ä¸€ä¸ª,è¿”å›null</li>
<li>å¦‚æœæ‰©å®¹,æ˜¯å…ˆæ‰©å®¹ä¹‹åå†æŠŠæ•°æ®æ·»åŠ è¿›æ–°æ‰©å®¹çš„æ•°ç»„ä¸­ã€‚å¦‚æœæ•°ç»„ä¸­å…ƒç´ çš„å®¹é‡è¶…è¿‡é˜ˆå€¼,ä¼šè§¦å‘æ‰©å®¹,æ‰©å®¹æ˜¯å…ˆæŠŠæºæ•°ç»„æ”¾è¿›ä¸€ä¸ªä¸´æ—¶æ•°ç»„ä¸­,è·å–è€æ•°ç»„çš„é•¿åº¦,é€šè¿‡è€æ•°ç»„é•¿åº¦ä¹˜2è·å–æ–°æ•°ç»„é•¿åº¦,å¹¶åˆ›å»ºæ–°æ•°ç»„,æŠŠä¸´æ—¶æ•°ç»„ä¸­çš„æ•°æ®é€šè¿‡é‡æ–°è®¡ç®—ä¸‹è¡¨,å­˜è¿›æ‰©å®¹åçš„æ•°ç»„ä¸­ã€‚</li>
</ul>
<h4 id="HashMapæ£€æµ‹åˆ°hashå†²çªä¹‹åå°†å…ƒç´ æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨è¿˜æ˜¯å°¾éƒ¨ï¼Ÿ"><a href="#HashMapæ£€æµ‹åˆ°hashå†²çªä¹‹åå°†å…ƒç´ æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨è¿˜æ˜¯å°¾éƒ¨ï¼Ÿ" class="headerlink" title="HashMapæ£€æµ‹åˆ°hashå†²çªä¹‹åå°†å…ƒç´ æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨è¿˜æ˜¯å°¾éƒ¨ï¼Ÿ"></a>HashMapæ£€æµ‹åˆ°hashå†²çªä¹‹åå°†å…ƒç´ æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨è¿˜æ˜¯å°¾éƒ¨ï¼Ÿ</h4><p>hashmap æ‰§è¡Œå°¾æ’æ³•ï¼ˆç›´æ¥æ’å…¥é“¾è¡¨æˆ–çº¢é»‘æ ‘å°¾éƒ¨ï¼‰</p>
<blockquote>
<p>å°¾æ’æ³•ä¸ä¼šå‡ºç°é€†åºï¼Œç¯å½¢åˆ—è¡¨ï¼Œæ­»å¾ªç¯ç­‰é—®é¢˜</p>
</blockquote>
<h4 id="HashMapçº¢é»‘æ ‘çš„é˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯8ï¼Ÿ"><a href="#HashMapçº¢é»‘æ ‘çš„é˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯8ï¼Ÿ" class="headerlink" title="HashMapçº¢é»‘æ ‘çš„é˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯8ï¼Ÿ"></a>HashMapçº¢é»‘æ ‘çš„é˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯8ï¼Ÿ</h4><p>é¦–å…ˆå’Œhashcodeç¢°æ’æ¬¡æ•°çš„æ³Šæ¾åˆ†å¸ƒæœ‰å…³ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¯»æ‰¾ä¸€ç§æ—¶é—´å’Œç©ºé—´çš„å¹³è¡¡ã€‚åœ¨è´Ÿè½½å› å­0.75ï¼ˆHashMapé»˜è®¤ï¼‰çš„æƒ…å†µä¸‹ï¼Œå•ä¸ªhashæ§½å†…å…ƒç´ ä¸ªæ•°ä¸º8çš„æ¦‚ç‡å°äºç™¾ä¸‡åˆ†ä¹‹ä¸€ï¼Œå°†7ä½œä¸ºä¸€ä¸ªåˆ†æ°´å²­ï¼Œç­‰äº7æ—¶ä¸åšè½¬æ¢ï¼Œå¤§äºç­‰äº8æ‰è½¬çº¢é»‘æ ‘ï¼Œå°äºç­‰äº6æ‰è½¬é“¾è¡¨ã€‚é“¾è¡¨ä¸­å…ƒç´ ä¸ªæ•°ä¸º8æ—¶çš„æ¦‚ç‡å·²ç»éå¸¸å°ï¼Œå†å¤šçš„å°±æ›´å°‘äº†ï¼Œæ‰€ä»¥åŸä½œè€…åœ¨é€‰æ‹©é“¾è¡¨å…ƒç´ ä¸ªæ•°æ—¶é€‰æ‹©äº†8ï¼Œæ˜¯æ ¹æ®æ¦‚ç‡ç»Ÿè®¡è€Œé€‰æ‹©çš„ã€‚</p>
<p>çº¢é»‘æ ‘ä¸­çš„TreeNodeæ˜¯é“¾è¡¨ä¸­çš„Nodeæ‰€å ç©ºé—´çš„2å€ï¼Œè™½ç„¶çº¢é»‘æ ‘çš„æŸ¥æ‰¾æ•ˆç‡ä¸ºo(logN)ï¼Œè¦ä¼˜äºé“¾è¡¨çš„o(N)ï¼Œä½†æ˜¯å½“é“¾è¡¨é•¿åº¦æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œå³ä½¿å…¨éƒ¨éå†ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿä¸ä¼šå¤ªé«˜ã€‚æ‰€ä»¥ï¼Œè¦å¯»æ‰¾ä¸€ç§æ—¶é—´å’Œç©ºé—´çš„å¹³è¡¡ï¼Œå³åœ¨é“¾è¡¨é•¿åº¦è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼ä¹‹åå†è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</p>
<h4 id="Hash-å†²çªæ—¶ä¸ºä»€ä¹ˆæ˜¯çº¢é»‘æ ‘è€Œä¸æ˜¯AVLæ ‘æˆ–Bæ ‘ï¼Ÿ"><a href="#Hash-å†²çªæ—¶ä¸ºä»€ä¹ˆæ˜¯çº¢é»‘æ ‘è€Œä¸æ˜¯AVLæ ‘æˆ–Bæ ‘ï¼Ÿ" class="headerlink" title="Hash å†²çªæ—¶ä¸ºä»€ä¹ˆæ˜¯çº¢é»‘æ ‘è€Œä¸æ˜¯AVLæ ‘æˆ–Bæ ‘ï¼Ÿ"></a>Hash å†²çªæ—¶ä¸ºä»€ä¹ˆæ˜¯çº¢é»‘æ ‘è€Œä¸æ˜¯AVLæ ‘æˆ–Bæ ‘ï¼Ÿ</h4><p>AVLæ ‘æ¯”çº¢é»‘æ ‘ä¿æŒæ›´åŠ ä¸¥æ ¼çš„å¹³è¡¡ã€‚å› æ­¤ï¼Œåœ¨AVLæ ‘ä¸­æŸ¥æ‰¾é€šå¸¸æ›´å¿«ï¼Œä½†è¿™æ˜¯ä»¥æ›´å¤šæ—‹è½¬æ“ä½œå¯¼è‡´æ›´æ…¢çš„æ’å…¥å’Œåˆ é™¤ä¸ºä»£ä»·çš„ã€‚å› æ­¤ï¼ŒAVLæ ‘æ›´åŠ é€‚åˆ<strong>æŸ¥æ‰¾å¯†é›†å‹</strong>ä»»åŠ¡ã€‚</p>
<p>çº¢é»‘æ ‘é€‚ç”¨äº <strong>æ’å…¥å¯†é›†å‹</strong> ä»»åŠ¡ï¼Œè€Œä¸”æ›´åŠ é€šç”¨ï¼Œåœ¨æ·»åŠ ï¼Œæ’å…¥å’Œåˆ é™¤æ–¹é¢éƒ½æœ‰ä¸é”™çš„è¡¨ç°ã€‚</p>
<h4 id="æ‰©å®¹æœºåˆ¶"><a href="#æ‰©å®¹æœºåˆ¶" class="headerlink" title="æ‰©å®¹æœºåˆ¶"></a>æ‰©å®¹æœºåˆ¶</h4><p>hashmapåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µæ—¶ï¼Œä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ã€‚</p>
<ol>
<li>åœ¨æ‰§è¡Œ HashMap çš„æ„é€ å‡½æ•°æˆ–è€… putAll() æ–¹æ³•æ—¶å¦‚æœå¾…æ·»åŠ çš„ map.size() å¤§äºé˜ˆå€¼æ—¶è¿›è¡Œæ‰©å®¹</li>
<li>å› ä¸ºhashmapä½¿ç”¨çš„æ˜¯æ‡’åˆå§‹åŒ–ï¼Œé¦–æ¬¡æ·»åŠ å…ƒç´ çš„æ—¶å€™ä¼šè¿›è¡Œresize()</li>
<li>å½“putåŠ å…¥èŠ‚ç‚¹åï¼Œå‘ç°sizeï¼ˆé”®å€¼å¯¹æ•°é‡ï¼‰&gt;thresholdæ—¶ï¼Œè¿›è¡Œæ‰©å®¹</li>
</ol>
<p>æ‰©å®¹å°±æ˜¯é‡æ–°å®šä¹‰å®¹é‡ï¼Œåœ¨hashmapä¸­ï¼Œå¦‚æœä¸æ–­çš„putå…ƒç´ ï¼Œè€ŒhashMapå¯¹è±¡ä¸­çš„æ•°ç»„æ— æ³•è£…å¾—ä¸‹æ›´å¤šå¯¹è±¡æ—¶ï¼Œå¯¹è±¡å°±éœ€è¦è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å¤§æ•°ç»„é•¿åº¦ã€‚</p>
<p>åœ¨javaä¸­æ•°ç»„æ˜¯ä¸èƒ½å¤Ÿè‡ªåŠ¨æ‰©å®¹çš„ï¼Œæ˜¯é‡‡ç”¨ä¸€ä¸ªæ–°çš„å¤§å®¹é‡æ•°ç»„ä»£æ›¿åŸæœ‰çš„å°æ•°ç»„ã€‚</p>
<p>æ‰©å®¹åï¼Œæ™®é€šé“¾è¡¨ä¸Šçš„èŠ‚ç‚¹åŒ…æ‹¬çº¢é»‘æ ‘éƒ½å¾—é‡æ–°æ˜ å°„ï¼Œæ­¤æ—¶ç”±äºjdk1.8 ä¸­çš„hashmapè§„å®šæ•°ç»„çš„å®¹é‡å¿…é¡»æ˜¯äºŒçš„å¹‚å¤§å°ï¼Œæ‰€ä»¥åœ¨é‡æ–°è®¡ç®—å…ƒç´ ä½ç½®æ—¶ï¼Œè¦ä¹ˆåœ¨åŸä½ç½®ï¼Œè¦ä¹ˆåœ¨åŸä½ç½®çš„åŸºç¡€ä¸Š+åŸé•¿åº¦ã€‚</p>
<h4 id="åŠ è½½å› å­ä¸ºä»€ä¹ˆæ˜¯0-75ï¼Ÿ"><a href="#åŠ è½½å› å­ä¸ºä»€ä¹ˆæ˜¯0-75ï¼Ÿ" class="headerlink" title="åŠ è½½å› å­ä¸ºä»€ä¹ˆæ˜¯0.75ï¼Ÿ"></a>åŠ è½½å› å­ä¸ºä»€ä¹ˆæ˜¯0.75ï¼Ÿ</h4><p>åŠ è½½å› å­ä¹Ÿå«æ‰©å®¹å› å­æˆ–è´Ÿè½½å› å­ï¼Œç”¨æ¥åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¿›è¡Œæ‰©å®¹çš„ï¼Œå‡å¦‚åŠ è½½å› å­æ˜¯ 0.5ï¼ŒHashMap çš„åˆå§‹åŒ–å®¹é‡æ˜¯ 16ï¼Œé‚£ä¹ˆå½“ HashMap ä¸­æœ‰ 16*0.5=8 ä¸ªå…ƒç´ æ—¶ï¼ŒHashMap å°±ä¼šè¿›è¡Œæ‰©å®¹ã€‚ </p>
<p>é‚£åŠ è½½å› å­ä¸ºä»€ä¹ˆæ˜¯ 0.75 è€Œä¸æ˜¯ 0.5 æˆ–è€… 1.0 å‘¢ï¼Ÿ </p>
<p>è¿™å…¶å®æ˜¯å‡ºäºå®¹é‡å’Œæ€§èƒ½ä¹‹é—´å¹³è¡¡çš„ç»“æœï¼š </p>
<ul>
<li><p>å½“åŠ è½½å› å­è®¾ç½®æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œæ‰©å®¹çš„é—¨æ§›å°±è¢«æé«˜äº†ï¼Œæ‰©å®¹å‘ç”Ÿçš„é¢‘ç‡æ¯”è¾ƒä½ï¼Œå ç”¨çš„ç©ºé—´ä¼šæ¯”è¾ƒå°ï¼Œä½†æ­¤æ—¶å‘ç”Ÿ Hash å†²çªçš„å‡ ç‡å°±ä¼šæå‡ï¼Œå› æ­¤éœ€è¦æ›´å¤æ‚çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨å…ƒç´ ï¼Œè¿™æ ·å¯¹å…ƒç´ çš„æ“ä½œæ—¶é—´å°±ä¼šå¢åŠ ï¼Œè¿è¡Œæ•ˆç‡ä¹Ÿä¼šå› æ­¤é™ä½ï¼› </p>
</li>
<li><p>è€Œå½“åŠ è½½å› å­å€¼æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œæ‰©å®¹çš„é—¨æ§›ä¼šæ¯”è¾ƒä½ï¼Œå› æ­¤ä¼šå ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œæ­¤æ—¶å…ƒç´ çš„å­˜å‚¨å°±æ¯”è¾ƒç¨€ç–ï¼Œå‘ç”Ÿå“ˆå¸Œå†²çªçš„å¯èƒ½æ€§å°±æ¯”è¾ƒå°ï¼Œå› æ­¤æ“ä½œæ€§èƒ½ä¼šæ¯”è¾ƒé«˜ã€‚ </p>
</li>
</ul>
<p>æ‰€ä»¥ç»¼åˆäº†ä»¥ä¸Šæƒ…å†µå°±å–äº†ä¸€ä¸ª 0.5 åˆ° 1.0 çš„å¹³å‡æ•° 0.75 ä½œä¸ºåŠ è½½å› å­ã€‚</p>
<h4 id="å½“æœ‰å“ˆå¸Œå†²çªæ—¶ï¼ŒHashMapæ˜¯å¦‚ä½•æŸ¥æ‰¾å¹¶ç¡®è®¤å…ƒç´ çš„ï¼Ÿ"><a href="#å½“æœ‰å“ˆå¸Œå†²çªæ—¶ï¼ŒHashMapæ˜¯å¦‚ä½•æŸ¥æ‰¾å¹¶ç¡®è®¤å…ƒç´ çš„ï¼Ÿ" class="headerlink" title="å½“æœ‰å“ˆå¸Œå†²çªæ—¶ï¼ŒHashMapæ˜¯å¦‚ä½•æŸ¥æ‰¾å¹¶ç¡®è®¤å…ƒç´ çš„ï¼Ÿ"></a>å½“æœ‰å“ˆå¸Œå†²çªæ—¶ï¼ŒHashMapæ˜¯å¦‚ä½•æŸ¥æ‰¾å¹¶ç¡®è®¤å…ƒç´ çš„ï¼Ÿ</h4><p>bucket é‡Œçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´æ¥å‘½ä¸­ï¼› </p>
<p>å¦‚æœæœ‰å†²çªï¼Œåˆ™é€šè¿‡ key.equals(k) å»æŸ¥æ‰¾å¯¹åº”çš„ entry </p>
<p>è‹¥ä¸ºæ ‘ï¼Œåˆ™åœ¨æ ‘ä¸­é€šè¿‡ key.equals(k) æŸ¥æ‰¾ï¼ŒO(logn)ï¼› </p>
<p>è‹¥ä¸ºé“¾è¡¨ï¼Œåˆ™åœ¨é“¾è¡¨ä¸­é€šè¿‡ key.equals(k) æŸ¥æ‰¾ï¼ŒO(n)ã€‚</p>
<p>å…·ä½“ä»£ç çš„å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="comment">// å¯¹ key è¿›è¡Œå“ˆå¸Œæ“ä½œ</span></span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">    <span class="comment">// éç©ºåˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ¤æ–­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦æ˜¯è¦æŸ¥è¯¢çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; </span><br><span class="line">            ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="comment">// ä¸€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹éç©ºåˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœç¬¬ä¸€èŠ‚ç‚¹æ˜¯æ ‘ç»“æ„ï¼Œåˆ™ä½¿ç”¨ getTreeNode ç›´æ¥è·å–ç›¸åº”çš„æ•°æ®</span></span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            <span class="comment">// éæ ‘ç»“æ„å¾ªç¯èŠ‚ç‚¹åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="comment">// hash ç›¸ç­‰å¹¶ä¸” key ç›¸åŒï¼Œåˆ™è¿”å›æ­¤èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä»¥ä¸Šæºç å¯ä»¥çœ‹å‡ºï¼Œå½“å“ˆå¸Œå†²çªæ—¶æˆ‘ä»¬éœ€è¦é€šè¿‡åˆ¤æ–­ key å€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ‰èƒ½ç¡®è®¤æ­¤å…ƒç´ æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„å…ƒç´ ã€‚</p>
<h4 id="JDK-7-ä¸-JDK-8-ä¸­å…³äº-HashMapçš„å¯¹æ¯”ï¼ˆä¼˜åŒ–ç‚¹ï¼‰"><a href="#JDK-7-ä¸-JDK-8-ä¸­å…³äº-HashMapçš„å¯¹æ¯”ï¼ˆä¼˜åŒ–ç‚¹ï¼‰" class="headerlink" title="JDK 7 ä¸ JDK 8 ä¸­å…³äº HashMapçš„å¯¹æ¯”ï¼ˆä¼˜åŒ–ç‚¹ï¼‰"></a>JDK 7 ä¸ JDK 8 ä¸­å…³äº HashMapçš„å¯¹æ¯”ï¼ˆä¼˜åŒ–ç‚¹ï¼‰</h4><ol>
<li>JDK 8 ä¸ºçº¢é»‘æ ‘ + é“¾è¡¨ + æ•°ç»„çš„å½¢å¼ï¼Œå½“æ¡¶å†…å…ƒç´ å¤§äº 8 æ—¶ï¼Œä¾¿ä¼š<strong>æ ‘åŒ–</strong>ï¼›</li>
<li>hash å€¼çš„è®¡ç®—æ–¹å¼ä¸åŒ (jdk 8 ç®€åŒ–)ï¼›</li>
<li>1.7 table åœ¨åˆ›å»º hashmap æ—¶åˆ†é…ç©ºé—´ï¼Œè€Œ 1.8 åœ¨ put çš„æ—¶å€™åˆ†é…ï¼Œå¦‚æœ table ä¸ºç©ºï¼Œåˆ™ä¸º table åˆ†é…ç©ºé—´ï¼›</li>
<li>åœ¨å‘ç”Ÿå†²çªï¼Œæ’å…¥é“¾ä¸­æ—¶ï¼Œ<strong>7 æ˜¯å¤´æ’æ³•ï¼Œ8 æ˜¯å°¾æ’æ³•</strong>ï¼›</li>
<li>åœ¨ resize æ“ä½œä¸­ï¼Œ7 éœ€è¦é‡æ–°è¿›è¡Œ index çš„è®¡ç®—ï¼Œè€Œ <strong>8 ä¸éœ€è¦ï¼Œé€šè¿‡åˆ¤æ–­ç›¸åº”çš„ä½æ˜¯ 0 è¿˜æ˜¯ 1ï¼Œè¦ä¹ˆä¾æ—§æ˜¯åŸ indexï¼Œè¦ä¹ˆæ˜¯ oldCap + åŸ index</strong>ã€‚</li>
</ol>
<h4 id="æ­»å¾ªç¯åˆ†æ"><a href="#æ­»å¾ªç¯åˆ†æ" class="headerlink" title="æ­»å¾ªç¯åˆ†æ"></a>æ­»å¾ªç¯åˆ†æ</h4><p>jdk1.7 å¤´æ’æ³• + hashmapæœ¬æ¥å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„é›†åˆï¼Œæ‰€ä»¥å¯¼è‡´è¯¥é—®é¢˜çš„å‡ºç°ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://coolshell.cn/articles/9606.html">https://coolshell.cn/articles/9606.html</a></p>
<h3 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a>LinkedHashMap</h3><p>LinkedHashMap ç»§æ‰¿è‡ª HashMapï¼Œåœ¨ HashMap åŸºç¡€ä¸Šï¼Œé€šè¿‡ç»´æŠ¤ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œè§£å†³äº† HashMap ä¸èƒ½éšæ—¶ä¿æŒéå†é¡ºåºå’Œæ’å…¥é¡ºåºä¸€è‡´çš„é—®é¢˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒLinkedHashMap å¯¹è®¿é—®é¡ºåºä¹Ÿæä¾›äº†ç›¸å…³æ”¯æŒã€‚åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œè¯¥ç‰¹æ€§å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç¼“å­˜ã€‚åœ¨å®ç°ä¸Šï¼ŒLinkedHashMap å¾ˆå¤šæ–¹æ³•ç›´æ¥ç»§æ‰¿è‡ª HashMapï¼Œä»…ä¸ºç»´æŠ¤åŒå‘é“¾è¡¨è¦†å†™äº†éƒ¨åˆ†æ–¹æ³•ã€‚</p>
<p>LinkedHashMapç»§æ‰¿äº†HashMapï¼Œå†…éƒ¨é™æ€ç±»Entryç»§æ‰¿äº†HashMapçš„Entryï¼Œä½†æ˜¯LinkedHashMap.Entryå¤šäº†ä¸¤ä¸ªå­—æ®µï¼šbeforeå’Œafterï¼Œbeforeè¡¨ç¤ºåœ¨æœ¬èŠ‚ç‚¹ä¹‹å‰æ·»åŠ åˆ°LinkedHashMapçš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œafterè¡¨ç¤ºåœ¨æœ¬èŠ‚ç‚¹ä¹‹åæ·»åŠ åˆ°LinkedHashMapçš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œçš„ä¹‹å‰å’Œä¹‹åæŒ‡æ—¶é—´ä¸Šçš„å…ˆåé¡ºåºã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinkedHashMapçš„è¿­ä»£é¡ºåºæ˜¯æŒ‰ç…§æ’å…¥èŠ‚ç‚¹çš„é¡ºåºã€‚ä¹Ÿå¯ä»¥é€šè¿‡æ”¹å˜accessOrderå‚æ•°çš„å€¼ï¼Œä½¿å¾—å…¶éå†é¡ºåºæŒ‰ç…§è®¿é—®é¡ºåºè¾“å‡ºã€‚</p>
<h4 id="æ·»åŠ "><a href="#æ·»åŠ " class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h4><p>LinkedHashMapåœ¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¾æ—§ä½¿ç”¨çš„æ˜¯HashMapä¸­çš„putæ–¹æ³•ã€‚ä¸åŒçš„æ˜¯LinkedHashMapé‡å†™äº†newNode()æ–¹æ³•åœ¨æ¯æ¬¡æ„å»ºæ–°èŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡linkNodeLast(p);å°†æ–°èŠ‚ç‚¹é“¾æ¥åœ¨å†…éƒ¨åŒå‘é“¾è¡¨çš„å°¾éƒ¨ã€‚</p>
<h4 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h4><p>LinkedHashMapé‡å†™äº†get()å’ŒgetOrDefault()æ–¹æ³•é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinkedHashMapæ˜¯æŒ‰æ’å…¥é¡ºåºç»´æŠ¤é“¾è¡¨ã€‚ä¸è¿‡å¦‚æœæˆ‘ä»¬åœ¨åˆå§‹åŒ– LinkedHashMapæ—¶ï¼ŒæŒ‡å®š accessOrderå‚æ•°ä¸º trueï¼Œå³å¯è®©å®ƒæŒ‰è®¿é—®é¡ºåºç»´æŠ¤é“¾è¡¨ã€‚è®¿é—®é¡ºåºçš„åŸç†æ˜¯ï¼Œå½“æˆ‘ä»¬è°ƒç”¨get/getOrDefault/replaceç­‰æ–¹æ³•æ—¶ï¼Œä¼šå°†è¿™äº›æ–¹æ³•è®¿é—®çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨çš„å°¾éƒ¨ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Ccww-lx/JavaCommunity/blob/master/doc/javabase/collection/LinkedHashMap%20%E6%BA%90%E7%A0%81%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90.md">https://github.com/Ccww-lx/JavaCommunity/blob/master/doc/javabase/collection/LinkedHashMap%20%E6%BA%90%E7%A0%81%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90.md</a></p>
<p><a target="_blank" rel="noopener" href="https://gyl-coder.top/java/collection/LinkedHashMap/">https://gyl-coder.top/java/collection/LinkedHashMap/</a></p>
<h3 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h3><p>TreeMapæœ€æ—©å‡ºç°åœ¨JDK 1.2ä¸­ï¼Œæ˜¯ Java é›†åˆæ¡†æ¶ä¸­æ¯”è¾ƒé‡è¦ä¸€ä¸ªçš„å®ç°ã€‚TreeMap åº•å±‚åŸºäºçº¢é»‘æ ‘å®ç°ï¼Œå¯ä¿è¯åœ¨log(n)æ—¶é—´å¤æ‚åº¦å†…å®Œæˆ containsKeyã€getã€put å’Œ remove æ“ä½œï¼Œæ•ˆç‡å¾ˆé«˜ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äº TreeMap åŸºäºçº¢é»‘æ ‘å®ç°ï¼Œè¿™ä¸º TreeMap ä¿æŒé”®çš„æœ‰åºæ€§æ‰“ä¸‹äº†åŸºç¡€ã€‚æ€»çš„æ¥è¯´ï¼ŒTreeMap çš„æ ¸å¿ƒæ˜¯çº¢é»‘æ ‘ï¼Œå…¶å¾ˆå¤šæ–¹æ³•ä¹Ÿæ˜¯å¯¹çº¢é»‘æ ‘å¢åˆ æŸ¥åŸºç¡€æ“ä½œçš„ä¸€ä¸ªåŒ…è£…ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Ccww-lx/JavaCommunity/blob/master/doc/javabase/collection/TreeMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.md">https://github.com/Ccww-lx/JavaCommunity/blob/master/doc/javabase/collection/TreeMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.md</a></p>
<h3 id="hashtableä¸hashmap"><a href="#hashtableä¸hashmap" class="headerlink" title="hashtableä¸hashmap"></a>hashtableä¸hashmap</h3><p><strong>hashtableä¸hashmap</strong></p>
<p><strong>ç›¸åŒç‚¹ï¼š</strong>å‚¨å­˜ç»“æ„å’Œå®ç°åŸºæœ¬ç›¸åŒï¼Œéƒ½æ˜¯æ˜¯å®ç°çš„Mapæ¥å£</p>
<p><strong>ä¸åŒç‚¹ï¼š</strong></p>
<ul>
<li><p>Hashtableæ˜¯çº¿ç¨‹å®‰å…¨ï¼ŒHashMapéçº¿ç¨‹å®‰å…¨ã€‚éœ€è¦åŒæ­¥çš„æ—¶å€™å¯ä»¥ConcurrentHashMapæ–¹æ³•ã€‚</p>
</li>
<li><p>HashMapå¯ä»¥ä½¿ç”¨nullä½œä¸ºkeyã€valueï¼Œå¹¶ä¸”nullå…ƒç´ ä¼šè®¡å…¥sizeã€‚Hashtableä¸å…è®¸nullä½œä¸ºkeyã€valueï¼Œå½“å‡ºç°nullå€¼ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
</li>
<li><p>HashMapç»§æ‰¿çš„æ˜¯AbstractMapï¼ŒHashTableç»§æ‰¿çš„æ˜¯Dictionary</p>
</li>
<li><p>HashMapæä¾›å¯¹keyçš„Setè¿›è¡Œéå†ï¼Œå› æ­¤å®ƒæ˜¯fail-fastçš„ï¼Œä½†HashTableæä¾›å¯¹keyçš„Enumerationè¿›è¡Œéå†ï¼Œå®ƒä¸æ”¯æŒfail-fastã€‚</p>
</li>
<li><p>HashTableæ˜¯ä¸€ä¸ªé—ç•™ç±»ï¼Œå¦‚æœéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨æ¨èä½¿ç”¨CocurrentHashMap</p>
</li>
<li><p>HashMapçš„åˆå§‹å®¹é‡ä¸º16ï¼ŒHashtableåˆå§‹å®¹é‡ä¸º11ï¼Œä¸¤è€…çš„å¡«å……å› å­é»˜è®¤éƒ½æ˜¯0.75</p>
</li>
<li><p>HashMapæ‰©å®¹æ—¶æ˜¯å½“å‰å®¹é‡ç¿»å€å³ï¼šcapacity*2 Hashtableæ‰©å®¹æ—¶æ˜¯å®¹é‡ç¿»å€+1å³capacity*2+1</p>
</li>
<li><p>HashMapçš„åˆå§‹å®¹é‡ä¸º16ï¼ŒHashtableåˆå§‹å®¹é‡ä¸º11ï¼Œä¸¤è€…çš„å¡«å……å› å­é»˜è®¤éƒ½æ˜¯0.75</p>
</li>
<li><p>Hashtableè®¡ç®—hashæ˜¯ç›´æ¥ä½¿ç”¨keyçš„hashcodeå¯¹tableæ•°ç»„çš„é•¿åº¦ç›´æ¥è¿›è¡Œå–æ¨¡ã€‚HashMapè®¡ç®—hashå¯¹keyçš„hashcodeè¿›è¡Œäº†äºŒæ¬¡hashï¼Œä»¥è·å¾—æ›´å¥½çš„æ•£åˆ—å€¼ï¼Œç„¶åå¯¹tableæ•°ç»„é•¿åº¦å–æ‘¸</p>
</li>
</ul>
<blockquote>
<p>Dictionaryæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒç›´æ¥ç»§æ‰¿äºObjectç±»ï¼Œæ²¡æœ‰å®ç°ä»»ä½•æ¥å£ã€‚Dictionaryç±»æ˜¯JDK 1.0çš„å¼•å…¥çš„ã€‚è™½ç„¶Dictionaryä¹Ÿæ”¯æŒâ€œæ·»åŠ key-valueé”®å€¼å¯¹â€ã€â€œè·å–valueâ€ã€â€œè·å–å¤§å°â€ç­‰åŸºæœ¬æ“ä½œï¼Œä½†å®ƒçš„APIå‡½æ•°æ¯”Mapå°‘ï¼›è€Œä¸”Dictionaryä¸€èˆ¬æ˜¯é€šè¿‡Enumeration(æšä¸¾ç±»)å»éå†ï¼ŒMapåˆ™æ˜¯é€šè¿‡Iterator(è¿­ä»£å™¨)å»éå†ã€‚ ç„¶è€Œâ€˜ç”±äºHashtableä¹Ÿå®ç°äº†Mapæ¥å£ï¼Œæ‰€ä»¥ï¼Œå®ƒæ—¢æ”¯æŒEnumerationéå†ï¼Œä¹Ÿæ”¯æŒIteratoréå†ã€‚</p>
</blockquote>
<h3 id="HashMapä¸TreeMap"><a href="#HashMapä¸TreeMap" class="headerlink" title="HashMapä¸TreeMap"></a>HashMapä¸TreeMap</h3><p>HashMapé€šè¿‡hashcodeå¯¹å…¶å†…å®¹è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾ï¼Œè€ŒTreeMapä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½ä¿æŒç€æŸç§å›ºå®šçš„é¡ºåºï¼Œå¦‚æœä½ éœ€è¦å¾—åˆ°ä¸€ä¸ªæœ‰åºçš„ç»“æœä½ å°±åº”è¯¥ä½¿ç”¨TreeMapï¼ˆHashMapä¸­å…ƒç´ çš„æ’åˆ—é¡ºåºæ˜¯ä¸å›ºå®šçš„ï¼‰ã€‚HashMapä¸­å…ƒç´ çš„æ’åˆ—é¡ºåºæ˜¯ä¸å›ºå®šçš„ï¼‰ã€‚</p>
<p>åœ¨Map ä¸­æ’å…¥ã€åˆ é™¤å’Œå®šä½å…ƒç´ ï¼ŒHashMap æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ä½†å¦‚æœæ‚¨è¦æŒ‰è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰é¡ºåºéå†é”®ï¼Œé‚£ä¹ˆTreeMapä¼šæ›´å¥½ã€‚ä½¿ç”¨HashMapè¦æ±‚æ·»åŠ çš„é”®ç±»æ˜ç¡®å®šä¹‰äº†hashCode()å’Œ equals()çš„å®ç°ã€‚ è¿™ä¸ªTreeMapæ²¡æœ‰è°ƒä¼˜é€‰é¡¹ï¼Œå› ä¸ºè¯¥æ ‘æ€»å¤„äºå¹³è¡¡çŠ¶æ€ã€‚</p>
<h3 id="TreeMapå’ŒTreeSetåœ¨æ’åºæ—¶å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼ŸCollectionså·¥å…·ç±»ä¸­çš„sort-æ–¹æ³•å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ"><a href="#TreeMapå’ŒTreeSetåœ¨æ’åºæ—¶å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼ŸCollectionså·¥å…·ç±»ä¸­çš„sort-æ–¹æ³•å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ" class="headerlink" title="TreeMapå’ŒTreeSetåœ¨æ’åºæ—¶å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼ŸCollectionså·¥å…·ç±»ä¸­çš„sort()æ–¹æ³•å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ"></a>TreeMapå’ŒTreeSetåœ¨æ’åºæ—¶å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼ŸCollectionså·¥å…·ç±»ä¸­çš„sort()æ–¹æ³•å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ</h3><p>TreeSetè¦æ±‚å­˜æ”¾çš„å¯¹è±¡æ‰€å±çš„ç±»å¿…é¡»å®ç°Comparableæ¥å£ï¼Œè¯¥æ¥å£æä¾›äº†æ¯”è¾ƒå…ƒç´ çš„compareTo()æ–¹æ³•ï¼Œå½“æ’å…¥å…ƒç´ æ—¶ä¼šå›è°ƒè¯¥æ–¹æ³•æ¯”è¾ƒå…ƒç´ çš„å¤§å°ã€‚</p>
<p>TreeMapè¦æ±‚å­˜æ”¾çš„é”®å€¼å¯¹æ˜ å°„çš„é”®å¿…é¡»å®ç°Comparableæ¥å£ä»è€Œæ ¹æ®é”®å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</p>
<p>Collectionså·¥å…·ç±»çš„sortæ–¹æ³•æœ‰ä¸¤ç§é‡è½½çš„å½¢å¼ï¼Œ<strong>ç¬¬ä¸€ç§</strong>è¦æ±‚ä¼ å…¥çš„å¾…æ’åºå®¹å™¨ä¸­å­˜æ”¾çš„å¯¹è±¡æ¯”è¾ƒå®ç°Comparableæ¥å£ä»¥å®ç°å…ƒç´ çš„æ¯”è¾ƒï¼›<strong>ç¬¬äºŒç§</strong>ä¸å¼ºåˆ¶æ€§çš„è¦æ±‚å®¹å™¨ä¸­çš„å…ƒç´ å¿…é¡»å¯æ¯”è¾ƒï¼Œä½†æ˜¯è¦æ±‚ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œå‚æ•°æ˜¯Comparatoræ¥å£çš„å­ç±»å‹ï¼ˆéœ€è¦é‡å†™compareæ–¹æ³•å®ç°å…ƒç´ çš„æ¯”è¾ƒï¼‰ï¼Œç›¸å½“äºä¸€ä¸ªä¸´æ—¶å®šä¹‰çš„æ’åºè§„åˆ™ï¼Œå…¶å®å°±æ˜¯é€šè¿‡æ¥å£æ³¨å…¥æ¯”è¾ƒå…ƒç´ å¤§å°çš„ç®—æ³•ï¼Œä¹Ÿæ˜¯å¯¹å›è°ƒæ¨¡å¼çš„åº”ç”¨ï¼ˆJavaä¸­å¯¹å‡½æ•°å¼ç¼–ç¨‹çš„æ”¯æŒï¼‰ã€‚</p>
<h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><p><a target="_blank" rel="noopener" href="https://github.com/Ccww-lx/JavaCommunity/blob/master/doc/javabase/collection/ConcurrentHashMap%E6%BA%90%E7%A0%81%E5%92%8C%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80.md">https://github.com/Ccww-lx/JavaCommunity/blob/master/doc/javabase/collection/ConcurrentHashMap%E6%BA%90%E7%A0%81%E5%92%8C%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80.md</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904023003250701#heading-0">https://juejin.cn/post/6844904023003250701#heading-0</a></p>
<p>ConcurrentHashMapçš„å‡ºç°ä¸»è¦ä¸ºäº†è§£å†³hashmapåœ¨å¹¶å‘ç¯å¢ƒä¸‹ä¸å®‰å…¨ï¼ŒJDK1.8ConcurrentHashMapçš„è®¾è®¡ä¸å®ç°éå¸¸ç²¾å·§ï¼Œå¤§é‡çš„åˆ©ç”¨äº†volatileï¼ŒCASç­‰ä¹è§‚é”æŠ€æœ¯æ¥å‡å°‘é”ç«äº‰å¯¹äºæ€§èƒ½çš„å½±å“ï¼Œ</p>
<p><strong>ConcurrentHashMapä¿è¯çº¿ç¨‹å®‰å…¨çš„æ–¹æ¡ˆæ˜¯ï¼š</strong></p>
<ul>
<li><strong>JDK1.8ï¼šsynchronized+CAS+Node+çº¢é»‘æ ‘ï¼›</strong></li>
<li><strong>JDK1.7ï¼šReentrantLock+Segment+HashEntryã€‚</strong></li>
</ul>
<h4 id="JDK7-ConcurrentHashMap"><a href="#JDK7-ConcurrentHashMap" class="headerlink" title="JDK7 ConcurrentHashMap"></a>JDK7 ConcurrentHashMap</h4><p>åœ¨JDK1.7ä¸­ConcurrentHashMapç”±Segment(åˆ†æ®µé”)æ•°ç»„ç»“æ„å’ŒHashEntryæ•°ç»„ç»„æˆï¼Œä¸”ä¸»è¦é€šè¿‡Segment(åˆ†æ®µé”)æ®µæŠ€æœ¯å®ç°çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>Segmentæ˜¯ä¸€ç§å¯é‡å…¥é”ï¼Œæ˜¯ä¸€ç§æ•°ç»„å’Œé“¾è¡¨çš„ç»“æ„ï¼Œä¸€ä¸ªSegmentä¸­åŒ…å«ä¸€ä¸ªHashEntryæ•°ç»„ï¼Œæ¯ä¸ªHashEntryåˆæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œå› æ­¤åœ¨ConcurrentHashMapæŸ¥è¯¢ä¸€ä¸ªå…ƒç´ çš„è¿‡ç¨‹éœ€è¦è¿›è¡Œä¸¤æ¬¡Hashæ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡Hashå®šä½åˆ°Segmentï¼Œ</li>
<li>ç¬¬äºŒæ¬¡Hashå®šä½åˆ°å…ƒç´ æ‰€åœ¨çš„é“¾è¡¨çš„å¤´éƒ¨</li>
</ul>
<p>æ­£æ˜¯é€šè¿‡Segmentåˆ†æ®µé”æŠ€æœ¯ï¼Œå°†æ•°æ®åˆ†æˆä¸€æ®µä¸€æ®µçš„å­˜å‚¨ï¼Œç„¶åç»™æ¯ä¸€æ®µæ•°æ®é…ä¸€æŠŠé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®å…¶ä¸­ä¸€ä¸ªæ®µæ•°æ®çš„æ—¶å€™ï¼Œå…¶ä»–æ®µçš„æ•°æ®ä¹Ÿèƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ï¼Œèƒ½å¤Ÿå®ç°çœŸæ­£çš„å¹¶å‘è®¿é—®ã€‚</p>
<p>è¿™æ ·ç»“æ„ä¼šä½¿Hashçš„è¿‡ç¨‹è¦æ¯”æ™®é€šçš„HashMapè¦é•¿ï¼Œå½±å“æ€§èƒ½ï¼Œä½†å†™æ“ä½œçš„æ—¶å€™å¯ä»¥åªå¯¹å…ƒç´ æ‰€åœ¨çš„Segmentè¿›è¡ŒåŠ é”å³å¯ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„Segmentï¼ŒConcurrentHashMapæå‡äº†å¹¶å‘èƒ½åŠ›ã€‚</p>
<h4 id="JDK8-ConcurrentHashMap"><a href="#JDK8-ConcurrentHashMap" class="headerlink" title="JDK8 ConcurrentHashMap"></a>JDK8 ConcurrentHashMap</h4><p>åœ¨JDK8ConcurrentHashMapå†…éƒ¨æœºæ„ï¼šæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼ŒJava 8åœ¨é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼(8)æ—¶å°†é“¾è¡¨ï¼ˆå¯»å€æ—¶é—´å¤æ‚åº¦ä¸ºO(N)ï¼‰è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼ˆå¯»å€æ—¶é—´å¤æ‚åº¦ä¸ºO(long(N)))ï¼Œç»“æ„åŸºæœ¬ä¸Šä¸åŠŸèƒ½å’ŒJDK8çš„HashMapä¸€æ ·ï¼Œåªä¸è¿‡ConcurrentHashMapä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/a8e30fb93f536f07d9b9cc967baef090022d82043d8db9c457a6f0d44412c47c/68747470733a2f2f70312d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f37636366316561383436333534383230386334376231303438396131366231657e74706c762d6b3375316662706663702d7a6f6f6d2d312e696d616765"><img src="https://camo.githubusercontent.com/a8e30fb93f536f07d9b9cc967baef090022d82043d8db9c457a6f0d44412c47c/68747470733a2f2f70312d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f37636366316561383436333534383230386334376231303438396131366231657e74706c762d6b3375316662706663702d7a6f6f6d2d312e696d616765" alt="img"></a></p>
<p>ä½†åœ¨JDK1.8ä¸­æ‘’å¼ƒäº†Segmentåˆ†æ®µé”çš„æ•°æ®ç»“æ„ï¼ŒåŸºäºCASæ“ä½œä¿è¯æ•°æ®çš„è·å–ä»¥åŠä½¿ç”¨synchronizedå…³é”®å­—å¯¹ç›¸åº”æ•°æ®æ®µåŠ é”æ¥å®ç°çº¿ç¨‹å®‰å…¨ï¼Œè¿™è¿›ä¸€æ­¥æé«˜äº†å¹¶å‘æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        <span class="keyword">volatile</span> V val;  <span class="comment">//ä½¿ç”¨äº†volatileå±æ€§</span></span><br><span class="line">        <span class="keyword">volatile</span> Node&lt;K,V&gt; next;  <span class="comment">//ä½¿ç”¨äº†volatileå±æ€§</span></span><br><span class="line">    	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ConcurrentHashMapé‡‡ç”¨Nodeç±»ä½œä¸ºåŸºæœ¬çš„å­˜å‚¨å•å…ƒï¼Œæ¯ä¸ªé”®å€¼å¯¹(key-value)éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªNodeä¸­ï¼Œä½¿ç”¨äº†volatileå…³é”®å­—ä¿®é¥°valueå’Œnextï¼Œä¿è¯å¹¶å‘çš„å¯è§æ€§ã€‚å…¶ä¸­Nodeå­ç±»æœ‰ï¼š</p>
<ul>
<li>ForwardingNodeï¼šæ‰©å®¹èŠ‚ç‚¹ï¼Œåªæ˜¯åœ¨æ‰©å®¹é˜¶æ®µä½¿ç”¨çš„èŠ‚ç‚¹ï¼Œä¸»è¦ä½œä¸ºä¸€ä¸ªæ ‡è®°ï¼Œåœ¨å¤„ç†å¹¶å‘æ—¶èµ·ç€å…³é”®ä½œç”¨ï¼Œæœ‰äº†ForwardingNodesï¼Œä¹Ÿæ˜¯ConcurrentHashMapæœ‰äº†åˆ†æ®µçš„ç‰¹æ€§ï¼Œæé«˜äº†å¹¶å‘æ•ˆç‡</li>
<li>TreeBinï¼šTreeNodeçš„ä»£ç†èŠ‚ç‚¹ï¼Œç”¨äºç»´æŠ¤TreeNodesï¼ŒConcurrentHashMapçš„çº¢é»‘æ ‘å­˜æ”¾çš„æ˜¯TreeBin</li>
<li>TreeNodeï¼šç”¨äºæ ‘ç»“æ„ä¸­ï¼Œçº¢é»‘æ ‘çš„èŠ‚ç‚¹ï¼ˆå½“é“¾è¡¨é•¿åº¦å¤§äº8æ—¶è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼‰ï¼Œæ­¤èŠ‚ç‚¹ä¸èƒ½ç›´æ¥æ”¾å…¥æ¡¶å†…ï¼Œåªèƒ½æ˜¯ä½œä¸ºçº¢é»‘æ ‘çš„èŠ‚ç‚¹</li>
<li>ReservationNodeï¼šä¿ç•™ç»“ç‚¹</li>
</ul>
<p>ConcurrentHashMapä¸­æŸ¥æ‰¾å…ƒç´ ã€æ›¿æ¢å…ƒç´ å’Œèµ‹å€¼å…ƒç´ éƒ½æ˜¯åŸºäº<code>sun.misc.Unsafe</code>ä¸­<strong>åŸå­æ“ä½œ</strong>å®ç°<strong>å¤šå¹¶å‘çš„æ— é”åŒ–</strong>æ“ä½œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">static final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) &#123;</span><br><span class="line">        return (Node&lt;K,V&gt;)U.getObjectAcquire(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static final &lt;K,V&gt; boolean casTabAt(Node&lt;K,V&gt;[] tab, int i,</span><br><span class="line">                                     Node&lt;K,V&gt; c, Node&lt;K,V&gt; v) &#123;</span><br><span class="line">    return U.compareAndSetObject(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, c, v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static final &lt;K,V&gt; void setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v) &#123;</span><br><span class="line">    U.putObjectRelease(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ConcurrentHashMapçš„put-æ–¹æ³•"><a href="#ConcurrentHashMapçš„put-æ–¹æ³•" class="headerlink" title="ConcurrentHashMapçš„put()æ–¹æ³•"></a>ConcurrentHashMapçš„put()æ–¹æ³•</h3><p>ConcurrentHashMapçš„putçš„æµç¨‹æ­¥éª¤</p>
<ol>
<li><p>å¦‚æœkeyæˆ–è€…valueä¸ºnullï¼Œåˆ™æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå’ŒHashMapä¸åŒçš„æ˜¯HashMapå•çº¿ç¨‹æ˜¯å…è®¸ä¸ºNullï¼›</p>
<p><code>if (key == null || value == null) throw new NullPointerException();</code></p>
</li>
<li><p>forçš„æ­»å¾ªç¯ï¼Œä¸ºäº†å®ç°CASçš„æ— é”åŒ–æ›´æ–°ï¼Œå¦‚æœtableä¸ºnullæˆ–è€…tableçš„é•¿åº¦ä¸º0ï¼Œåˆ™åˆå§‹åŒ–tableï¼Œè°ƒç”¨<code>initTable()</code>æ–¹æ³•ï¼ˆç¬¬ä¸€æ¬¡putæ•°æ®ï¼Œè°ƒç”¨é»˜è®¤å‚æ•°å®ç°ï¼Œå…¶ä¸­é‡è¦çš„<code>sizeCtl</code>å‚æ•°ï¼‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;è®¡ç®—ç´¢å¼•çš„ç¬¬ä¸€æ­¥ï¼Œä¼ å…¥é”®å€¼çš„hashå€¼</span><br><span class="line">int hash &#x3D; spread(key.hashCode());</span><br><span class="line">int binCount &#x3D; 0; &#x2F;&#x2F;ä¿å­˜å½“å‰èŠ‚ç‚¹çš„é•¿åº¦</span><br><span class="line">for (Node&lt;K,V&gt;[] tab &#x3D; table;;) &#123;</span><br><span class="line">    Node&lt;K,V&gt; f; int n, i, fh; K fk; V fv;</span><br><span class="line">    if (tab &#x3D;&#x3D; null || (n &#x3D; tab.length) &#x3D;&#x3D; 0)</span><br><span class="line">        tab &#x3D; initTable(); &#x2F;&#x2F;åˆå§‹åŒ–Hashè¡¨</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ç¡®å®šå…ƒç´ åœ¨Hashè¡¨çš„ç´¢å¼•</p>
<p>é€šè¿‡hashç®—æ³•å¯ä»¥å°†å…ƒç´ åˆ†æ•£åˆ°å“ˆå¸Œæ¡¶ä¸­ã€‚åœ¨ConcurrentHashMapä¸­é€šè¿‡å¦‚ä¸‹æ–¹æ³•ç¡®å®šæ•°ç»„ç´¢å¼•ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static final int spread(int h) &#123;</span><br><span class="line">        return (h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS; </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼š<code>(length-1) &amp; (h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS);</code></p>
</li>
<li><p>é€šè¿‡<code>tableAt()</code>æ–¹æ³•æ‰¾åˆ°ä½ç½®<code>tab[i]</code>çš„<code>Node</code>,å½“Nodeä¸ºnullæ—¶ä¸ºæ²¡æœ‰<code>hash</code>å†²çªçš„è¯ï¼Œä½¿ç”¨<code>casTabAt()</code>æ–¹æ³•<code>CAS</code>æ“ä½œå°†å…ƒç´ æ’å…¥åˆ°<code>Hash</code>è¡¨ä¸­ï¼Œ<code>ConcurrentHashmap</code>ä½¿ç”¨<code>CAS</code>æ— é”åŒ–æ“ä½œï¼Œè¿™æ ·åœ¨é«˜å¹¶å‘<code>hash</code>å†²çªä½çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½è‰¯å¥½ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">else if ((f &#x3D; tabAt(tab, i &#x3D; (n - 1) &amp; hash)) &#x3D;&#x3D; null) &#123;</span><br><span class="line">	            &#x2F;&#x2F;åˆ©ç”¨CASæ“ä½œå°†å…ƒç´ æ’å…¥åˆ°Hashè¡¨ä¸­</span><br><span class="line">                if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value)))</span><br><span class="line">                    break;  &#x2F;&#x2F; no lock when adding to empty bin(æ’å…¥nullçš„èŠ‚ç‚¹ï¼Œæ— éœ€åŠ é”)</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>å½“fä¸ä¸ºnullæ—¶ï¼Œè¯´æ˜å‘ç”Ÿäº†hashå†²çªï¼Œå½“f.hash == MOVED==-1 æ—¶ï¼Œè¯´æ˜<code>ConcurrentHashmap</code>æ­£åœ¨å‘ç”Ÿ<code>resize</code>æ“ä½œ,ä½¿ç”¨<code>helpTransfer()</code>æ–¹æ³•å¸®åŠ©æ­£åœ¨è¿›è¡Œresizeæ“ä½œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">else if ((fh &#x3D; f.hash) &#x3D;&#x3D; MOVED) &#x2F;&#x2F;f.hash &#x3D;&#x3D; -1 </span><br><span class="line">        &#x2F;&#x2F;hashä¸º-1 è¯´æ˜æ˜¯ä¸€ä¸ªforwarding nodesèŠ‚ç‚¹ï¼Œè¡¨æ˜æ­£åœ¨æ‰©å®¹</span><br><span class="line">        tab &#x3D; helpTransfer(tab, f);</span><br></pre></td></tr></table></figure></li>
<li><p>ä»¥ä¸Šæƒ…å†µéƒ½ä¸æ»¡è¶³çš„æ—¶ï¼Œä½¿ç”¨<code>synchronized</code>åŒæ­¥å—ä¸Šé”å½“å‰èŠ‚ç‚¹<code>Node </code>,å¹¶åˆ¤æ–­æœ‰æ²¡æœ‰çº¿ç¨‹å¯¹æ•°ç»„è¿›è¡Œäº†ä¿®æ”¹ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œï¼š</p>
<ul>
<li>éå†è¯¥é“¾è¡¨å¹¶ç»Ÿè®¡è¯¥é“¾è¡¨é•¿åº¦<code>binCount</code>ï¼ŒæŸ¥æ‰¾æ˜¯å¦æœ‰å’Œkeyç›¸åŒçš„èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰åˆ™å°†æŸ¥æ‰¾åˆ°èŠ‚ç‚¹çš„valå€¼æ›¿æ¢ä¸ºæ–°çš„valueå€¼ï¼Œå¹¶è¿”å›æ—§çš„valueå€¼ï¼Œå¦åˆ™æ ¹æ®keyï¼Œvalueï¼Œhashåˆ›å»ºæ–°Nodeå¹¶å°†å…¶æ”¾åœ¨é“¾è¡¨çš„å°¾éƒ¨</li>
<li>å¦‚æœ<code>Node f</code>æ˜¯<code>TreeBin</code>çš„ç±»å‹ï¼Œåˆ™ä½¿ç”¨çº¢é»‘æ ‘çš„æ–¹å¼è¿›è¡Œæ’å…¥ã€‚ç„¶ååˆ™é€€å‡º<code>synchronized(f)</code>é”ä½çš„ä»£ç å—</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å½“å‰èŠ‚ç‚¹åŠ é”</span><br><span class="line"> synchronized (f) &#123;</span><br><span class="line"> &#x2F;&#x2F;åˆ¤æ–­ä¸‹æœ‰æ²¡æœ‰çº¿ç¨‹å¯¹æ•°ç»„è¿›è¡Œäº†ä¿®æ”¹</span><br><span class="line"> if (tabAt(tab, i) &#x3D;&#x3D; f) &#123;</span><br><span class="line">       &#x2F;&#x2F;å¦‚æœhashå€¼æ˜¯å¤§äºç­‰äº0çš„è¯´æ˜æ˜¯é“¾è¡¨</span><br><span class="line">        if (fh &gt;&#x3D; 0) &#123;</span><br><span class="line">              binCount &#x3D; 1;</span><br><span class="line">              for (Node&lt;K,V&gt; e &#x3D; f;; ++binCount) &#123;</span><br><span class="line">                    K ek;</span><br><span class="line">                   &#x2F;&#x2F;æ’å…¥çš„å…ƒç´ é”®å€¼çš„hashå€¼æœ‰èŠ‚ç‚¹ä¸­å…ƒç´ çš„hashå€¼ç›¸åŒï¼Œæ›¿æ¢å½“å‰å…ƒç´ çš„å€¼</span><br><span class="line">                      if (e.hash &#x3D;&#x3D; hash &amp;&amp;</span><br><span class="line">                           ((ek &#x3D; e.key) &#x3D;&#x3D; key ||</span><br><span class="line">                            (ek !&#x3D; null &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                            oldVal &#x3D; e.val;</span><br><span class="line">                            if (!onlyIfAbsent)</span><br><span class="line">                                &#x2F;&#x2F;æ›¿æ¢å½“å‰å…ƒç´ çš„å€¼</span><br><span class="line">                                e.val &#x3D; value;</span><br><span class="line">                            break;</span><br><span class="line">                        &#125;</span><br><span class="line">                     Node&lt;K,V&gt; pred &#x3D; e;</span><br><span class="line">                      &#x2F;&#x2F;å¦‚æœå¾ªç¯åˆ°é“¾è¡¨ç»“å°¾è¿˜æ²¡å‘ç°ï¼Œé‚£ä¹ˆè¿›è¡Œæ’å…¥æ“ä½œ</span><br><span class="line">                     if ((e &#x3D; e.next) &#x3D;&#x3D; null) &#123;</span><br><span class="line">                            pred.next &#x3D; new Node&lt;K,V&gt;(hash, key, value);</span><br><span class="line">                            break;</span><br><span class="line">                   		&#125;</span><br><span class="line">            	&#125;</span><br><span class="line">     	 &#125;else if (f instanceof TreeBin) &#123; &#x2F;&#x2F;èŠ‚ç‚¹ä¸ºæ ‘</span><br><span class="line">                        Node&lt;K,V&gt; p;</span><br><span class="line">                        binCount &#x3D; 2;</span><br><span class="line">                        if ((p &#x3D; ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class="line">                                                       value)) !&#x3D; null) &#123;</span><br><span class="line">                            oldVal &#x3D; p.val;</span><br><span class="line">                            if (!onlyIfAbsent)</span><br><span class="line">                                &#x2F;&#x2F;æ›¿æ¢æ—§å€¼</span><br><span class="line">                                p.val &#x3D; value;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else if (f instanceof ReservationNode)</span><br><span class="line">                        throw new IllegalStateException(&quot;Recursive update&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;	 </span><br></pre></td></tr></table></figure></li>
<li><p>æ‰§è¡Œå®Œ<code>synchronized(f)</code>åŒæ­¥ä»£ç å—ä¹‹åä¼šå…ˆæ£€æŸ¥<code>binCount</code>,å¦‚æœå¤§äºç­‰äºTREEIFY_THRESHOLD = 8åˆ™è¿›è¡ŒtreeifyBinæ“ä½œå°è¯•å°†è¯¥é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if (binCount !&#x3D; 0) &#123;</span><br><span class="line">              &#x2F;&#x2F;å¦‚æœèŠ‚ç‚¹é•¿åº¦å¤§äº8,è½¬åŒ–ä¸ºæ ‘</span><br><span class="line">              if (binCount &gt;&#x3D; TREEIFY_THRESHOLD)</span><br><span class="line">                   treeifyBin(tab, i);</span><br><span class="line">              if (oldVal !&#x3D; null)</span><br><span class="line">                   return oldVal; </span><br><span class="line">               break;</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>æ‰§è¡Œäº†ä¸€ä¸ª<code>addCount</code>æ–¹æ³•,ä¸»è¦ç”¨äºç»Ÿè®¡æ•°é‡ä»¥åŠå†³å®šæ˜¯å¦éœ€è¦æ‰©å®¹.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addCount(1L, binCount);</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="ConcurrentHashmap-ä¸æ”¯æŒ-key-æˆ–è€…-value-ä¸º-null-çš„åŸå› ï¼Ÿ"><a href="#ConcurrentHashmap-ä¸æ”¯æŒ-key-æˆ–è€…-value-ä¸º-null-çš„åŸå› ï¼Ÿ" class="headerlink" title="ConcurrentHashmap ä¸æ”¯æŒ key æˆ–è€… value ä¸º null çš„åŸå› ï¼Ÿ"></a>ConcurrentHashmap ä¸æ”¯æŒ key æˆ–è€… value ä¸º null çš„åŸå› ï¼Ÿ</h4><p><code>ConcurrentHashmap</code>å’Œ<code>hashMap</code>ä¸åŒçš„æ˜¯ï¼Œ<code>concurrentHashMap</code>çš„<code>key</code>å’Œ<code>value</code>éƒ½ä¸å…è®¸ä¸ºnullï¼Œ</p>
<p>å› ä¸º<code>concurrenthashmap</code>å®ƒä»¬æ˜¯ç”¨äºå¤šçº¿ç¨‹çš„ï¼Œå¹¶å‘çš„ ï¼Œå¦‚æœ<code>map.get(key)</code>å¾—åˆ°äº†nullï¼Œä¸èƒ½åˆ¤æ–­åˆ°åº•æ˜¯æ˜ å°„çš„valueæ˜¯null,è¿˜æ˜¯å› ä¸ºæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„keyè€Œä¸ºç©ºï¼Œ</p>
<p>è€Œç”¨äºå•çº¿ç¨‹çŠ¶æ€çš„<code>hashmap</code>å´å¯ä»¥ç”¨<code>containKeyï¼ˆkeyï¼‰</code> å»åˆ¤æ–­åˆ°åº•æ˜¯å¦åŒ…å«äº†è¿™ä¸ªnullã€‚</p>
<h4 id="put-æ–¹æ³•å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨å‘¢ï¼Ÿ"><a href="#put-æ–¹æ³•å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨å‘¢ï¼Ÿ" class="headerlink" title="put()æ–¹æ³•å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨å‘¢ï¼Ÿ"></a>put()æ–¹æ³•å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨å‘¢ï¼Ÿ</h4><ol>
<li>åœ¨ç¬¬ä¸€æ¬¡putæ•°æ®æ—¶ï¼Œè°ƒç”¨<code>initTable()</code>æ–¹æ³•</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**  </span><br><span class="line">* Hashè¡¨çš„åˆå§‹åŒ–å’Œè°ƒæ•´å¤§å°çš„æ§åˆ¶æ ‡å¿—ã€‚ä¸ºè´Ÿæ•°ï¼ŒHashè¡¨æ­£åœ¨åˆå§‹åŒ–æˆ–è€…æ‰©å®¹;  </span><br><span class="line">* (-1è¡¨ç¤ºæ­£åœ¨åˆå§‹åŒ–,-Nè¡¨ç¤ºæœ‰N-1ä¸ªçº¿ç¨‹åœ¨è¿›è¡Œæ‰©å®¹)  </span><br><span class="line">* å¦åˆ™ï¼Œå½“è¡¨ä¸ºnullæ—¶ï¼Œä¿å­˜åˆ›å»ºæ—¶ä½¿ç”¨çš„åˆå§‹åŒ–å¤§å°æˆ–è€…é»˜è®¤0;  </span><br><span class="line">* åˆå§‹åŒ–ä»¥åä¿å­˜ä¸‹ä¸€ä¸ªè°ƒæ•´å¤§å°çš„å°ºå¯¸ã€‚  </span><br><span class="line">*&#x2F;  </span><br><span class="line">private transient volatile int sizeCtl;  </span><br><span class="line">    &#x2F;&#x2F;ç¬¬ä¸€æ¬¡putï¼Œåˆå§‹åŒ–æ•°ç»„  </span><br><span class="line">    private final Node&lt;K,V&gt;[] initTable() &#123;  </span><br><span class="line">        Node&lt;K,V&gt;[] tab; int sc;  </span><br><span class="line">        while ((tab &#x3D; table) &#x3D;&#x3D; null || tab.length &#x3D;&#x3D; 0) &#123;  </span><br><span class="line">            &#x2F;&#x2F;å¦‚æœå·²ç»æœ‰åˆ«çš„çº¿ç¨‹åœ¨åˆå§‹åŒ–äº†ï¼Œè¿™é‡Œç­‰å¾…ä¸€ä¸‹  </span><br><span class="line">            if ((sc &#x3D; sizeCtl) &lt; 0)  </span><br><span class="line">            Thread.yield(); &#x2F;&#x2F; lost initialization race; just spin  </span><br><span class="line">            &#x2F;&#x2F;-1 è¡¨ç¤ºæ­£åœ¨åˆå§‹åŒ–  </span><br><span class="line">            else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123;  </span><br><span class="line">            ...  </span><br><span class="line">        &#125; finally &#123;  </span><br><span class="line">           sizeCtl &#x3D; sc;  </span><br><span class="line">        &#125;  </span><br><span class="line">           break;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    return tab;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>sizeCtl</code>å‚æ•°ä½œä¸ºæ§åˆ¶æ ‡å¿—çš„ä½œç”¨ï¼Œå½“åœ¨ä»æ’å…¥å…ƒç´ æ—¶ï¼Œæ‰ä¼šåˆå§‹åŒ–Hashè¡¨ã€‚åœ¨å¼€å§‹åˆå§‹åŒ–çš„æ—¶å€™ï¼Œ</p>
<ul>
<li>é¦–å…ˆåˆ¤æ–­<code>sizeCtl</code>çš„å€¼ï¼Œå¦‚æœ<strong>sizeCtl &lt; 0</strong>ï¼Œè¯´æ˜<strong>æœ‰çº¿ç¨‹åœ¨åˆå§‹åŒ–</strong>ï¼Œ<strong>å½“å‰çº¿ç¨‹ä¾¿æ”¾å¼ƒåˆå§‹åŒ–æ“ä½œ</strong>ã€‚å¦åˆ™ï¼Œå°†**<code>SIZECTL</code>è®¾ç½®ä¸º-1<strong>ï¼Œ</strong>Hashè¡¨è¿›è¡Œåˆå§‹åŒ–**ã€‚</li>
<li>åˆå§‹åŒ–æˆåŠŸä»¥åï¼Œå°†<code>sizeCtl</code>çš„å€¼è®¾ç½®ä¸ºå½“å‰çš„å®¹é‡å€¼</li>
</ul>
<ol>
<li>åœ¨ä¸å­˜åœ¨hashå†²çªçš„æ—¶</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">else if ((f &#x3D; tabAt(tab, i &#x3D; (n - 1) &amp; hash)) &#x3D;&#x3D; null) &#123;  </span><br><span class="line">     &#x2F;&#x2F;åˆ©ç”¨CASæ“ä½œå°†å…ƒç´ æ’å…¥åˆ°Hashè¡¨ä¸­  </span><br><span class="line">     if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value)))  </span><br><span class="line">     break;  &#x2F;&#x2F; no lock when adding to empty bin(æ’å…¥nullçš„èŠ‚ç‚¹ï¼Œæ— éœ€åŠ é”)  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><code>(f = tabAt(tab, i = (n - 1) &amp; hash)) == null</code>ä¸­ä½¿ç”¨tabAtåŸå­æ“ä½œè·å–æ•°ç»„ï¼Œå¹¶åˆ©ç”¨<code>casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value))</code>CASæ“ä½œå°†å…ƒç´ æ’å…¥åˆ°Hashè¡¨ä¸­</p>
<ol>
<li>åœ¨å­˜åœ¨hashå†²çªæ—¶ï¼Œå…ˆæŠŠå½“å‰èŠ‚ç‚¹ä½¿ç”¨å…³é”®å­—<code>synchronized</code>åŠ é”ï¼Œç„¶åå†ä½¿ç”¨<code>tabAt()</code>åŸå­æ“ä½œåˆ¤æ–­ä¸‹æœ‰æ²¡æœ‰çº¿ç¨‹å¯¹æ•°ç»„è¿›è¡Œäº†ä¿®æ”¹ï¼Œæœ€åå†è¿›è¡Œå…¶ä»–æ“ä½œã€‚</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆè¦é”ä½æ›´æ–°æ“ä½œçš„ä»£ç å—?</strong></p>
<p>å› ä¸ºå‘ç”Ÿäº†å“ˆå¸Œå†²çªï¼Œå½“å‰çº¿ç¨‹æ­£åœ¨fæ‰€åœ¨çš„é“¾è¡¨ä¸Šè¿›è¡Œæ›´æ–°æ“ä½œï¼Œå‡å¦‚æ­¤æ—¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¹Ÿéœ€è¦åˆ°è¿™ä¸ªé“¾è¡¨ä¸Šè¿›è¡Œæ›´æ–°æ“ä½œï¼Œåˆ™éœ€è¦ç­‰å¾…å½“å‰çº¿ç¨‹æ›´æ–°å®Œåå†æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å½“å‰èŠ‚ç‚¹åŠ é”  </span><br><span class="line">synchronized (f) &#123;  </span><br><span class="line">     &#x2F;&#x2F;è¿™é‡Œåˆ¤æ–­ä¸‹æœ‰æ²¡æœ‰çº¿ç¨‹å¯¹æ•°ç»„è¿›è¡Œäº†ä¿®æ”¹  </span><br><span class="line">     if (tabAt(tab, i) &#x3D;&#x3D; f) &#123;  </span><br><span class="line">     ......&#x2F;&#x2F;do something  </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ConcurrentHashMapçš„getæ–¹æ³•æ˜¯å¦è¦åŠ é”ï¼Œä¸ºä»€ä¹ˆï¼Ÿ"><a href="#ConcurrentHashMapçš„getæ–¹æ³•æ˜¯å¦è¦åŠ é”ï¼Œä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="ConcurrentHashMapçš„getæ–¹æ³•æ˜¯å¦è¦åŠ é”ï¼Œä¸ºä»€ä¹ˆï¼Ÿ"></a>ConcurrentHashMapçš„getæ–¹æ³•æ˜¯å¦è¦åŠ é”ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public V get(Object key) &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek;</span><br><span class="line">        int h &#x3D; spread(key.hashCode());</span><br><span class="line">        &#x2F;&#x2F;æ»¡è¶³æ¡ä»¶ç›´æ¥è¿”å›å¯¹åº”çš„å€¼</span><br><span class="line">        if ((tab &#x3D; table) !&#x3D; null &amp;&amp; (n &#x3D; tab.length) &gt; 0 &amp;&amp;</span><br><span class="line">            (e &#x3D; tabAt(tab, (n - 1) &amp; h)) !&#x3D; null) &#123;</span><br><span class="line">            if ((eh &#x3D; e.hash) &#x3D;&#x3D; h) &#123;</span><br><span class="line">                if ((ek &#x3D; e.key) &#x3D;&#x3D; key || (ek !&#x3D; null &amp;&amp; key.equals(ek)))</span><br><span class="line">                    return e.val;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;e.hash&lt;0ï¼Œæ­£åœ¨æ‰©å®¹</span><br><span class="line">            else if (eh &lt; 0)</span><br><span class="line">                return (p &#x3D; e.find(h, key)) !&#x3D; null ? p.val : null;</span><br><span class="line">            &#x2F;&#x2F;éå†å½“å‰èŠ‚ç‚¹</span><br><span class="line">            while ((e &#x3D; e.next) !&#x3D; null) &#123;</span><br><span class="line">                if (e.hash &#x3D;&#x3D; h &amp;&amp;</span><br><span class="line">                    ((ek &#x3D; e.key) &#x3D;&#x3D; key || (ek !&#x3D; null &amp;&amp; key.equals(ek))))</span><br><span class="line">                    return e.val;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ConcurrentHashMapçš„getæ–¹æ³•å°±æ˜¯ä»Hashè¡¨ä¸­è¯»å–æ•°æ®ï¼Œå¹¶ä¸ä¼šä¸æ‰©å®¹ä¸å†²çªï¼Œå› æ­¤è¯¥æ–¹æ³•ä¹Ÿä¸éœ€è¦åŒæ­¥é”ï¼Œè¿™æ ·å¯æé«˜ConcurrentHashMap çš„å¹¶å‘æ€§èƒ½ã€‚</p>
<h4 id="1-7è™½ç„¶å¯ä»¥æ”¯æŒæ¯ä¸ªSegmentå¹¶å‘è®¿é—®ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Ÿ"><a href="#1-7è™½ç„¶å¯ä»¥æ”¯æŒæ¯ä¸ªSegmentå¹¶å‘è®¿é—®ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Ÿ" class="headerlink" title="1.7è™½ç„¶å¯ä»¥æ”¯æŒæ¯ä¸ªSegmentå¹¶å‘è®¿é—®ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Ÿ"></a>1.7è™½ç„¶å¯ä»¥æ”¯æŒæ¯ä¸ªSegmentå¹¶å‘è®¿é—®ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Ÿ</h4><p>å› ä¸ºåŸºæœ¬ä¸Šè¿˜æ˜¯æ•°ç»„åŠ é“¾è¡¨çš„æ–¹å¼ï¼Œæˆ‘ä»¬å»æŸ¥è¯¢çš„æ—¶å€™ï¼Œè¿˜å¾—éå†é“¾è¡¨ï¼Œä¼šå¯¼è‡´æ•ˆç‡å¾ˆä½ï¼Œè¿™ä¸ªè·Ÿjdk1.7çš„HashMapæ˜¯å­˜åœ¨çš„ä¸€æ ·é—®é¢˜ï¼Œæ‰€ä»¥ä»–åœ¨jdk1.8å®Œå…¨ä¼˜åŒ–äº†ã€‚</p>
<h4 id="æ‰©å®¹-transfer-æ–¹æ³•"><a href="#æ‰©å®¹-transfer-æ–¹æ³•" class="headerlink" title="æ‰©å®¹ transfer æ–¹æ³•"></a>æ‰©å®¹ transfer æ–¹æ³•</h4><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021237438">https://segmentfault.com/a/1190000021237438</a></p>
<h2 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903705599279118#heading-8">https://juejin.cn/post/6844903705599279118#heading-8</a></p>
<p>è¯»å†™åˆ†ç¦»æ€æƒ³ï¼Œå†™æ—¶å¤åˆ¶æ€æƒ³</p>
<p>CopyOnWriteArrayList æ˜¯ä¸€ä¸ªå†™æ—¶å¤åˆ¶çš„å®¹å™¨ï¼Œå½“æˆ‘ä»¬å¾€ä¸€ä¸ªå®¹å™¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¾€å½“å‰å®¹å™¨æ·»åŠ ï¼Œè€Œæ˜¯å…ˆå°†å½“å‰å®¹å™¨è¿›è¡Œ Copyï¼Œå¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œç„¶åå¾€æ–°çš„å®¹å™¨é‡Œæ·»åŠ å…ƒç´ ï¼Œæ·»åŠ å®Œå…ƒç´ ä¹‹åï¼Œå†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°çš„å®¹å™¨ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥å¯¹ CopyOnWriteArrayList è¿›è¡Œå¹¶å‘çš„è¯»ï¼Œè€Œä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºå½“å‰å®¹å™¨ä¸ä¼šæ·»åŠ ä»»ä½•å…ƒç´ ã€‚æ‰€ä»¥ CopyOnWriteArrayList æ˜¯ä¸€ç§è¯»å†™åˆ†ç¦»çš„å®¹å™¨ï¼Œé€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œæ”¯æŒé«˜å¹¶å‘è¯»å–ã€‚</p>
<blockquote>
<p>CopyOnWriteArrayList æ˜¯å¦‚ä½•ä¿è¯å†™æ—¶çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</p>
</blockquote>
<p>ä½¿ç”¨äº† ReentrantLock ç‹¬å é”ï¼Œä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹é›†åˆè¿›è¡Œä¿®æ”¹æ“ä½œã€‚</p>
<blockquote>
<p>å¦‚ä½•ç†è§£ CopyOnWrite æ€æƒ³ï¼Ÿ</p>
</blockquote>
<p>å†™æ—¶å¤åˆ¶ã€‚å°±æ˜¯åœ¨å†™çš„æ—¶å€™ï¼Œæ‹·è´ä¸€ä»½åŸå¯¹è±¡ï¼Œåªæ“ä½œæ‹·è´çš„å¯¹è±¡ï¼Œæ“ä½œå®Œåå†è¦†ç›–åŸå¯¹è±¡ï¼Œä¿è¯ volatile è¯­ä¹‰ã€‚</p>
<blockquote>
<p>CopyOnWriteArrayList åœ¨ä½¿ç”¨è¿­ä»£å™¨æ—¶æ˜¯å¦æœ‰ä»€ä¹ˆæ³¨æ„äº‹é¡¹ï¼Ÿ</p>
</blockquote>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒCopyOnWriteArrayList æ˜¯åº•å±‚ä½¿ç”¨ä¸€ç§å®‰å…¨å¤±è´¥æœºåˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥åœ¨è¿­ä»£æ—¶è¿›è¡Œå¢åˆ æ”¹æ“ä½œã€‚</p>
<p>ä¸è¿‡ï¼Œåœ¨è¿­ä»£å™¨ä½¿ç”¨æ—¶æœ‰ä¸€ä¸ªæ³¨æ„äº‹é¡¹ï¼š<strong>è¿­ä»£å™¨è·å–çš„æ•°æ®å–å†³äºè¿­ä»£å™¨åˆ›å»ºçš„æ—¶å€™ï¼Œè€Œä¸æ˜¯è¿­ä»£å™¨è¿­ä»£çš„æ—¶å€™ã€‚</strong></p>
<p>CopyOnWriteArrayList æ˜¯å®‰å…¨çš„å¹¶å‘å®¹å™¨ï¼Œæœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<ol>
<li>å¯¹æ•°ç»„çš„å†™æ“ä½œåŠ é”ï¼Œè¯»æ“ä½œä¸åŠ é”ï¼›</li>
<li>é€šè¿‡åŠ é” + æ•°ç»„æ‹·è´+ volatile æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›</li>
</ol>
<p><strong>CopyOnWriteArrayListç¼ºç‚¹</strong></p>
<ul>
<li><p>å†…å­˜å ç”¨ï¼šå¦‚æœCopyOnWriteArrayListç»å¸¸è¦å¢åˆ æ”¹é‡Œé¢çš„æ•°æ®ï¼Œç»å¸¸è¦æ‰§è¡Œadd()ã€set()ã€remove()</p>
<p>çš„è¯ï¼Œé‚£æ˜¯æ¯”è¾ƒè€—è´¹å†…å­˜çš„ã€‚</p>
<ul>
<li>å› ä¸ºæˆ‘ä»¬çŸ¥é“æ¯æ¬¡<code>add()ã€set()ã€remove()</code>è¿™äº›å¢åˆ æ”¹æ“ä½œéƒ½è¦<strong>å¤åˆ¶ä¸€ä¸ªæ•°ç»„</strong>å‡ºæ¥ã€‚</li>
</ul>
</li>
<li><p>æ•°æ®ä¸€è‡´æ€§ï¼šCopyOnWriteå®¹å™¨åªèƒ½ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„å®æ—¶ä¸€è‡´æ€§ã€‚</p>
<ul>
<li>ä»ä¸Šé¢çš„ä¾‹å­ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ¯”å¦‚çº¿ç¨‹Aåœ¨è¿­ä»£CopyOnWriteArrayListå®¹å™¨çš„æ•°æ®ã€‚çº¿ç¨‹Båœ¨çº¿ç¨‹Aè¿­ä»£çš„é—´éš™ä¸­å°†CopyOnWriteArrayListéƒ¨åˆ†çš„æ•°æ®ä¿®æ”¹äº†(å·²ç»è°ƒç”¨<code>setArray()</code>äº†)ã€‚ä½†æ˜¯çº¿ç¨‹Aè¿­ä»£å‡ºæ¥çš„æ˜¯åŸæœ‰çš„æ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<h2 id="CopyOnWriteArraySet"><a href="#CopyOnWriteArraySet" class="headerlink" title="CopyOnWriteArraySet"></a>CopyOnWriteArraySet</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> CopyOnWriteArrayList&lt;E&gt; al;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates an empty set.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CopyOnWriteArraySet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    al = <span class="keyword">new</span> CopyOnWriteArrayList&lt;E&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CopyOnWriteArraySetæ˜¯åŸºäºCopyOnWriteArrayListå®ç°çš„ï¼ˆå†æ·»åŠ å…ƒç´ æ˜¯è¿›è¡Œå»é‡æ“ä½œï¼‰ï¼Œå†…éƒ¨å°±æ˜¯è¿™ä¸ªä¸€ä¸ªCopyOnWriteArrayListï¼Œç”šè‡³åœ¨å®ç°çš„æ—¶å€™ç›´æ¥newä¸€ä¸ªå‡ºæ¥ï¼Œå°±æ˜¯è¿™ä¹ˆç›´æ¥ã€‚</p>
<h2 id="ConcurrentSkipListMap"><a href="#ConcurrentSkipListMap" class="headerlink" title="ConcurrentSkipListMap"></a>ConcurrentSkipListMap</h2><ul>
<li>ConcurrentSkipListMapæ˜¯çº¿ç¨‹å®‰å…¨çš„æœ‰åºçš„å“ˆå¸Œè¡¨(ç›¸å½“äºçº¿ç¨‹å®‰å…¨çš„TreeMap); å®ƒç»§æ‰¿äºAbstractMapç±»ï¼Œå¹¶ä¸”å®ç°ConcurrentNavigableMapæ¥å£ã€‚ConcurrentSkipListMapæ˜¯é€šè¿‡â€œè·³è¡¨â€æ¥å®ç°çš„ï¼Œå®ƒæ”¯æŒå¹¶å‘ã€‚</li>
<li>ConcurrentSkipListSetæ˜¯çº¿ç¨‹å®‰å…¨çš„æœ‰åºçš„é›†åˆ(ç›¸å½“äºçº¿ç¨‹å®‰å…¨çš„TreeSet)ï¼›å®ƒç»§æ‰¿äºAbstractSetï¼Œå¹¶å®ç°äº†NavigableSetæ¥å£ã€‚ConcurrentSkipListSetæ˜¯é€šè¿‡ConcurrentSkipListMapå®ç°çš„ï¼Œå®ƒä¹Ÿæ”¯æŒå¹¶å‘ã€‚</li>
</ul>
<p>ConcurrentSkipListMapæ˜¯çº¿ç¨‹å®‰å…¨çš„æœ‰åºçš„å“ˆå¸Œè¡¨ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„åœºæ™¯ã€‚</p>
<p>ConcurrentSkipListMapå’ŒTreeMapï¼Œå®ƒä»¬è™½ç„¶éƒ½æ˜¯æœ‰åºçš„å“ˆå¸Œè¡¨ã€‚ä½†æ˜¯ï¼Œç¬¬ä¸€ï¼Œå®ƒä»¬çš„çº¿ç¨‹å®‰å…¨æœºåˆ¶ä¸åŒï¼ŒTreeMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒConcurrentSkipListMapæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ç¬¬äºŒï¼ŒConcurrentSkipListMapæ˜¯é€šè¿‡è·³è¡¨å®ç°çš„ï¼Œè€ŒTreeMapæ˜¯é€šè¿‡çº¢é»‘æ ‘å®ç°çš„ã€‚</p>
<p>ä½†ConcurrentSkipListMapæœ‰å‡ ä¸ªConcurrentHashMap ä¸èƒ½æ¯”æ‹Ÿçš„ä¼˜ç‚¹ï¼š</p>
<p>1ã€ConcurrentSkipListMap çš„keyæ˜¯æœ‰åºçš„ã€‚</p>
<p>2ã€ConcurrentSkipListMap æ”¯æŒæ›´é«˜çš„å¹¶å‘ã€‚ConcurrentSkipListMap çš„å­˜å–æ—¶é—´æ˜¯logï¼ˆNï¼‰ï¼Œå’Œçº¿ç¨‹æ•°å‡ ä¹æ— å…³ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æ•°æ®é‡ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œå¹¶å‘çš„çº¿ç¨‹è¶Šå¤šï¼ŒConcurrentSkipListMapè¶Šèƒ½ä½“ç°å‡ºä»–çš„ä¼˜åŠ¿ã€‚</p>

  
  
  <div class="footer">
      <script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>
<div id="bsa-native"></div>
<script>
_bsa.init('custom', 'CKYD62QM', 'placement:vuejsorg',
  {
    target: '#bsa-native',
    template: '<a class="native-box" href="##statlink##"><div class="native-sponsor">Sponsor</div><div class="native-text"><strong>##company##</strong> â€” ##description##</div></a>'
  }
);
</script>


    Caught a mistake or want to contribute to the documentation?
    <a href="https://github.com/vuejs/vuejs.org/blob/master/src/data/Java/java_collection.md" rel="noopener" target="_blank">
      Edit this on GitHub!
    </a>
    <!-- Deployed on
    <a href="https://url.netlify.com/HJ8X2mxP8" rel="noopener" target="_blank">
      Netlify
    </a>. -->
  </div>
</div>

      </div>
      <script src="/js/smooth-scroll.min.js"></script>
    

    <!-- main custom script for sidebars, version selects etc. -->
    <script src="/js/css.escape.js"></script>
    <script src="/js/common.js"></script>

    <!-- search -->
    <link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel='stylesheet' type='text/css'>
    
<link rel="stylesheet" href="/css/search.css">

    <script src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script>
    [
      '#search-query-nav',
      '#search-query-sidebar',
      '#search-query-menu'
    ].forEach(function (selector) {
      if (!document.querySelector(selector)) return
      // search index defaults to v2
      var match = window.location.pathname.match(/^\/(v\d+)/)
      var version = match ? match[1] : 'v2'
      docsearch({
      appId: 'BH4D9OD16A',
      apiKey: '85cc3221c9f23bfbaa4e3913dd7625ea',
      indexName: 'vuejs',
      inputSelector: selector,
      algoliaOptions: { facetFilters: ["version:" + version] },
      autocompleteOptions: { hint: false, appendTo: 'body'}
      })
    })
    </script>
  </body>
</html>
