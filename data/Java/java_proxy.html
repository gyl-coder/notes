


<!DOCTYPE html>
<html lang="en" class="with-v3-banner">
  <head>
    <title>Notes</title>
    <meta charset="utf-8">
    <meta name="description" content="Notes - Personal review warehouse">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="alternate" hreflang="x-default" href="https://vuejs.org/data/Java/java_proxy.html">
    <link rel="alternate" hreflang="zh" href="https://cn.vuejs.org/data/Java/java_proxy.html">
    <link rel="alternate" hreflang="ja" href="https://jp.vuejs.org/data/Java/java_proxy.html">
    <link rel="alternate" hreflang="ru" href="https://ru.vuejs.org/data/Java/java_proxy.html">
    <link rel="alternate" hreflang="ko" href="https://kr.vuejs.org/data/Java/java_proxy.html">
    <link rel="alternate" hreflang="pt-BR" href="https://br.vuejs.org/data/Java/java_proxy.html">
    <link rel="alternate" hreflang="fr" href="https://fr.vuejs.org/data/Java/java_proxy.html">
    <link rel="alternate" hreflang="es" href="https://es.vuejs.org/data/Java/java_proxy.html">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Notes">
    <meta property="og:description" content="Notes - Personal review warehouse">
    <meta property="og:image" content="https://vuejs.org//images/logo.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Notes">
    <meta name="twitter:description" content="Notes - Personal review warehouse">
    <meta name="twitter:image" content="https://vuejs.org/images/logo.png">

    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png">
    <meta name="msapplication-TileImage" content="/images/icons/ms-icon-144x144.png">
    <link rel="icon" href="/images/logo.png" type="image/png">

    <meta name="msapplication-TileColor" content="#4fc08d">
    <meta name="theme-color" content="#4fc08d">

    <meta name="msapplication-config" content="browserconfig.xml">
    <link rel="manifest" href="/manifest.json">

    <link href="https://fonts.googleapis.com" rel="preconnect" crossorigin>
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    <link href="https://maxcdn.bootstrapcdn.com" rel="preconnect" crossorigin>

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Dosis:500&text=Vue.js&display=swap" rel="stylesheet">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- main page styles -->
    
<link rel="stylesheet" href="/css/page.css">


    <!-- this needs to be loaded before guide's inline scripts -->
    <script src="/js/vue.js"></script>

    

    <script>
      Vue.config.productionTip = false
      window.PAGE_TYPE = ""
    </script>

    <!-- ga -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46852172-1', 'vuejs.org');
      ga('send', 'pageview');
    </script>

    <!-- vimeo analytics -->
    <script type="text/javascript" defer="defer" src="https://extend.vimeocdn.com/ga/72160148.js"></script>
  <meta name="generator" content="Hexo 5.4.0"></head>
  <body class="docs">
    <div id="mobile-bar" >
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>
    <div>
  <div id="v3-banner">
    <span class="hidden-sm">Welcome to yanliang's notes</span>
  </div>

  <header id="header">
    <a id="logo" href="/">
      <img src="/images/logo.png" alt="vue logo">
      <span>Notes - personal review warehouse</span>
    </a>
    <ul id="nav">
      <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input" aria-label="Search">
  </form>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">â­ï¸Java</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Documentation</h4></li>
    <li>
      <ul>
        <li><a href="/java/oop/" class="nav-link">OOP</a></li>
        <li><a href="/v2/api" class="nav-link">API</a></li>
        <li><a href="/v2/style-guide" class="nav-link">Style Guide</a></li>
        <li><a href="/v2/examples" class="nav-link">Examples</a></li>
        <li><a href="/v2/cookbook" class="nav-link">Cookbook</a></li>
      </ul>
    </li>
    <li><h4>Video Courses</h4></li>
    <li>
      <ul>
        <li>
          <a href="https://www.vuemastery.com/courses/" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue Mastery
          </a>
        </li>
        <li>
          <a
            href="https://vueschool.io/?friend=vuejs&utm_source=Vuejs.org&utm_medium=Link&utm_content=Navbar%20Dropdown"
            class="nav-link"
            target="_blank" rel="sponsored noopener"
          >
            Vue School
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container learn">
  <a class="nav-link">ç½‘ç»œ</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <!-- <li><h4>Documentation</h4></li> -->
    <li>
      <ul>
        <li><a href="/network">Review List</a></li>
        <li><a href="/network/tcp/">ğŸ”¥TCP</a></li>
        <li><a href="/network/http/">HTTP</a></li>
        <li><a href="/network/ip/">IP</a></li>
      </ul>
    </li>
    <li><h4>Video Courses</h4></li>
    <li>
      <ul>
        <li>
          <a href="https://www.vuemastery.com/courses/" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue Mastery
          </a>
        </li>
        <li>
          <a
            href="https://vueschool.io/?friend=vuejs&utm_source=Vuejs.org&utm_medium=Link&utm_content=Navbar%20Dropdown"
            class="nav-link"
            target="_blank" rel="sponsored noopener"
          >
            Vue School
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/os/">æ“ä½œç³»ç»Ÿ</a>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">æ•°æ®åº“</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <!-- <li><h4>Documentation</h4></li> -->
    <li>
      <ul>
        <li><a href="/mysql">Review List</a></li>
        <li><a href="/mysql/mysql-index">ç´¢å¼•ç›¸å…³</a></li>
        <li><a href="/mysql/mysql-index-operation">ç´¢å¼•æ“ä½œç›¸å…³</a></li>
        <li><a href="/mysql/mysql-lock">é”ç›¸å…³</a></li>
        <li><a href="/mysql/mysql-logs">æ—¥å¿—ç›¸å…³</a></li>
        <li><a href="/mysql/mysql-mvcc">MVCC</a></li>
        <li><a href="/mysql/mysql-trans">äº‹åŠ¡ç›¸å…³</a></li>
        <li><a href="/mysql/other">å…¶ä»–</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/algo/">ç®—æ³•</a>
</li>
<li class="nav-dropdown-container resources">
  <a href="#" class="nav-link">Resources</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/resources/partners.html" class="nav-link">Partners</a></li>
    <li><a href="/resources/themes.html" class="nav-link">Themes</a></li>
    <li><a href="https://github.com/vuejs/awesome-vue" class="nav-link" target="_blank" rel="noopener">Awesome Vue</a></li>
    <li><a href="https://awesomejs.dev/for/vue/" class="nav-link" target="_blank" rel="noopener">Browse packages for Vue</a></li>
  </ul>
</li>

<!-- <li>
  <a href="/partners" class="nav-link ">Partners</a>
</li> -->
<li class="nav-dropdown-container support-vue">
  <a href="/support-vuejs/" class="nav-link">Support Vue</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/support-vuejs/#One-time-Donations" class="nav-link">One-time Donations</a></li>
    <li><a href="/support-vuejs/#Recurring-Pledges" class="nav-link">Recurring Pledges</a></li>
    <li><a href="https://vue.threadless.com" target="_blank" rel="noopener" class="nav-link">T-Shirt Shop</a></li>
  </ul>
</li>

<li class="nav-dropdown-container language">
  <a class="nav-link">Translations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a target="_blank" rel="noopener" href="https://cn.vuejs.org/data/Java/java_proxy.html" class="nav-link">ä¸­æ–‡</a></li>
    <li><a target="_blank" rel="noopener" href="https://jp.vuejs.org/data/Java/java_proxy.html" class="nav-link">æ—¥æœ¬èª</a></li>
    <li><a target="_blank" rel="noopener" href="https://ru.vuejs.org/data/Java/java_proxy.html" class="nav-link">Ğ ÑƒÑÑĞºĞ¸Ğ¹</a></li>
    <li><a target="_blank" rel="noopener" href="https://kr.vuejs.org/data/Java/java_proxy.html" class="nav-link">í•œêµ­ì–´</a></li>
    <li><a target="_blank" rel="noopener" href="https://br.vuejs.org/data/Java/java_proxy.html" class="nav-link">PortuguÃªs</a></li>
    <li><a target="_blank" rel="noopener" href="https://fr.vuejs.org/data/Java/java_proxy.html" class="nav-link">FranÃ§ais</a></li>
    <li><a target="_blank" rel="noopener" href="https://vi.vuejs.org/data/Java/java_proxy.html" class="nav-link">Tiáº¿ng Viá»‡t</a></li>
    <li><a target="_blank" rel="noopener" href="https://es.vuejs.org/data/Java/java_proxy.html" class="nav-link">EspaÃ±ol</a></li>
    <li><a target="_blank" rel="noopener" href="https://docs.vuejs.id/data/Java/java_proxy.html" class="nav-link">Bahasa Indonesia</a></li>
  </ul>
</li>


    </ul>
  </header>
</div>

    
      <div id="main" class="fix-sidebar">
        
  <div class="sidebar">
    <ul class="main-menu">
      <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input" aria-label="Search">
  </form>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">â­ï¸Java</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Documentation</h4></li>
    <li>
      <ul>
        <li><a href="/java/oop/" class="nav-link">OOP</a></li>
        <li><a href="/v2/api" class="nav-link">API</a></li>
        <li><a href="/v2/style-guide" class="nav-link">Style Guide</a></li>
        <li><a href="/v2/examples" class="nav-link">Examples</a></li>
        <li><a href="/v2/cookbook" class="nav-link">Cookbook</a></li>
      </ul>
    </li>
    <li><h4>Video Courses</h4></li>
    <li>
      <ul>
        <li>
          <a href="https://www.vuemastery.com/courses/" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue Mastery
          </a>
        </li>
        <li>
          <a
            href="https://vueschool.io/?friend=vuejs&utm_source=Vuejs.org&utm_medium=Link&utm_content=Navbar%20Dropdown"
            class="nav-link"
            target="_blank" rel="sponsored noopener"
          >
            Vue School
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container learn">
  <a class="nav-link">ç½‘ç»œ</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <!-- <li><h4>Documentation</h4></li> -->
    <li>
      <ul>
        <li><a href="/network">Review List</a></li>
        <li><a href="/network/tcp/">ğŸ”¥TCP</a></li>
        <li><a href="/network/http/">HTTP</a></li>
        <li><a href="/network/ip/">IP</a></li>
      </ul>
    </li>
    <li><h4>Video Courses</h4></li>
    <li>
      <ul>
        <li>
          <a href="https://www.vuemastery.com/courses/" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue Mastery
          </a>
        </li>
        <li>
          <a
            href="https://vueschool.io/?friend=vuejs&utm_source=Vuejs.org&utm_medium=Link&utm_content=Navbar%20Dropdown"
            class="nav-link"
            target="_blank" rel="sponsored noopener"
          >
            Vue School
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/os/">æ“ä½œç³»ç»Ÿ</a>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">æ•°æ®åº“</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <!-- <li><h4>Documentation</h4></li> -->
    <li>
      <ul>
        <li><a href="/mysql">Review List</a></li>
        <li><a href="/mysql/mysql-index">ç´¢å¼•ç›¸å…³</a></li>
        <li><a href="/mysql/mysql-index-operation">ç´¢å¼•æ“ä½œç›¸å…³</a></li>
        <li><a href="/mysql/mysql-lock">é”ç›¸å…³</a></li>
        <li><a href="/mysql/mysql-logs">æ—¥å¿—ç›¸å…³</a></li>
        <li><a href="/mysql/mysql-mvcc">MVCC</a></li>
        <li><a href="/mysql/mysql-trans">äº‹åŠ¡ç›¸å…³</a></li>
        <li><a href="/mysql/other">å…¶ä»–</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/algo/">ç®—æ³•</a>
</li>
<li class="nav-dropdown-container resources">
  <a href="#" class="nav-link">Resources</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/resources/partners.html" class="nav-link">Partners</a></li>
    <li><a href="/resources/themes.html" class="nav-link">Themes</a></li>
    <li><a href="https://github.com/vuejs/awesome-vue" class="nav-link" target="_blank" rel="noopener">Awesome Vue</a></li>
    <li><a href="https://awesomejs.dev/for/vue/" class="nav-link" target="_blank" rel="noopener">Browse packages for Vue</a></li>
  </ul>
</li>

<!-- <li>
  <a href="/partners" class="nav-link ">Partners</a>
</li> -->
<li class="nav-dropdown-container support-vue">
  <a href="/support-vuejs/" class="nav-link">Support Vue</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/support-vuejs/#One-time-Donations" class="nav-link">One-time Donations</a></li>
    <li><a href="/support-vuejs/#Recurring-Pledges" class="nav-link">Recurring Pledges</a></li>
    <li><a href="https://vue.threadless.com" target="_blank" rel="noopener" class="nav-link">T-Shirt Shop</a></li>
  </ul>
</li>

<li class="nav-dropdown-container language">
  <a class="nav-link">Translations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a target="_blank" rel="noopener" href="https://cn.vuejs.org/data/Java/java_proxy.html" class="nav-link">ä¸­æ–‡</a></li>
    <li><a target="_blank" rel="noopener" href="https://jp.vuejs.org/data/Java/java_proxy.html" class="nav-link">æ—¥æœ¬èª</a></li>
    <li><a target="_blank" rel="noopener" href="https://ru.vuejs.org/data/Java/java_proxy.html" class="nav-link">Ğ ÑƒÑÑĞºĞ¸Ğ¹</a></li>
    <li><a target="_blank" rel="noopener" href="https://kr.vuejs.org/data/Java/java_proxy.html" class="nav-link">í•œêµ­ì–´</a></li>
    <li><a target="_blank" rel="noopener" href="https://br.vuejs.org/data/Java/java_proxy.html" class="nav-link">PortuguÃªs</a></li>
    <li><a target="_blank" rel="noopener" href="https://fr.vuejs.org/data/Java/java_proxy.html" class="nav-link">FranÃ§ais</a></li>
    <li><a target="_blank" rel="noopener" href="https://vi.vuejs.org/data/Java/java_proxy.html" class="nav-link">Tiáº¿ng Viá»‡t</a></li>
    <li><a target="_blank" rel="noopener" href="https://es.vuejs.org/data/Java/java_proxy.html" class="nav-link">EspaÃ±ol</a></li>
    <li><a target="_blank" rel="noopener" href="https://docs.vuejs.id/data/Java/java_proxy.html" class="nav-link">Bahasa Indonesia</a></li>
  </ul>
</li>


    </ul>
  </div>

<div class="content  ">
  <p class="tip warning v3-warning">
    Welcome to yanliang's notes.
  </p>

  
  
  
    <h2 id="Java-ä»£ç†"><a href="#Java-ä»£ç†" class="headerlink" title="Java ä»£ç†"></a>Java ä»£ç†</h2><p>ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„ç†è§£çš„è®¾è®¡æ¨¡å¼ã€‚ç®€å•æ¥è¯´å°±æ˜¯ <strong>æˆ‘ä»¬ä½¿ç”¨ä»£ç†å¯¹è±¡æ¥ä»£æ›¿å¯¹çœŸå®å¯¹è±¡(real object)çš„è®¿é—®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸç›®æ ‡å¯¹è±¡çš„å‰æä¸‹ï¼Œæä¾›é¢å¤–çš„åŠŸèƒ½æ“ä½œï¼Œæ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ã€‚</strong></p>
<p>ç”Ÿæ´»ä¸­çš„ä»£è´­ã€ç§Ÿæˆ¿ä¸­ä»‹ã€å”®ç¥¨é»„ç‰›ã€å©šä»‹ã€ç»çºªäººã€å¿«é€’ã€äº‹åŠ¡ä»£ç†ã€éä¾µå…¥å¼æ—¥å¿—ç›‘å¬ç­‰ï¼Œéƒ½æ˜¯ä»£ç† æ¨¡å¼çš„å®é™…ä½“ç°ã€‚ä½¿ç”¨ä»£ç†æ¨¡å¼ä¸»è¦æœ‰ä¸¤ä¸ªç›®çš„ï¼šä¸€æ˜¯ä¿æŠ¤ç›®æ ‡å¯¹è±¡ï¼ŒäºŒæ˜¯å¢å¼ºç›®æ ‡å¯¹è±¡ï¼ˆæ¯”å¦‚è¯´åœ¨ç›®æ ‡å¯¹è±¡çš„æŸä¸ªæ–¹æ³•æ‰§è¡Œå‰åä½ å¯ä»¥å¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ï¼‰ã€‚</p>
<p>ä»£ç†æ¨¡å¼ä¸€èˆ¬åŒ…å«ä¸‰ç§è§’è‰²ï¼š</p>
<ul>
<li><p><strong>æŠ½è±¡ä¸»é¢˜è§’è‰²ï¼ˆSubjectï¼‰</strong>ï¼šæŠ½è±¡ä¸»é¢˜ç±»çš„ä¸»è¦èŒè´£æ˜¯å£°æ˜çœŸå®ä¸»é¢˜ä¸ä»£ç†çš„å…±åŒæ¥å£æ–¹æ³•ï¼Œè¯¥ç±»å¯ä»¥æ˜¯æ¥å£ä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»ï¼›</p>
</li>
<li><p><strong>çœŸå®ä¸»é¢˜è§’è‰²ï¼ˆRealSubjectï¼‰</strong>ï¼šè¯¥ç±»ä¹Ÿè¢«ç§°ä¸ºè¢«ä»£ç†ç±»ï¼Œè¯¥ç±»å®šä¹‰äº†ä»£ç†æ‰€è¡¨ç¤ºçš„çœŸå®å¯¹è±¡ï¼Œæ˜¯è´Ÿè´£æ‰§è¡Œç³»ç»ŸçœŸæ­£çš„é€»è¾‘ä¸šåŠ¡å¯¹è±¡ï¼›</p>
</li>
<li><p><strong>ä»£ç†ä¸»é¢˜è§’è‰²ï¼ˆProxyï¼‰</strong>ï¼šä¹Ÿè¢«ç§°ä¸ºä»£ç†ç±»ï¼Œå…¶å†…éƒ¨æŒæœ‰ RealSubject çš„å¼•ç”¨ï¼Œå› æ­¤å…·å¤‡å®Œå…¨çš„å¯¹ RealSubjectçš„ä»£ç†æƒã€‚å®¢æˆ·ç«¯è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿè°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œä½†æ˜¯ä¼šåœ¨ä»£ç†å¯¹ è±¡å‰åå¢åŠ ä¸€äº›å¤„ç†ä»£ç ã€‚</p>
</li>
</ul>
<p>åœ¨ä»£ç ä¸­ï¼Œä¸€èˆ¬ä»£ç†ä¼šè¢«ç†è§£ä¸º<strong>ä»£ç å¢å¼º</strong>ï¼Œå®é™…ä¸Šå°±æ˜¯<strong>åœ¨åŸä»£ç é€»è¾‘å‰åå¢åŠ ä¸€äº›ä»£ç é€»è¾‘</strong>ï¼Œè€Œ<strong>ä½¿è°ƒç”¨è€…æ— æ„ŸçŸ¥</strong>ã€‚<strong>ä»£ç†æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼</strong>ï¼Œåˆ†ä¸º<strong>é™æ€ä»£ç†</strong>å’Œ<strong>åŠ¨æ€ä»£ç†</strong>ã€‚</p>
<h3 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a><strong>é™æ€ä»£ç†</strong></h3><p>é™æ€ä»£ç†éœ€è¦ä¸ºæ¯ä¸ªè¢«ä»£ç†çš„å¯¹è±¡æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼›è€ŒåŠ¨æ€ä»£ç†åˆ™æ—¶åœ¨è¿è¡Œæ—¶é€šè¿‡æŸç§æœºåˆ¶æ¥åŠ¨æ€ç”Ÿæˆï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºä»£ç†ç±»ã€‚</p>
<h3 id="åŠ¨æ€ä»£ç†-jdk"><a href="#åŠ¨æ€ä»£ç†-jdk" class="headerlink" title="åŠ¨æ€ä»£ç† - jdk"></a><strong>åŠ¨æ€ä»£ç† - jdk</strong></h3><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903951976890381#heading-0">https://juejin.cn/post/6844903951976890381#heading-0</a></p>
<p>jdkåŠ¨æ€ä»£ç†æ¨¡å¼æ˜¯åˆ©ç”¨javaä¸­çš„<strong>åå°„æŠ€æœ¯ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä»£ç†ç±»</strong>ã€‚</p>
<p>åŸºäºåŠ¨æ€jdkæ¶‰åŠåˆ°<strong>ä¸¤ä¸ªæ ¸å¿ƒçš„ç±»Proxyç±»å’Œä¸€ä¸ª InvocationHandleræ¥å£ã€‚</strong></p>
<p>JDKçš„åŠ¨æ€ä»£ç†çš„å†™æ³•æ¯”è¾ƒå›ºå®šï¼Œéœ€è¦å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£å’Œæ¥å£çš„å®ç°ç±»ï¼Œç„¶åå†å®šä¹‰ä¸€ä¸ªå®ç°äº†InvocationHandleræ¥å£çš„å®ç°ç±»ã€‚ç„¶åè°ƒç”¨Proxyç±»çš„newInstance()æ–¹æ³•å³å¯ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ï¼šUserServiceï¼Œæ¥å£ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">query</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†å®šä¹‰ä¸€ä¸ªUserServiceæ¥å£çš„å®ç°ç±»ï¼šUserServiceImpl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;insert&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;query&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†å®šä¹‰ä¸€ä¸ªInvocationHandleræ¥å£çš„å®ç°ç±»ï¼šUserServiceInvocationHandlerã€‚åœ¨è‡ªå®šä¹‰çš„InvocationHandlerä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªå±æ€§ï¼štargetï¼Œå®šä¹‰è¿™ä¸ªå±æ€§çš„ç›®çš„æ˜¯ä¸ºäº†åœ¨InvocationHandlerä¸­æŒæœ‰å¯¹ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œtargetå±æ€§çš„åˆå§‹åŒ–æ˜¯åœ¨æ„é€ å™¨ä¸­è¿›è¡Œåˆå§‹åŒ–çš„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceInvocationHandler</span><span class="params">(Object target)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;invocation handler&quot;</span>);</span><br><span class="line">        <span class="comment">// é€šè¿‡åå°„è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> method.invoke(target,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡Proxy.newProxyInstance()æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æŒ‡æ˜ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œè¦æ“ä½œclassæ–‡ä»¶ï¼Œæ€ä¹ˆå°‘å¾—äº†ç±»åŠ è½½å™¨å‘¢</span></span><br><span class="line">        ClassLoader classLoader = MainApplication.class.getClassLoader();</span><br><span class="line">        <span class="comment">// ä¸ºä»£ç†å¯¹è±¡æŒ‡å®šè¦æ˜¯å®ç°å“ªäº›æ¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬è¦ä¸ºUserServiceImplè¿™ä¸ªç›®æ ‡å¯¹è±¡åˆ›å»ºåŠ¨æ€ä»£ç†ï¼Œæ‰€ä»¥éœ€è¦ä¸ºä»£ç†å¯¹è±¡æŒ‡å®šå®ç°UserServiceæ¥å£</span></span><br><span class="line">        Class[] classes = <span class="keyword">new</span> Class[]&#123;UserService.class&#125;;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªInvocationHandlerï¼Œå¹¶åˆå§‹åŒ–InvocationHandlerä¸­çš„ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">        InvocationHandler invocationHandler = <span class="keyword">new</span> UserServiceInvocationHandler(<span class="keyword">new</span> UserServiceImpl());</span><br><span class="line">        <span class="comment">// åˆ›å»ºåŠ¨æ€ä»£ç†</span></span><br><span class="line">        UserService userService = (UserService) Proxy.newProxyInstance(classLoader, classes, invocationHandler);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œé€šè¿‡è§‚å¯Ÿæ§åˆ¶å°çš„ç»“æœï¼Œåˆ¤æ–­æˆ‘ä»¬æ˜¯å¦å¯¹ç›®æ ‡å¯¹è±¡(UserServiceImpl)çš„æ–¹æ³•è¿›è¡Œäº†å¢å¼º</span></span><br><span class="line">        userService.insert();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ï¼Œä»æ‰“å°ç»“æœæ¥çœ‹ï¼Œå·²ç»å®Œæˆäº†å¯¹ç›®æ ‡å¯¹è±¡UserServiceImplçš„ä»£ç†ï¼ˆå¢å¼ºï¼‰ã€‚</span></span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line"></span><br><span class="line">invocation handler</span><br><span class="line">insert</span><br></pre></td></tr></table></figure>

<p>jdkå®ç°åŠ¨æ€ä»£ç†å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>å…ˆæ£€æŸ¥å§”æ‰˜ç±»æ˜¯å¦å®ç°äº†ç›¸åº”æ¥å£ï¼Œä¿è¯è¢«è®¿é—®æ–¹æ³•åœ¨æ¥å£ä¸­ä¹Ÿè¦æœ‰å®šä¹‰</li>
<li>åˆ›å»ºä¸€ä¸ªå®ç°InvocationHandleræ¥å£çš„ç±»</li>
<li>åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„æˆå‘˜å±æ€§ï¼Œä¸ºäº†æ‰©å±•æ–¹ä¾¿å¯ä»¥ç›´æ¥ä½¿ç”¨Objectç±»ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚å®šä¹‰ç›¸åº”çš„æ¥å£</li>
<li>åœ¨invokeæ–¹æ³•ä¸­å®ç°å¯¹å§”æ‰˜å¯¹è±¡çš„è°ƒç”¨ï¼Œæ ¹æ®éœ€æ±‚å¯¹æ–¹æ³•è¿›è¡Œå¢å¼º</li>
<li>ä½¿ç”¨Proxy.newProxyInstance(â€¦)æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¹¶æä¾›è¦ç»™è·å–ä»£ç†å¯¹è±¡çš„æ–¹æ³•</li>
</ol>
<p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€äº›æ‰‹æ®µï¼Œæ¥çœ‹ä¸‹jdkåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»é•¿ä»€ä¹ˆæ ·å­ã€‚</p>
<p><strong>æ‰‹æ®µä¸€ï¼š</strong></p>
<p>è‡ªå®šä¹‰çš„ä¸€ä¸ªå°å·¥å…·ç±»å°†åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¿å­˜åˆ°æœ¬åœ°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†ç”Ÿæˆçš„ä»£ç†ç±»ä¿å­˜ä¸º.classæ–‡ä»¶çš„å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä»£ç†ç±»ä¿å­˜åˆ°æŒ‡å®šè·¯å¾„</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path           ä¿å­˜åˆ°çš„è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxyClassName ä»£ç†ç±»çš„Classåç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> interfaces     ä»£ç†ç±»æ¥å£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">saveProxyClass</span><span class="params">(String path, String proxyClassName, Class[] interfaces)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (proxyClassName == <span class="keyword">null</span> || path == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å–æ–‡ä»¶å­—èŠ‚ç ï¼Œç„¶åè¾“å‡ºåˆ°ç›®æ ‡æ–‡ä»¶ä¸­</span></span><br><span class="line">        <span class="keyword">byte</span>[] classFile = ProxyGenerator.generateProxyClass(proxyClassName, interfaces);</span><br><span class="line">        <span class="keyword">try</span> (FileOutputStream out = <span class="keyword">new</span> FileOutputStream(path)) &#123;</span><br><span class="line">            out.write(classFile);</span><br><span class="line">            out.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ‰‹æ®µäºŒï¼š</strong></p>
<p>åœ¨ä»£ç ä¸­æ·»åŠ ä¸€è¡Œä»£ç ï¼š<code>System.getProperties().put(&quot;sun.misc.ProxyGenerator.saveGeneratedFiles&quot;, &quot;true&quot;)</code>ï¼Œå°±èƒ½å®ç°å°†ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„åŠ¨æ€ä»£ç†å¯¹è±¡çš„classæ–‡ä»¶å†™å…¥åˆ°ç£ç›˜ã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š</p>
<ul>
<li>è¿è¡Œç¨‹åºï¼Œæœ€ç»ˆå‘ç°åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹å‡ºç°äº†ä¸€ä¸ªåŒ…ï¼šcom.sun.proxyã€‚åŒ…ä¸‹æœ‰ä¸€ä¸ªæ–‡ä»¶<code>$Proxy0.class</code>ã€‚åœ¨ideaæ‰“å¼€ï¼Œå‘ç°å°±æ˜¯æ‰€äº§ç”Ÿä»£ç†ç±»çš„æºä»£ç ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è®©ä»£ç†å¯¹è±¡çš„classæ–‡ä»¶å†™å…¥åˆ°ç£ç›˜</span></span><br><span class="line">        System.getProperties().put(<span class="string">&quot;sun.misc.ProxyGenerator.saveGeneratedFiles&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        <span class="comment">// æŒ‡æ˜ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œè¦æ“ä½œclassæ–‡ä»¶ï¼Œæ€ä¹ˆå°‘å¾—äº†ç±»åŠ è½½å™¨å‘¢</span></span><br><span class="line">        ClassLoader classLoader = MainApplication.class.getClassLoader();</span><br><span class="line">        <span class="comment">// ä¸ºä»£ç†å¯¹è±¡æŒ‡å®šè¦æ˜¯å®ç°å“ªäº›æ¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬è¦ä¸ºUserServiceImplè¿™ä¸ªç›®æ ‡å¯¹è±¡åˆ›å»ºåŠ¨æ€ä»£ç†ï¼Œæ‰€ä»¥éœ€è¦ä¸ºä»£ç†å¯¹è±¡æŒ‡å®šå®ç°UserServiceæ¥å£</span></span><br><span class="line">        Class[] classes = <span class="keyword">new</span> Class[]&#123;UserService.class&#125;;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªInvocationHandlerï¼Œå¹¶åˆå§‹åŒ–InvocationHandlerä¸­çš„ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">        InvocationHandler invocationHandler = <span class="keyword">new</span> UserServiceInvocationHandler(<span class="keyword">new</span> UserServiceImpl());</span><br><span class="line">        <span class="comment">// åˆ›å»ºåŠ¨æ€ä»£ç†</span></span><br><span class="line">        UserService userService = (UserService) Proxy.newProxyInstance(classLoader, classes, invocationHandler);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œé€šè¿‡è§‚å¯Ÿæ§åˆ¶å°çš„ç»“æœï¼Œåˆ¤æ–­æˆ‘ä»¬æ˜¯å¦å¯¹ç›®æ ‡å¯¹è±¡(UserServiceImpl)çš„æ–¹æ³•è¿›è¡Œäº†å¢å¼º</span></span><br><span class="line">        userService.insert();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢ä¸¤ç§æ–¹æ³•è·å–åˆ°ä»£ç†å¯¹è±¡çš„æºä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sun.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tiantang.study.UserService;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.UndeclaredThrowableException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> $<span class="title">Proxy0</span> <span class="keyword">extends</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m1;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m3;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m4;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m2;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m0;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $Proxy0(InvocationHandler var1) <span class="keyword">throws</span>  &#123;</span><br><span class="line">        <span class="keyword">super</span>(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Boolean)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m1, <span class="keyword">new</span> Object[]&#123;var1&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var3;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var4);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m3, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">query</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m4, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m2, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m0, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            m1 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;equals&quot;</span>, Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>));</span><br><span class="line">            m3 = Class.forName(<span class="string">&quot;com.tiantang.study.UserService&quot;</span>).getMethod(<span class="string">&quot;insert&quot;</span>);</span><br><span class="line">            m4 = Class.forName(<span class="string">&quot;com.tiantang.study.UserService&quot;</span>).getMethod(<span class="string">&quot;query&quot;</span>);</span><br><span class="line">            m2 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;toString&quot;</span>);</span><br><span class="line">            m0 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodError(var2.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoClassDefFoundError(var3.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æºç æˆ‘ä»¬å‘ç°ï¼Œ<code>$Proxy0</code>ç±»ç»§æ‰¿äº†Proxyç±»ï¼ŒåŒæ—¶å®ç°äº†UserServiceæ¥å£ã€‚åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„é—®é¢˜ä¸€å°±èƒ½è§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆJDKçš„åŠ¨æ€ä»£ç†åªèƒ½åŸºäºæ¥å£å®ç°ï¼Œä¸èƒ½åŸºäºç»§æ‰¿æ¥å®ç°ï¼Ÿ</p>
<p><strong>å› ä¸ºJavaä¸­ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œè€ŒJDKçš„åŠ¨æ€ä»£ç†åœ¨åˆ›å»ºä»£ç†å¯¹è±¡æ—¶ï¼Œé»˜è®¤è®©ä»£ç†å¯¹è±¡ç»§æ‰¿äº†Proxyç±»ï¼Œæ‰€ä»¥JDKåªèƒ½é€šè¿‡æ¥å£å»å®ç°åŠ¨æ€ä»£ç†ã€‚</strong></p>
<p><code>$Proxy0</code>å®ç°äº†UserServiceæ¥å£ï¼Œæ‰€ä»¥é‡å†™äº†æ¥å£ä¸­çš„ä¸¤ä¸ªæ–¹æ³•ï¼ˆ<code>$Proxy0</code>åŒæ—¶è¿˜é‡å†™äº†Objectç±»ä¸­çš„å‡ ä¸ªæ–¹æ³•ï¼‰ã€‚æ‰€ä»¥å½“æˆ‘ä»¬è°ƒç”¨query()æ–¹æ³•æ—¶ï¼Œå…ˆæ˜¯è°ƒç”¨åˆ°<code>$Proxy0.query()</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œç›´æ¥è°ƒç”¨äº†super.h.invoke()æ–¹æ³•ï¼Œçˆ¶ç±»æ˜¯Proxyï¼Œçˆ¶ç±»ä¸­çš„<code>h</code>å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„InvocationHandlerï¼Œæ‰€ä»¥è¿™å„¿ä¼šè°ƒç”¨åˆ°UserServiceInvocationHandler.invoke()æ–¹æ³•ã€‚å› æ­¤å½“æˆ‘ä»¬é€šè¿‡ä»£ç†å¯¹è±¡å»æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä¼šå…ˆç»è¿‡InvocationHandlerçš„invoke()æ–¹æ³•ï¼Œç„¶ååœ¨é€šè¿‡åå°„method.invoke()å»è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ï¼Œå› æ­¤æ¯æ¬¡éƒ½ä¼šå…ˆæ‰“å°<code>invocation handler</code>è¿™å¥è¯ã€‚</p>
<h3 id="CGLIB-åŠ¨æ€ä»£ç†"><a href="#CGLIB-åŠ¨æ€ä»£ç†" class="headerlink" title="CGLIB åŠ¨æ€ä»£ç†"></a>CGLIB åŠ¨æ€ä»£ç†</h3><p>cglibåŠ¨æ€ä»£ç†å’ŒjdkåŠ¨æ€ä»£ç†ç±»ä¼¼ï¼Œä¹Ÿæ˜¯é‡‡ç”¨<strong>æ“ä½œå­—èŠ‚ç æœºåˆ¶</strong>ï¼Œåœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç†ç±»ã€‚cglib åŠ¨æ€ä»£ç†é‡‡å–çš„æ˜¯<strong>åˆ›å»ºç›®æ ‡ç±»çš„å­ç±»çš„æ–¹å¼</strong>ï¼Œå› ä¸ºæ˜¯å­ç±»åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥è¾¾åˆ°è¿‘ä¼¼ä½¿ç”¨è¢«è°ƒç”¨è€…æœ¬èº«çš„æ•ˆæœã€‚</p>
<p>å­—èŠ‚ç å¤„ç†æœºåˆ¶-æŒ‡å¾—æ˜¯ASMæ¥è½¬æ¢å­—èŠ‚ç å¹¶ç”Ÿæˆæ–°çš„ç±»</p>
<p>æ³¨ï¼šspringä¸­æœ‰å®Œæ•´çš„cglibç›¸å…³çš„ä¾èµ–ï¼Œæ‰€ä»¥ä»¥ä¸‹ä»£ç åŸºäºspringå®˜æ–¹ä¸‹è½½çš„demoä¸­ç›´æ¥è¿›è¡Œç¼–å†™çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. è®¢å•æœåŠ¡-å§”æ‰˜ç±»ï¼Œä¸éœ€è¦å†å®ç°æ¥å£</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜è®¢å•æ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrder</span><span class="params">(String orderInfo)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// éšæœºä¼‘çœ ï¼Œæ¨¡æ‹Ÿè®¢å•ä¿å­˜éœ€è¦çš„æ—¶é—´</span></span><br><span class="line">        Thread.sleep(System.currentTimeMillis() &amp; <span class="number">100</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;è®¢å•ï¼š&quot;</span> + orderInfo + <span class="string">&quot;  ä¿å­˜æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * cglibåŠ¨æ€ä»£ç†å·¥å‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> cruder</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-11-23 18:36</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyFactory</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å§”æ‰˜å¯¹è±¡ï¼Œ å³è¢«ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProxyFactory</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getProxyInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºä¸€ä¸ªå·¥å…·ç±»</span></span><br><span class="line">        Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">        <span class="comment">// 2. è®¾ç½®çˆ¶ç±»</span></span><br><span class="line">        enhancer.setSuperclass(target.getClass());</span><br><span class="line">        <span class="comment">// 3. è®¾ç½®å›è°ƒå‡½æ•°</span></span><br><span class="line">        enhancer.setCallback(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// 4.åˆ›å»ºå­ç±»å¯¹è±¡ï¼Œå³ä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        Object result = method.invoke(target, args);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;cglibä»£ç†ï¼šä¿å­˜è®¢å•ç”¨æ—¶: &quot;</span> + (System.currentTimeMillis() - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨cglibä»£ç†ç±»æ¥ä¿å­˜è®¢å•</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºå§”æ‰˜å¯¹è±¡</span></span><br><span class="line">        OrderService orderService = <span class="keyword">new</span> OrderService();</span><br><span class="line">        <span class="comment">// 2. è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">        OrderService orderServiceProxy = (OrderService) <span class="keyword">new</span> ProxyFactory(orderService).getProxyInstance();</span><br><span class="line">        String saveFileName = <span class="string">&quot;CglibOrderServiceDynamicProxy.class&quot;</span>;</span><br><span class="line">        ProxyUtils.saveProxyClass(saveFileName, orderService.getClass().getSimpleName(), <span class="keyword">new</span> Class[]&#123;IOrderService.class&#125;);</span><br><span class="line">        orderServiceProxy.saveOrder(<span class="string">&quot; cruder æ–°ä¹°çš„èŠ±è£¤è¡© &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>cglibåŠ¨æ€ä»£ç†å®ç°æ­¥éª¤å’ŒjdkåŠå…¶ç›¸ä¼¼ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå®ç°MethodInterceptoræ¥å£çš„ç±»</li>
<li>åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„æˆå‘˜å±æ€§ï¼Œä¸ºäº†æ‰©å±•æ–¹ä¾¿å¯ä»¥ç›´æ¥ä½¿ç”¨Objectç±»ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚å®šä¹‰ç›¸åº”çš„æ¥å£</li>
<li>åœ¨invokeæ–¹æ³•ä¸­å®ç°å¯¹å§”æ‰˜å¯¹è±¡çš„è°ƒç”¨ï¼Œæ ¹æ®éœ€æ±‚å¯¹æ–¹æ³•è¿›è¡Œå¢å¼º</li>
<li>ä½¿ç”¨Enhanceråˆ›å»ºç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œå¹¶æä¾›è¦ç»™è·å–ä»£ç†å¯¹è±¡çš„æ–¹æ³•</li>
</ol>
<p>cglibåŠ¨æ€ä»£ç†ç”Ÿæˆçš„ä»£ç†ç±»å’ŒjdkåŠ¨æ€ä»£ç†ä»£ç æ ¼å¼ä¸Šå‡ ä¹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºcglibç”Ÿæˆçš„ä»£ç†ç±»ç»§æ‰¿äº†ä»…ä»…Proxyç±»ï¼Œè€ŒjdkåŠ¨æ€ä»£ç†ç”Ÿæˆçš„ä»£ç†ç±»ç»§æ‰¿äº†Proxyç±»çš„åŒæ—¶ä¹Ÿå®ç°äº†ä¸€ä¸ªæ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆä¸€ä¸ªProxyçš„å­ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> <span class="keyword">extends</span> <span class="title">Proxy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m1;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m2;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m0;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderService</span><span class="params">(InvocationHandler var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Boolean)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m1, <span class="keyword">new</span> Object[]&#123;var1&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var3;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var4);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m2, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m0, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            m1 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;equals&quot;</span>, Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>));</span><br><span class="line">            m2 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;toString&quot;</span>);</span><br><span class="line">            m0 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodError(var2.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoClassDefFoundError(var3.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="jdk-proxy-vs-cglib"><a href="#jdk-proxy-vs-cglib" class="headerlink" title="jdk proxy vs cglib"></a>jdk proxy vs cglib</h3><p>JDK Proxy çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æœ€å°åŒ–ä¾èµ–å…³ç³»ï¼Œå‡å°‘ä¾èµ–æ„å‘³ç€ç®€åŒ–å¼€å‘å’Œç»´æŠ¤ï¼ŒJDK æœ¬èº«çš„æ”¯æŒï¼Œå¯èƒ½æ¯” cglib æ›´åŠ å¯é ã€‚</li>
<li>å¹³æ»‘è¿›è¡Œ JDK ç‰ˆæœ¬å‡çº§ï¼Œè€Œå­—èŠ‚ç ç±»åº“é€šå¸¸éœ€è¦è¿›è¡Œæ›´æ–°ä»¥ä¿è¯åœ¨æ–°ç‰ˆ Java ä¸Šèƒ½å¤Ÿä½¿ç”¨ã€‚</li>
<li>ä»£ç å®ç°ç®€å•ã€‚</li>
</ul>
<p>cglib ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æœ‰çš„æ—¶å€™è°ƒç”¨ç›®æ ‡å¯èƒ½ä¸ä¾¿å®ç°é¢å¤–æ¥å£ï¼Œä»æŸç§è§’åº¦çœ‹ï¼Œé™å®šè°ƒç”¨è€…å®ç°æ¥å£æ˜¯æœ‰äº›ä¾µå…¥æ€§çš„å®è·µï¼Œç±»ä¼¼ cglib åŠ¨æ€ä»£ç†å°±æ²¡æœ‰è¿™ç§é™åˆ¶ã€‚</li>
<li>åªæ“ä½œæˆ‘ä»¬å…³å¿ƒçš„ç±»ï¼Œè€Œä¸å¿…ä¸ºå…¶ä»–ç›¸å…³ç±»å¢åŠ å·¥ä½œé‡ã€‚</li>
</ul>
<p>ä»£ç†æ¨¡å¼: ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶ï¼ˆéš”ç¦»ï¼Œä½¿ç”¨æ¥å£ï¼‰å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p>
<p>jdkåŠ¨æ€ä»£ç†ç”Ÿæˆçš„ä»£ç†ç±»ç»§æ‰¿äº†Proxyç±»å¹¶å®ç°äº†è¢«ä»£ç†çš„æ¥å£ï¼›è€Œcglibç”Ÿæˆçš„ä»£ç†ç±»åˆ™ä»…ç»§æ‰¿äº†Proxyç±»ã€‚</p>
<p>jdkåŠ¨æ€ä»£ç†æœ€å¤§ç¼ºç‚¹ï¼šåªèƒ½ä»£ç†æ¥å£ï¼Œæ—¢å§”æ‰˜ç±»å¿…é¡»å®ç°ç›¸åº”çš„æ¥å£</p>
<p>cglibç¼ºç‚¹ï¼šç”±äºæ˜¯é€šè¿‡â€œå­ç±»åŒ–â€çš„æ–¹å¼ï¼Œ æ‰€ä»¥ä¸èƒ½ä»£ç†finalçš„å§”æ‰˜ç±»æˆ–è€…æ™®é€šå§”æ‰˜ç±»çš„finalä¿®é¥°çš„æ–¹æ³•ã€‚</p>
<p><strong>åŠ¨æ€ä»£ç†å¯¼è‡´springäº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯ï¼š</strong> <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3dd79531fe41">https://www.jianshu.com/p/3dd79531fe41</a></p>

  
  
  <div class="footer">
      <script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>
<div id="bsa-native"></div>
<script>
_bsa.init('custom', 'CKYD62QM', 'placement:vuejsorg',
  {
    target: '#bsa-native',
    template: '<a class="native-box" href="##statlink##"><div class="native-sponsor">Sponsor</div><div class="native-text"><strong>##company##</strong> â€” ##description##</div></a>'
  }
);
</script>


    Caught a mistake or want to contribute to the documentation?
    <a href="https://github.com/vuejs/vuejs.org/blob/master/src/data/Java/java_proxy.md" rel="noopener" target="_blank">
      Edit this on GitHub!
    </a>
    <!-- Deployed on
    <a href="https://url.netlify.com/HJ8X2mxP8" rel="noopener" target="_blank">
      Netlify
    </a>. -->
  </div>
</div>

      </div>
      <script src="/js/smooth-scroll.min.js"></script>
    

    <!-- main custom script for sidebars, version selects etc. -->
    <script src="/js/css.escape.js"></script>
    <script src="/js/common.js"></script>

    <!-- search -->
    <link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel='stylesheet' type='text/css'>
    
<link rel="stylesheet" href="/css/search.css">

    <script src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script>
    [
      '#search-query-nav',
      '#search-query-sidebar',
      '#search-query-menu'
    ].forEach(function (selector) {
      if (!document.querySelector(selector)) return
      // search index defaults to v2
      var match = window.location.pathname.match(/^\/(v\d+)/)
      var version = match ? match[1] : 'v2'
      docsearch({
      appId: 'BH4D9OD16A',
      apiKey: '85cc3221c9f23bfbaa4e3913dd7625ea',
      indexName: 'vuejs',
      inputSelector: selector,
      algoliaOptions: { facetFilters: ["version:" + version] },
      autocompleteOptions: { hint: false, appendTo: 'body'}
      })
    })
    </script>
  </body>
</html>
