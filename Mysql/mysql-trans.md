## ACID

原子性：事务作为一个整体被执行，对数据的操作要么全都执行要么全不执行

一致性：事务应确保从一个一致状态转变到另一个一致状态，一致状态的含义是数据库中的数据应满足完整性约束

隔离性：多个事务并发执行时，一个事务的执行不影响其他事务的执行

持久性：一个事务一旦提交，他对数据库的修改应该永久保存在数据库中

## 事务导致的问题

丢失更新：事务T1对数据进行操作，然后事务T2对相同的数据进行操作并提交，事务T1对数据进行了回滚操作，导致事务T2对数据的操作丢失；事务T1对数据进行操作，事务T2也对数据进行操作并提交，事务T1提交事务，将事务T2对数据的操作覆盖掉了。（两个事务T1、T2读入同一数据并修改，T2提交的结果破坏了T1提交的结果，导致T1的修改丢失。）

脏读：读到了数据库中未提交的数据。（读未提交）。事务T1读到了事务T2未提交的数据，并对该数据进行操作然后提交，但是事务T2对撤销了该事务，导致事务T1操作的是错误的数据。

不可重复读：一个事务T1在读取表中的数据后，另一个事务T2对表中的数据进行了修改，多次读取的结果不一样

幻读：一个事务T1读取按一定条件读取数据库中的某些数据后，另一个事务T2插入或者删除了一些记录，当T1再次读取该数据库时，出现了前后不一致的情况。（事务T1对表的全部数据进行了修改，事务T2在表里插入了一些数据，导致事务T1再次操作该表时，发现还有未修改的数据，好像出现了幻觉一样）

## 不可重复读和幻读的区别

不可重复读：由于数据修改引起的，

幻读：由于数据插入和删除引起的，在可重复读中，sql第一次读取数据后，就将这些数据加锁，其他事物无法修改这些数据，但是可以insert数据，所以事务A先前读取了数据，或者修改了全部数据，事务B还是可以insert数据，这是事务A就会发现多了一条数据，这就是幻读

## 数据库的隔离级别

隔离级别：四种隔离级别（读未提交、读已提交、可重复读、串行化）

读未提交：隔离级别最低，会引发脏读、不可重复读和幻读
读已提交：读到的都是已提交的数据，会引发不可重复读和幻读

可重复读：避免了脏读、不可重复读，会引发幻读

串行化：所有事务按照次序依次执行，脏读、不可重复读、幻读都不会出现

![image-20210118214947232](C:\Users\86130\github\notes\img\mysql\12.png)

mysql的默认隔离级别是：可重复读。myISAM和InnoDB都支持表级锁，但Innodb默认是行级锁。

oracle支持读已提交和串行化两种隔离级别，默认情况是读已提交

